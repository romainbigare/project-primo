import{r as fo,c as Xr,g as ho}from"./babylon-uKq3LcyU.js";function po(Ze,Xt){for(var De=0;De<Xt.length;De++){const Ae=Xt[De];if(typeof Ae!="string"&&!Array.isArray(Ae)){for(const be in Ae)if(be!=="default"&&!(be in Ze)){const We=Object.getOwnPropertyDescriptor(Ae,be);We&&Object.defineProperty(Ze,be,We.get?We:{enumerable:!0,get:()=>Ae[be]})}}}return Object.freeze(Object.defineProperty(Ze,Symbol.toStringTag,{value:"Module"}))}var zt={exports:{}},mo=zt.exports,Qr;function _o(){return Qr||(Qr=1,function(Ze,Xt){(function(De,Ae){Ze.exports=Ae(fo())})(typeof self<"u"?self:typeof Xr<"u"?Xr:mo,De=>(()=>{var Ae,be,We={274:(r,e,t)=>{t.r(e),t.d(e,{FlowGraphGLTFDataProvider:()=>a});var n=t(322),o=t(597),a=function(s){function i(u){var d,h,m=s.call(this)||this,_=u.glTF,y=((d=_.animations)===null||d===void 0?void 0:d.map(function(f){return f._babylonAnimationGroup}))||[];m.animationGroups=m.registerDataOutput("animationGroups",o.RichTypeAny,y);var l=((h=_.nodes)===null||h===void 0?void 0:h.map(function(f){return f._babylonTransformNode}))||[];return m.nodes=m.registerDataOutput("nodes",o.RichTypeAny,l),m}return(0,n.C6)(i,s),i.prototype.getClassName=function(){return"FlowGraphGLTFDataProvider"},i}(o.FlowGraphBlock)},322:(r,e,t)=>{t.d(e,{C6:()=>o,Cl:()=>a,YH:()=>i,sH:()=>s});var n=function(u,d){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var _ in m)Object.prototype.hasOwnProperty.call(m,_)&&(h[_]=m[_])},n(u,d)};function o(u,d){if(typeof d!="function"&&d!==null)throw new TypeError("Class extends value "+String(d)+" is not a constructor or null");function h(){this.constructor=u}n(u,d),u.prototype=d===null?Object.create(d):(h.prototype=d.prototype,new h)}var a=function(){return a=Object.assign||function(u){for(var d,h=1,m=arguments.length;h<m;h++)for(var _ in d=arguments[h])Object.prototype.hasOwnProperty.call(d,_)&&(u[_]=d[_]);return u},a.apply(this,arguments)};function s(u,d,h,m){return new(h||(h=Promise))(function(_,y){function l(v){try{p(m.next(v))}catch(g){y(g)}}function f(v){try{p(m.throw(v))}catch(g){y(g)}}function p(v){var g;v.done?_(v.value):(g=v.value,g instanceof h?g:new h(function(b){b(g)})).then(l,f)}p((m=m.apply(u,d||[])).next())})}function i(u,d){var h,m,_,y={label:0,sent:function(){if(1&_[0])throw _[1];return _[1]},trys:[],ops:[]},l=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return l.next=f(0),l.throw=f(1),l.return=f(2),typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function f(p){return function(v){return function(g){if(h)throw new TypeError("Generator is already executing.");for(;l&&(l=0,g[0]&&(y=0)),y;)try{if(h=1,m&&(_=2&g[0]?m.return:g[0]?m.throw||((_=m.return)&&_.call(m),0):m.next)&&!(_=_.call(m,g[1])).done)return _;switch(m=0,_&&(g=[2&g[0],_.value]),g[0]){case 0:case 1:_=g;break;case 4:return y.label++,{value:g[1],done:!1};case 5:y.label++,m=g[1],g=[0];continue;case 7:g=y.ops.pop(),y.trys.pop();continue;default:if(!((_=(_=y.trys).length>0&&_[_.length-1])||g[0]!==6&&g[0]!==2)){y=0;continue}if(g[0]===3&&(!_||g[1]>_[0]&&g[1]<_[3])){y.label=g[1];break}if(g[0]===6&&y.label<_[1]){y.label=_[1],_=g;break}if(_&&y.label<_[2]){y.label=_[2],y.ops.push(g);break}_[2]&&y.ops.pop(),y.trys.pop();continue}g=d.call(u,y)}catch(b){g=[6,b],m=0}finally{h=_=0}if(5&g[0])throw g[1];return{value:g[0]?g[1]:void 0,done:!0}}([p,v])}}}typeof SuppressedError=="function"&&SuppressedError},597:r=>{r.exports=De},698:(r,e,t)=>{t.d(e,{oR:()=>y,tQ:()=>m,Wt:()=>h,ZU:()=>_});var n=t(597),o=[{regex:new RegExp("^/nodes/\\d+/extensions/")}],a=function(){function l(f,p){this._gltf=f,this._infoTree=p}return l.prototype.convert=function(f){var p=this._gltf,v=this._infoTree,g=void 0;if(!f.startsWith("/"))throw new Error("Path must start with a /");var b=f.split("/");if(b.shift(),b[b.length-1].includes(".length")){var w=b[b.length-1].split(".");b.pop(),b.push.apply(b,w)}for(var A=!1,E=0,R=b;E<R.length;E++){var O=R[E],I=O==="length";if(I&&!v.__array__)throw new Error("Path ".concat(f," is invalid"));if(v.__ignoreObjectTree__&&(A=!0),v.__array__&&!I)v=v.__array__;else if(!(v=v[O]))throw new Error("Path ".concat(f," is invalid"));if(!A)if(p===void 0){if(!o.find(function(L){return L.regex.test(f)}))throw new Error("Path ".concat(f," is invalid"))}else I||(p=p==null?void 0:p[O]);(v.__target__||I)&&(g=p)}return{object:g,info:v}},l}();function s(l,f,p,v){var g=i(l);return v?g[p][v]:g[p]}function i(l,f,p){var v,g,b;return(b=(v=l._data)===null||v===void 0?void 0:v[(g=p==null?void 0:p.fillMode)!==null&&g!==void 0?g:n.Constants.MATERIAL_TriangleFillMode])===null||b===void 0?void 0:b.babylonMaterial}function u(l,f){return{offset:{componentsCount:2,type:"Vector2",get:function(p,v,g){var b=s(p,0,l,f);return new n.Vector2(b==null?void 0:b.uOffset,b==null?void 0:b.vOffset)},getTarget:i,set:function(p,v,g,b){var w=s(v,0,l,f);w.uOffset=p.x,w.vOffset=p.y},getPropertyName:[function(){return"".concat(l).concat(f?"."+f:"",".uOffset")},function(){return"".concat(l).concat(f?"."+f:"",".vOffset")}]},rotation:{type:"number",get:function(p,v,g){var b;return(b=s(p,0,l,f))===null||b===void 0?void 0:b.wAng},getTarget:i,set:function(p,v,g,b){return s(v,0,l,f).wAng=p},getPropertyName:[function(){return"".concat(l).concat(f?"."+f:"",".wAng")}]},scale:{componentsCount:2,type:"Vector2",get:function(p,v,g){var b=s(p,0,l,f);return new n.Vector2(b==null?void 0:b.uScale,b==null?void 0:b.vScale)},getTarget:i,set:function(p,v,g,b){var w=s(v,0,l,f);w.uScale=p.x,w.vScale=p.y},getPropertyName:[function(){return"".concat(l).concat(f?"."+f:"",".uScale")},function(){return"".concat(l).concat(f?"."+f:"",".vScale")}]}}}var d={cameras:{__array__:{__target__:!0,orthographic:{xmag:{componentsCount:2,type:"Vector2",get:function(l){var f,p,v,g;return new n.Vector2((p=(f=l._babylonCamera)===null||f===void 0?void 0:f.orthoLeft)!==null&&p!==void 0?p:0,(g=(v=l._babylonCamera)===null||v===void 0?void 0:v.orthoRight)!==null&&g!==void 0?g:0)},set:function(l,f){f._babylonCamera&&(f._babylonCamera.orthoLeft=l.x,f._babylonCamera.orthoRight=l.y)},getTarget:function(l){return l},getPropertyName:[function(){return"orthoLeft"},function(){return"orthoRight"}]},ymag:{componentsCount:2,type:"Vector2",get:function(l){var f,p,v,g;return new n.Vector2((p=(f=l._babylonCamera)===null||f===void 0?void 0:f.orthoBottom)!==null&&p!==void 0?p:0,(g=(v=l._babylonCamera)===null||v===void 0?void 0:v.orthoTop)!==null&&g!==void 0?g:0)},set:function(l,f){f._babylonCamera&&(f._babylonCamera.orthoBottom=l.x,f._babylonCamera.orthoTop=l.y)},getTarget:function(l){return l},getPropertyName:[function(){return"orthoBottom"},function(){return"orthoTop"}]},zfar:{type:"number",get:function(l){var f;return(f=l._babylonCamera)===null||f===void 0?void 0:f.maxZ},set:function(l,f){f._babylonCamera&&(f._babylonCamera.maxZ=l)},getTarget:function(l){return l},getPropertyName:[function(){return"maxZ"}]},znear:{type:"number",get:function(l){var f;return(f=l._babylonCamera)===null||f===void 0?void 0:f.minZ},set:function(l,f){f._babylonCamera&&(f._babylonCamera.minZ=l)},getTarget:function(l){return l},getPropertyName:[function(){return"minZ"}]}},perspective:{aspectRatio:{type:"number",get:function(l){var f;return(f=l._babylonCamera)===null||f===void 0?void 0:f.getEngine().getAspectRatio(l._babylonCamera)},getTarget:function(l){return l},getPropertyName:[function(){return"aspectRatio"}],isReadOnly:!0},yfov:{type:"number",get:function(l){var f;return(f=l._babylonCamera)===null||f===void 0?void 0:f.fov},set:function(l,f){f._babylonCamera&&(f._babylonCamera.fov=l)},getTarget:function(l){return l},getPropertyName:[function(){return"fov"}]},zfar:{type:"number",get:function(l){var f;return(f=l._babylonCamera)===null||f===void 0?void 0:f.maxZ},set:function(l,f){f._babylonCamera&&(f._babylonCamera.maxZ=l)},getTarget:function(l){return l},getPropertyName:[function(){return"maxZ"}]},znear:{type:"number",get:function(l){var f;return(f=l._babylonCamera)===null||f===void 0?void 0:f.minZ},set:function(l,f){f._babylonCamera&&(f._babylonCamera.minZ=l)},getTarget:function(l){return l},getPropertyName:[function(){return"minZ"}]}}}},nodes:{length:{type:"number",get:function(l){return l.length},getTarget:function(l){return l.map(function(f){return f._babylonTransformNode})},getPropertyName:[function(){return"length"}]},__array__:{__target__:!0,translation:{type:"Vector3",get:function(l){var f;return(f=l._babylonTransformNode)===null||f===void 0?void 0:f.position},set:function(l,f){var p;return(p=f._babylonTransformNode)===null||p===void 0?void 0:p.position.copyFrom(l)},getTarget:function(l){return l._babylonTransformNode},getPropertyName:[function(){return"position"}]},rotation:{type:"Quaternion",get:function(l){var f;return(f=l._babylonTransformNode)===null||f===void 0?void 0:f.rotationQuaternion},set:function(l,f){var p,v;return(v=(p=f._babylonTransformNode)===null||p===void 0?void 0:p.rotationQuaternion)===null||v===void 0?void 0:v.copyFrom(l)},getTarget:function(l){return l._babylonTransformNode},getPropertyName:[function(){return"rotationQuaternion"}]},scale:{type:"Vector3",get:function(l){var f;return(f=l._babylonTransformNode)===null||f===void 0?void 0:f.scaling},set:function(l,f){var p;return(p=f._babylonTransformNode)===null||p===void 0?void 0:p.scaling.copyFrom(l)},getTarget:function(l){return l._babylonTransformNode},getPropertyName:[function(){return"scaling"}]},weights:{length:{type:"number",get:function(l){return l._numMorphTargets},getTarget:function(l){return l._babylonTransformNode},getPropertyName:[function(){return"influence"}]},__array__:{__target__:!0,type:"number",get:function(l,f){var p,v;return f!==void 0?(v=(p=l._primitiveBabylonMeshes)===null||p===void 0?void 0:p[0].morphTargetManager)===null||v===void 0?void 0:v.getTarget(f).influence:void 0},getTarget:function(l){return l._babylonTransformNode},getPropertyName:[function(){return"influence"}]},type:"number[]",get:function(l,f){return[0]},getTarget:function(l){return l._babylonTransformNode},getPropertyName:[function(){return"influence"}]},matrix:{type:"Matrix",get:function(l){var f,p,v;return n.Matrix.Compose((f=l._babylonTransformNode)===null||f===void 0?void 0:f.scaling,(p=l._babylonTransformNode)===null||p===void 0?void 0:p.rotationQuaternion,(v=l._babylonTransformNode)===null||v===void 0?void 0:v.position)},getTarget:function(l){return l._babylonTransformNode},isReadOnly:!0},globalMatrix:{type:"Matrix",get:function(l){for(var f,p,v,g,b,w,A,E=n.Matrix.Identity(),R=l.parent;R&&R.parent;)R=R.parent;var O=((f=l._babylonTransformNode)===null||f===void 0?void 0:f.position._isDirty)||((v=(p=l._babylonTransformNode)===null||p===void 0?void 0:p.rotationQuaternion)===null||v===void 0?void 0:v._isDirty)||((g=l._babylonTransformNode)===null||g===void 0?void 0:g.scaling._isDirty);if(R){var I=(b=R._babylonTransformNode)===null||b===void 0?void 0:b.computeWorldMatrix(!0).invert();I&&((A=(w=l._babylonTransformNode)===null||w===void 0?void 0:w.computeWorldMatrix(O))===null||A===void 0||A.multiplyToRef(I,E))}else l._babylonTransformNode&&E.copyFrom(l._babylonTransformNode.computeWorldMatrix(O));return E},getTarget:function(l){return l._babylonTransformNode},isReadOnly:!0},extensions:{EXT_lights_ies:{multiplier:{type:"number",get:function(l){var f,p;return(p=(f=l._babylonTransformNode)===null||f===void 0?void 0:f.getChildren(function(v){return v instanceof n.SpotLight},!0)[0])===null||p===void 0?void 0:p.intensity},getTarget:function(l){var f;return(f=l._babylonTransformNode)===null||f===void 0?void 0:f.getChildren(function(p){return p instanceof n.SpotLight},!0)[0]},set:function(l,f){if(f._babylonTransformNode){var p=f._babylonTransformNode.getChildren(function(v){return v instanceof n.SpotLight},!0)[0];p&&(p.intensity=l)}}},color:{type:"Color3",get:function(l){var f,p;return(p=(f=l._babylonTransformNode)===null||f===void 0?void 0:f.getChildren(function(v){return v instanceof n.SpotLight},!0)[0])===null||p===void 0?void 0:p.diffuse},getTarget:function(l){var f;return(f=l._babylonTransformNode)===null||f===void 0?void 0:f.getChildren(function(p){return p instanceof n.SpotLight},!0)[0]},set:function(l,f){if(f._babylonTransformNode){var p=f._babylonTransformNode.getChildren(function(v){return v instanceof n.SpotLight},!0)[0];p&&(p.diffuse=l)}}}}}}},materials:{__array__:{__target__:!0,emissiveFactor:{type:"Color3",get:function(l,f,p){return i(l,0,p).emissiveColor},set:function(l,f,p,v){return i(f,0,v).emissiveColor.copyFrom(l)},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"emissiveColor"}]},emissiveTexture:{extensions:{KHR_texture_transform:u("emissiveTexture")}},normalTexture:{scale:{type:"number",get:function(l,f,p){var v;return(v=s(l,0,"bumpTexture"))===null||v===void 0?void 0:v.level},set:function(l,f,p,v){var g=s(f,0,"bumpTexture");g&&(g.level=l)},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"level"}]},extensions:{KHR_texture_transform:u("bumpTexture")}},occlusionTexture:{strength:{type:"number",get:function(l,f,p){return i(l,0,p).ambientTextureStrength},set:function(l,f,p,v){var g=i(f,0,v);g&&(g.ambientTextureStrength=l)},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"ambientTextureStrength"}]},extensions:{KHR_texture_transform:u("ambientTexture")}},pbrMetallicRoughness:{baseColorFactor:{type:"Color4",get:function(l,f,p){var v=i(l,0,p);return n.Color4.FromColor3(v.albedoColor,v.alpha)},set:function(l,f,p,v){var g=i(f,0,v);g.albedoColor.set(l.r,l.g,l.b),g.alpha=l.a},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"albedoColor"},function(){return"alpha"}]},baseColorTexture:{extensions:{KHR_texture_transform:u("albedoTexture")}},metallicFactor:{type:"number",get:function(l,f,p){return i(l,0,p).metallic},set:function(l,f,p,v){var g=i(f,0,v);g&&(g.metallic=l)},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"metallic"}]},roughnessFactor:{type:"number",get:function(l,f,p){return i(l,0,p).roughness},set:function(l,f,p,v){var g=i(f,0,v);g&&(g.roughness=l)},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"roughness"}]},metallicRoughnessTexture:{extensions:{KHR_texture_transform:u("metallicTexture")}}},extensions:{KHR_materials_anisotropy:{anisotropyStrength:{type:"number",get:function(l,f,p){return i(l,0,p).anisotropy.intensity},set:function(l,f,p,v){i(f,0,v).anisotropy.intensity=l},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"anisotropy.intensity"}]},anisotropyRotation:{type:"number",get:function(l,f,p){return i(l,0,p).anisotropy.angle},set:function(l,f,p,v){i(f,0,v).anisotropy.angle=l},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"anisotropy.angle"}]},anisotropyTexture:{extensions:{KHR_texture_transform:u("anisotropy","texture")}}},KHR_materials_clearcoat:{clearcoatFactor:{type:"number",get:function(l,f,p){return i(l,0,p).clearCoat.intensity},set:function(l,f,p,v){i(f,0,v).clearCoat.intensity=l},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"clearCoat.intensity"}]},clearcoatRoughnessFactor:{type:"number",get:function(l,f,p){return i(l,0,p).clearCoat.roughness},set:function(l,f,p,v){i(f,0,v).clearCoat.roughness=l},getTarget:function(l,f,p){return i(l,0,p)},getPropertyName:[function(){return"clearCoat.roughness"}]},clearcoatTexture:{extensions:{KHR_texture_transform:u("clearCoat","texture")}},clearcoatNormalTexture:{scale:{type:"number",get:function(l,f,p){var v;return(v=i(l,0,p).clearCoat.bumpTexture)===null||v===void 0?void 0:v.level},getTarget:i,set:function(l,f,p,v){return i(f,0,v).clearCoat.bumpTexture.level=l}},extensions:{KHR_texture_transform:u("clearCoat","bumpTexture")}},clearcoatRoughnessTexture:{extensions:{KHR_texture_transform:u("clearCoat","textureRoughness")}}},KHR_materials_dispersion:{dispersion:{type:"number",get:function(l,f,p){return i(l,0,p).subSurface.dispersion},getTarget:i,set:function(l,f,p,v){return i(f,0,v).subSurface.dispersion=l}}},KHR_materials_emissive_strength:{emissiveStrength:{type:"number",get:function(l,f,p){return i(l,0,p).emissiveIntensity},getTarget:i,set:function(l,f,p,v){return i(f,0,v).emissiveIntensity=l}}},KHR_materials_ior:{ior:{type:"number",get:function(l,f,p){return i(l,0,p).indexOfRefraction},getTarget:i,set:function(l,f,p,v){return i(f,0,v).indexOfRefraction=l}}},KHR_materials_iridescence:{iridescenceFactor:{type:"number",get:function(l,f,p){return i(l,0,p).iridescence.intensity},getTarget:i,set:function(l,f,p,v){return i(f,0,v).iridescence.intensity=l}},iridescenceIor:{type:"number",get:function(l,f,p){return i(l,0,p).iridescence.indexOfRefraction},getTarget:i,set:function(l,f,p,v){return i(f,0,v).iridescence.indexOfRefraction=l}},iridescenceTexture:{extensions:{KHR_texture_transform:u("iridescence","texture")}},iridescenceThicknessMaximum:{type:"number",get:function(l,f,p){return i(l,0,p).iridescence.maximumThickness},getTarget:i,set:function(l,f,p,v){return i(f,0,v).iridescence.maximumThickness=l}},iridescenceThicknessMinimum:{type:"number",get:function(l,f,p){return i(l,0,p).iridescence.minimumThickness},getTarget:i,set:function(l,f,p,v){return i(f,0,v).iridescence.minimumThickness=l}},iridescenceThicknessTexture:{extensions:{KHR_texture_transform:u("iridescence","thicknessTexture")}}},KHR_materials_sheen:{sheenColorFactor:{type:"Color3",get:function(l,f,p){return i(l,0,p).sheen.color},getTarget:i,set:function(l,f,p,v){return i(f,0,v).sheen.color.copyFrom(l)}},sheenColorTexture:{extensions:{KHR_texture_transform:u("sheen","texture")}},sheenRoughnessFactor:{type:"number",get:function(l,f,p){return i(l,0,p).sheen.intensity},getTarget:i,set:function(l,f,p,v){return i(f,0,v).sheen.intensity=l}},sheenRoughnessTexture:{extensions:{KHR_texture_transform:u("sheen","thicknessTexture")}}},KHR_materials_specular:{specularFactor:{type:"number",get:function(l,f,p){return i(l,0,p).metallicF0Factor},getTarget:i,set:function(l,f,p,v){return i(f,0,v).metallicF0Factor=l},getPropertyName:[function(){return"metallicF0Factor"}]},specularColorFactor:{type:"Color3",get:function(l,f,p){return i(l,0,p).metallicReflectanceColor},getTarget:i,set:function(l,f,p,v){return i(f,0,v).metallicReflectanceColor.copyFrom(l)},getPropertyName:[function(){return"metallicReflectanceColor"}]},specularTexture:{extensions:{KHR_texture_transform:u("metallicReflectanceTexture")}},specularColorTexture:{extensions:{KHR_texture_transform:u("reflectanceTexture")}}},KHR_materials_transmission:{transmissionFactor:{type:"number",get:function(l,f,p){return i(l,0,p).subSurface.refractionIntensity},getTarget:i,set:function(l,f,p,v){return i(f,0,v).subSurface.refractionIntensity=l},getPropertyName:[function(){return"subSurface.refractionIntensity"}]},transmissionTexture:{extensions:{KHR_texture_transform:u("subSurface","refractionIntensityTexture")}}},KHR_materials_diffuse_transmission:{diffuseTransmissionFactor:{type:"number",get:function(l,f,p){return i(l,0,p).subSurface.translucencyIntensity},getTarget:i,set:function(l,f,p,v){return i(f,0,v).subSurface.translucencyIntensity=l}},diffuseTransmissionTexture:{extensions:{KHR_texture_transform:u("subSurface","translucencyIntensityTexture")}},diffuseTransmissionColorFactor:{type:"Color3",get:function(l,f,p){return i(l,0,p).subSurface.translucencyColor},getTarget:i,set:function(l,f,p,v){var g;return l&&((g=i(f,0,v).subSurface.translucencyColor)===null||g===void 0?void 0:g.copyFrom(l))}},diffuseTransmissionColorTexture:{extensions:{KHR_texture_transform:u("subSurface","translucencyColorTexture")}}},KHR_materials_volume:{attenuationColor:{type:"Color3",get:function(l,f,p){return i(l,0,p).subSurface.tintColor},getTarget:i,set:function(l,f,p,v){return i(f,0,v).subSurface.tintColor.copyFrom(l)}},attenuationDistance:{type:"number",get:function(l,f,p){return i(l,0,p).subSurface.tintColorAtDistance},getTarget:i,set:function(l,f,p,v){return i(f,0,v).subSurface.tintColorAtDistance=l}},thicknessFactor:{type:"number",get:function(l,f,p){return i(l,0,p).subSurface.maximumThickness},getTarget:i,set:function(l,f,p,v){return i(f,0,v).subSurface.maximumThickness=l}},thicknessTexture:{extensions:{KHR_texture_transform:u("subSurface","thicknessTexture")}}}}}},extensions:{KHR_lights_punctual:{lights:{length:{type:"number",get:function(l){return l.length},getTarget:function(l){return l.map(function(f){return f._babylonLight})},getPropertyName:[function(l){return"length"}]},__array__:{__target__:!0,color:{type:"Color3",get:function(l){var f;return(f=l._babylonLight)===null||f===void 0?void 0:f.diffuse},set:function(l,f){var p;return(p=f._babylonLight)===null||p===void 0?void 0:p.diffuse.copyFrom(l)},getTarget:function(l){return l._babylonLight},getPropertyName:[function(l){return"diffuse"}]},intensity:{type:"number",get:function(l){var f;return(f=l._babylonLight)===null||f===void 0?void 0:f.intensity},set:function(l,f){return f._babylonLight?f._babylonLight.intensity=l:void 0},getTarget:function(l){return l._babylonLight},getPropertyName:[function(l){return"intensity"}]},range:{type:"number",get:function(l){var f;return(f=l._babylonLight)===null||f===void 0?void 0:f.range},set:function(l,f){return f._babylonLight?f._babylonLight.range=l:void 0},getTarget:function(l){return l._babylonLight},getPropertyName:[function(l){return"range"}]},spot:{innerConeAngle:{type:"number",get:function(l){var f;return(f=l._babylonLight)===null||f===void 0?void 0:f.innerAngle},set:function(l,f){return f._babylonLight?f._babylonLight.innerAngle=l:void 0},getTarget:function(l){return l._babylonLight},getPropertyName:[function(l){return"innerConeAngle"}]},outerConeAngle:{type:"number",get:function(l){var f;return(f=l._babylonLight)===null||f===void 0?void 0:f.angle},set:function(l,f){return f._babylonLight?f._babylonLight.angle=l:void 0},getTarget:function(l){return l._babylonLight},getPropertyName:[function(l){return"outerConeAngle"}]}}}}},EXT_lights_ies:{lights:{length:{type:"number",get:function(l){return l.length},getTarget:function(l){return l.map(function(f){return f._babylonLight})},getPropertyName:[function(l){return"length"}]}}},EXT_lights_image_based:{lights:{length:{type:"number",get:function(l){return l.length},getTarget:function(l){return l.map(function(f){return f._babylonTexture})},getPropertyName:[function(l){return"length"}]},__array__:{__target__:!0,intensity:{type:"number",get:function(l){var f;return(f=l._babylonTexture)===null||f===void 0?void 0:f.level},set:function(l,f){f._babylonTexture&&(f._babylonTexture.level=l)},getTarget:function(l){return l._babylonTexture}},rotation:{type:"Quaternion",get:function(l){var f;return l._babylonTexture&&n.Quaternion.FromRotationMatrix((f=l._babylonTexture)===null||f===void 0?void 0:f.getReflectionTextureMatrix())},set:function(l,f){var p;f._babylonTexture&&(!((p=f._babylonTexture.getScene())===null||p===void 0)&&p.useRightHandedSystem||(l=n.Quaternion.Inverse(l)),n.Matrix.FromQuaternionToRef(l,f._babylonTexture.getReflectionTextureMatrix()))},getTarget:function(l){return l._babylonTexture}}}}}},animations:{length:{type:"number",get:function(l){return l.length},getTarget:function(l){return l.map(function(f){return f._babylonAnimationGroup})},getPropertyName:[function(){return"length"}]},__array__:{}},meshes:{length:{type:"number",get:function(l){return l.length},getTarget:function(l){return l.map(function(f){var p;return(p=f.primitives[0]._instanceData)===null||p===void 0?void 0:p.babylonSourceMesh})},getPropertyName:[function(){return"length"}]},__array__:{}}};function h(l){return new a(l,d)}function m(l){for(var f=l.split("/").map(function(w){return w.replace(/{}/g,"__array__")}),p=d,v=0,g=f;v<g.length;v++){var b=g[v];b&&(p=p[b])}if(p&&p.type&&p.get)return p}function _(l,f){for(var p=l.split("/").map(function(A){return A.replace(/{}/g,"__array__")}),v=d,g=0,b=p;g<b.length;g++){var w=b[g];w&&(v=v[w])}v&&v.type&&v.get&&(v.interpolation=f)}function y(l,f){for(var p=l.split("/").map(function(A){return A.replace(/{}/g,"__array__")}),v=d,g=0,b=p;g<b.length;g++){var w=b[g];if(w){if(!v[w]){if(w==="?"){v.__ignoreObjectTree__=!0;continue}v[w]={},w==="__array__"&&(v[w].__target__=!0)}v=v[w]}}Object.assign(v,f)}},727:(r,e,t)=>{t.r(e),t.d(e,{AnimationPropertyInfo:()=>d,TransformNodeAnimationPropertyInfo:()=>h,WeightAnimationPropertyInfo:()=>m,getQuaternion:()=>i,getVector3:()=>s,getWeights:()=>u});var n=t(322),o=t(597),a=t(698);function s(_,y,l,f){return o.Vector3.FromArray(y,l).scaleInPlace(f)}function i(_,y,l,f){return o.Quaternion.FromArray(y,l).scaleInPlace(f)}function u(_,y,l,f){for(var p=new Array(_._numMorphTargets),v=0;v<p.length;v++)p[v]=y[l++]*f;return p}var d=function(){function _(y,l,f,p){this.type=y,this.name=l,this.getValue=f,this.getStride=p}return _.prototype._buildAnimation=function(y,l,f){var p=new o.Animation(y,this.name,l,this.type);return p.setKeys(f),p},_}(),h=function(_){function y(){return _!==null&&_.apply(this,arguments)||this}return(0,n.C6)(y,_),y.prototype.buildAnimations=function(l,f,p,v){var g=[];return g.push({babylonAnimatable:l._babylonTransformNode,babylonAnimation:this._buildAnimation(f,p,v)}),g},y}(d),m=function(_){function y(){return _!==null&&_.apply(this,arguments)||this}return(0,n.C6)(y,_),y.prototype.buildAnimations=function(l,f,p,v){var g=[];if(l._numMorphTargets)for(var b=function(E){var R=new o.Animation("".concat(f,"_").concat(E),w.name,p,w.type);if(R.setKeys(v.map(function(P){return{frame:P.frame,inTangent:P.inTangent?P.inTangent[E]:void 0,value:P.value[E],outTangent:P.outTangent?P.outTangent[E]:void 0,interpolation:P.interpolation}})),l._primitiveBabylonMeshes)for(var O=0,I=l._primitiveBabylonMeshes;O<I.length;O++){var L=I[O];if(L.morphTargetManager){var S=L.morphTargetManager.getTarget(E),B=R.clone();S.animations.push(B),g.push({babylonAnimatable:S,babylonAnimation:B})}}},w=this,A=0;A<l._numMorphTargets;A++)b(A);return g},y}(d);(0,a.ZU)("/nodes/{}/translation",[new h(o.Animation.ANIMATIONTYPE_VECTOR3,"position",s,function(){return 3})]),(0,a.ZU)("/nodes/{}/rotation",[new h(o.Animation.ANIMATIONTYPE_QUATERNION,"rotationQuaternion",i,function(){return 4})]),(0,a.ZU)("/nodes/{}/scale",[new h(o.Animation.ANIMATIONTYPE_VECTOR3,"scaling",s,function(){return 3})]),(0,a.ZU)("/nodes/{}/weights",[new m(o.Animation.ANIMATIONTYPE_FLOAT,"influence",u,function(_){return _._numMorphTargets})])}},Ar={};function N(r){var e=Ar[r];if(e!==void 0)return e.exports;var t=Ar[r]={exports:{}};return We[r](t,t.exports,N),t.exports}N.n=r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return N.d(e,{a:e}),e},be=Object.getPrototypeOf?r=>Object.getPrototypeOf(r):r=>r.__proto__,N.t=function(r,e){if(1&e&&(r=this(r)),8&e||typeof r=="object"&&r&&(4&e&&r.__esModule||16&e&&typeof r.then=="function"))return r;var t=Object.create(null);N.r(t);var n={};Ae=Ae||[null,be({}),be([]),be(be)];for(var o=2&e&&r;typeof o=="object"&&!~Ae.indexOf(o);o=be(o))Object.getOwnPropertyNames(o).forEach(a=>n[a]=()=>r[a]);return n.default=()=>r,N.d(t,n),t},N.d=(r,e)=>{for(var t in e)N.o(e,t)&&!N.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:e[t]})},N.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),N.o=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),N.r=r=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})};var wr={};N.d(wr,{default:()=>co});var it={};N.r(it),N.d(it,{GLTFValidation:()=>en});var st={};N.r(st),N.d(st,{GLTFFileLoader:()=>we,GLTFLoaderAnimationStartMode:()=>Pe,GLTFLoaderCoordinateSystemMode:()=>Ge,GLTFLoaderState:()=>me});var qe={};N.r(qe),N.d(qe,{EBlendingFunction:()=>$,EComponentType:()=>Le,ECullingType:()=>dt,EParameterType:()=>_e,EShaderType:()=>ft,ETextureFilterType:()=>Te,ETextureFormat:()=>tn,ETextureWrapMode:()=>He,GLTFBinaryExtension:()=>Br,GLTFLoader:()=>Ue,GLTFLoaderBase:()=>Me,GLTFLoaderExtension:()=>Ce,GLTFMaterialsCommonExtension:()=>kr,GLTFUtils:()=>ye});var Qt={};N.r(Qt);var lt={};N.r(lt),N.d(lt,{AddObjectAccessorToKey:()=>x.oR,EXT_lights_ies:()=>hn,EXT_lights_image_based:()=>ln,EXT_materials_diffuse_roughness:()=>Rn,EXT_mesh_gpu_instancing:()=>un,EXT_meshopt_compression:()=>cn,EXT_texture_avif:()=>dn,EXT_texture_webp:()=>fn,ExtrasAsMetadata:()=>pr,FlowGraphGLTFDataProvider:()=>jr.FlowGraphGLTFDataProvider,GetMappingForKey:()=>x.tQ,GetPathToObjectConverter:()=>x.Wt,InteractivityGraphToFlowGraphParser:()=>sr,KHR_animation_pointer:()=>tr,KHR_draco_mesh_compression:()=>pn,KHR_interactivity:()=>lr,KHR_lights:()=>mn,KHR_materials_anisotropy:()=>bn,KHR_materials_clearcoat:()=>yn,KHR_materials_diffuse_transmission:()=>Mn,KHR_materials_dispersion:()=>Ln,KHR_materials_emissive_strength:()=>Tn,KHR_materials_ior:()=>wn,KHR_materials_iridescence:()=>gn,KHR_materials_pbrSpecularGlossiness:()=>_n,KHR_materials_sheen:()=>xn,KHR_materials_specular:()=>An,KHR_materials_transmission:()=>On,KHR_materials_unlit:()=>vn,KHR_materials_variants:()=>En,KHR_materials_volume:()=>Cn,KHR_mesh_quantization:()=>Fn,KHR_node_hoverability:()=>dr,KHR_node_selectability:()=>fr,KHR_node_visibility:()=>cr,KHR_texture_basisu:()=>Nn,KHR_texture_transform:()=>Pn,KHR_xmp_json_ld:()=>In,MSFT_audio_emitter:()=>nr,MSFT_lod:()=>rr,MSFT_minecraftMesh:()=>or,MSFT_sRGBFactors:()=>ar,SetInterpolationForKey:()=>x.ZU,_AddInteractivityObjectModel:()=>ur,addNewInteractivityFlowGraphMapping:()=>Je,getAllSupportedNativeNodeTypes:()=>Hr,getMappingForDeclaration:()=>Yt,getMappingForFullOperationName:()=>jt,gltfTypeToBabylonType:()=>ir});var ze={};N.r(ze),N.d(ze,{AddObjectAccessorToKey:()=>x.oR,AnimationPropertyInfo:()=>Re.AnimationPropertyInfo,ArrayItem:()=>M,EXT_lights_ies:()=>hn,EXT_lights_image_based:()=>ln,EXT_materials_diffuse_roughness:()=>Rn,EXT_mesh_gpu_instancing:()=>un,EXT_meshopt_compression:()=>cn,EXT_texture_avif:()=>dn,EXT_texture_webp:()=>fn,ExtrasAsMetadata:()=>pr,FlowGraphGLTFDataProvider:()=>jr.FlowGraphGLTFDataProvider,GLTFFileLoader:()=>we,GLTFLoader:()=>V,GetMappingForKey:()=>x.tQ,GetPathToObjectConverter:()=>x.Wt,InteractivityGraphToFlowGraphParser:()=>sr,KHR_animation_pointer:()=>tr,KHR_draco_mesh_compression:()=>pn,KHR_interactivity:()=>lr,KHR_lights:()=>mn,KHR_materials_anisotropy:()=>bn,KHR_materials_clearcoat:()=>yn,KHR_materials_diffuse_transmission:()=>Mn,KHR_materials_dispersion:()=>Ln,KHR_materials_emissive_strength:()=>Tn,KHR_materials_ior:()=>wn,KHR_materials_iridescence:()=>gn,KHR_materials_pbrSpecularGlossiness:()=>_n,KHR_materials_sheen:()=>xn,KHR_materials_specular:()=>An,KHR_materials_transmission:()=>On,KHR_materials_unlit:()=>vn,KHR_materials_variants:()=>En,KHR_materials_volume:()=>Cn,KHR_mesh_quantization:()=>Fn,KHR_node_hoverability:()=>dr,KHR_node_selectability:()=>fr,KHR_node_visibility:()=>cr,KHR_texture_basisu:()=>Nn,KHR_texture_transform:()=>Pn,KHR_xmp_json_ld:()=>In,LoadBoundingInfoFromPositionAccessor:()=>sn,MSFT_audio_emitter:()=>nr,MSFT_lod:()=>rr,MSFT_minecraftMesh:()=>or,MSFT_sRGBFactors:()=>ar,SetInterpolationForKey:()=>x.ZU,TransformNodeAnimationPropertyInfo:()=>Re.TransformNodeAnimationPropertyInfo,WeightAnimationPropertyInfo:()=>Re.WeightAnimationPropertyInfo,_AddInteractivityObjectModel:()=>ur,addNewInteractivityFlowGraphMapping:()=>Je,getAllSupportedNativeNodeTypes:()=>Hr,getMappingForDeclaration:()=>Yt,getMappingForFullOperationName:()=>jt,getQuaternion:()=>Re.getQuaternion,getVector3:()=>Re.getVector3,getWeights:()=>Re.getWeights,gltfTypeToBabylonType:()=>ir,registerGLTFExtension:()=>H,registeredGLTFExtensions:()=>Gr,unregisterGLTFExtension:()=>G});var ut={};N.r(ut),N.d(ut,{MTLFileLoader:()=>tt,OBJFileLoader:()=>_r,SolidParser:()=>mr});var ct={};N.r(ct),N.d(ct,{STLFileLoader:()=>vr});var Jt={};N.r(Jt),N.d(Jt,{GLTF1:()=>qe,GLTF2:()=>ze,GLTFFileLoader:()=>we,GLTFLoaderAnimationStartMode:()=>Pe,GLTFLoaderCoordinateSystemMode:()=>Ge,GLTFLoaderState:()=>me,GLTFValidation:()=>en,MTLFileLoader:()=>tt,OBJFileLoader:()=>_r,SPLATFileLoader:()=>Wr,STLFileLoader:()=>vr,SolidParser:()=>mr});var T=N(322),c=N(597);function $t(r,e,t,n){var o={externalResourceFunction:n};return t&&(o.uri=e==="file:"?t:e+t),ArrayBuffer.isView(r)?GLTFValidator.validateBytes(r,o):GLTFValidator.validateString(r,o)}function $r(){var r=[];onmessage=function(e){var t=e.data;switch(t.id){case"init":importScripts(t.url);break;case"validate":$t(t.data,t.rootUrl,t.fileName,function(n){return new Promise(function(o,a){var s=r.length;r.push({resolve:o,reject:a}),postMessage({id:"getExternalResource",index:s,uri:n})})}).then(function(n){postMessage({id:"validate.resolve",value:n})},function(n){postMessage({id:"validate.reject",reason:n})});break;case"getExternalResource.resolve":r[t.index].resolve(t.value);break;case"getExternalResource.reject":r[t.index].reject(t.reason)}}}var Ge,Pe,me,en=function(){function r(){}return r.ValidateAsync=function(e,t,n,o){var a=this;return typeof Worker=="function"?new Promise(function(s,i){var u="".concat($t,"(").concat($r,")()"),d=URL.createObjectURL(new Blob([u],{type:"application/javascript"})),h=new Worker(d),m=function(l){h.removeEventListener("error",m),h.removeEventListener("message",_),i(l)},_=function(l){var f=l.data;switch(f.id){case"getExternalResource":o(f.uri).then(function(p){h.postMessage({id:"getExternalResource.resolve",index:f.index,value:p},[p.buffer])},function(p){h.postMessage({id:"getExternalResource.reject",index:f.index,reason:p})});break;case"validate.resolve":h.removeEventListener("error",m),h.removeEventListener("message",_),s(f.value),h.terminate();break;case"validate.reject":h.removeEventListener("error",m),h.removeEventListener("message",_),i(f.reason),h.terminate()}};if(h.addEventListener("error",m),h.addEventListener("message",_),h.postMessage({id:"init",url:c.Tools.GetBabylonScriptURL(a.Configuration.url)}),ArrayBuffer.isView(e)){var y=e.slice();h.postMessage({id:"validate",data:y,rootUrl:t,fileName:n},[y.buffer])}else h.postMessage({id:"validate",data:e,rootUrl:t,fileName:n})}):(this._LoadScriptPromise||(this._LoadScriptPromise=c.Tools.LoadBabylonScriptAsync(this.Configuration.url)),this._LoadScriptPromise.then(function(){return $t(e,t,n,o)}))},r.Configuration={url:"".concat(c.Tools._DefaultCdnUrl,"/gltf_validator.js")},r}(),Ie="Z2xURg",Er="gltf",eo={".gltf":{isBinary:!1,mimeType:"model/gltf+json"},".glb":{isBinary:!0,mimeType:"model/gltf-binary"}};function Or(r,e,t){try{return Promise.resolve(new Uint8Array(r,e,t))}catch(n){return Promise.reject(n)}}(function(r){r[r.AUTO=0]="AUTO",r[r.FORCE_RIGHT_HANDED=1]="FORCE_RIGHT_HANDED"})(Ge||(Ge={})),function(r){r[r.NONE=0]="NONE",r[r.FIRST=1]="FIRST",r[r.ALL=2]="ALL"}(Pe||(Pe={})),function(r){r[r.LOADING=0]="LOADING",r[r.READY=1]="READY",r[r.COMPLETE=2]="COMPLETE"}(me||(me={}));var Le,ft,_e,He,Te,tn,dt,$,we=function(r){function e(t){var n=r.call(this)||this;return n.onParsedObservable=new c.Observable,n.onMeshLoadedObservable=new c.Observable,n.onSkinLoadedObservable=new c.Observable,n.onTextureLoadedObservable=new c.Observable,n.onMaterialLoadedObservable=new c.Observable,n.onCameraLoadedObservable=new c.Observable,n.onCompleteObservable=new c.Observable,n.onErrorObservable=new c.Observable,n.onDisposeObservable=new c.Observable,n.onExtensionLoadedObservable=new c.Observable,n.validate=!1,n.onValidatedObservable=new c.Observable,n._loader=null,n._state=null,n._requests=new Array,n.name=Er,n.extensions=eo,n.onLoaderStateChangedObservable=new c.Observable,n._logIndentLevel=0,n._loggingEnabled=!1,n._log=n._logDisabled,n._capturePerformanceCounters=!1,n._startPerformanceCounter=n._startPerformanceCounterDisabled,n._endPerformanceCounter=n._endPerformanceCounterDisabled,n.copyFrom(t),n}return(0,T.C6)(e,r),Object.defineProperty(e.prototype,"onParsed",{set:function(t){this._onParsedObserver&&this.onParsedObservable.remove(this._onParsedObserver),t&&(this._onParsedObserver=this.onParsedObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMeshLoaded",{set:function(t){this._onMeshLoadedObserver&&this.onMeshLoadedObservable.remove(this._onMeshLoadedObserver),t&&(this._onMeshLoadedObserver=this.onMeshLoadedObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSkinLoaded",{set:function(t){this._onSkinLoadedObserver&&this.onSkinLoadedObservable.remove(this._onSkinLoadedObserver),t&&(this._onSkinLoadedObserver=this.onSkinLoadedObservable.add(function(n){return t(n.node,n.skinnedNode)}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onTextureLoaded",{set:function(t){this._onTextureLoadedObserver&&this.onTextureLoadedObservable.remove(this._onTextureLoadedObserver),t&&(this._onTextureLoadedObserver=this.onTextureLoadedObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMaterialLoaded",{set:function(t){this._onMaterialLoadedObserver&&this.onMaterialLoadedObservable.remove(this._onMaterialLoadedObserver),t&&(this._onMaterialLoadedObserver=this.onMaterialLoadedObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onCameraLoaded",{set:function(t){this._onCameraLoadedObserver&&this.onCameraLoadedObservable.remove(this._onCameraLoadedObserver),t&&(this._onCameraLoadedObserver=this.onCameraLoadedObservable.add(t))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{set:function(t){this._onCompleteObserver&&this.onCompleteObservable.remove(this._onCompleteObserver),this._onCompleteObserver=this.onCompleteObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{set:function(t){this._onErrorObserver&&this.onErrorObservable.remove(this._onErrorObserver),this._onErrorObserver=this.onErrorObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDispose",{set:function(t){this._onDisposeObserver&&this.onDisposeObservable.remove(this._onDisposeObserver),this._onDisposeObserver=this.onDisposeObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onExtensionLoaded",{set:function(t){this._onExtensionLoadedObserver&&this.onExtensionLoadedObservable.remove(this._onExtensionLoadedObserver),this._onExtensionLoadedObserver=this.onExtensionLoadedObservable.add(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this._loggingEnabled},set:function(t){this._loggingEnabled!==t&&(this._loggingEnabled=t,this._loggingEnabled?this._log=this._logEnabled:this._log=this._logDisabled)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"capturePerformanceCounters",{get:function(){return this._capturePerformanceCounters},set:function(t){this._capturePerformanceCounters!==t&&(this._capturePerformanceCounters=t,this._capturePerformanceCounters?(this._startPerformanceCounter=this._startPerformanceCounterEnabled,this._endPerformanceCounter=this._endPerformanceCounterEnabled):(this._startPerformanceCounter=this._startPerformanceCounterDisabled,this._endPerformanceCounter=this._endPerformanceCounterDisabled))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onValidated",{set:function(t){this._onValidatedObserver&&this.onValidatedObservable.remove(this._onValidatedObserver),this._onValidatedObserver=this.onValidatedObservable.add(t)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this._loader&&(this._loader.dispose(),this._loader=null);for(var t=0,n=this._requests;t<n.length;t++)n[t].abort();this._requests.length=0,delete this._progressCallback,this.preprocessUrlAsync=function(o){return Promise.resolve(o)},this.onMeshLoadedObservable.clear(),this.onSkinLoadedObservable.clear(),this.onTextureLoadedObservable.clear(),this.onMaterialLoadedObservable.clear(),this.onCameraLoadedObservable.clear(),this.onCompleteObservable.clear(),this.onExtensionLoadedObservable.clear(),this.onDisposeObservable.notifyObservers(void 0),this.onDisposeObservable.clear()},e.prototype.loadFile=function(t,n,o,a,s,i,u,d){var h=this;if(ArrayBuffer.isView(n))return this._loadBinary(t,n,o,a,u,d),null;this._progressCallback=s;var m=n.name||c.Tools.GetFilename(n);if(i){if(this.useRangeRequests){this.validate&&c.Logger.Warn("glTF validation is not supported when range requests are enabled");var _={abort:function(){},onCompleteObservable:new c.Observable},y={readAsync:function(l,f){return new Promise(function(p,v){h._loadFile(t,n,function(g){p(new Uint8Array(g))},!0,function(g){v(g)},function(g){g.setRequestHeader("Range","bytes=".concat(l,"-").concat(l+f-1))})})},byteLength:0};return this._unpackBinaryAsync(new c.DataReader(y)).then(function(l){_.onCompleteObservable.notifyObservers(_),a(l)},u?function(l){return u(void 0,l)}:void 0),_}return this._loadFile(t,n,function(l){h._validate(t,new Uint8Array(l,0,l.byteLength),o,m),h._unpackBinaryAsync(new c.DataReader({readAsync:function(f,p){return Or(l,f,p)},byteLength:l.byteLength})).then(function(f){a(f)},u?function(f){return u(void 0,f)}:void 0)},!0,u)}return this._loadFile(t,n,function(l){try{h._validate(t,l,o,m),a({json:h._parseJson(l)})}catch{u&&u()}},!1,u)},e.prototype._loadBinary=function(t,n,o,a,s,i){this._validate(t,new Uint8Array(n.buffer,n.byteOffset,n.byteLength),o,i),this._unpackBinaryAsync(new c.DataReader({readAsync:function(u,d){return function(h,m,_){try{if(m<0||m>=h.byteLength)throw new RangeError("Offset is out of range.");if(m+_>h.byteLength)throw new RangeError("Length is out of range.");return Promise.resolve(new Uint8Array(h.buffer,h.byteOffset+m,_))}catch(y){return Promise.reject(y)}}(n,u,d)},byteLength:n.byteLength})).then(function(u){a(u)},s?function(u){return s(void 0,u)}:void 0)},e.prototype.importMeshAsync=function(t,n,o,a,s,i){var u=this;return Promise.resolve().then(function(){return u.onParsedObservable.notifyObservers(o),u.onParsedObservable.clear(),u._log("Loading ".concat(i||"")),u._loader=u._getLoader(o),u._loader.importMeshAsync(t,n,null,o,a,s,i)})},e.prototype.loadAsync=function(t,n,o,a,s){var i=this;return Promise.resolve().then(function(){return i.onParsedObservable.notifyObservers(n),i.onParsedObservable.clear(),i._log("Loading ".concat(s||"")),i._loader=i._getLoader(n),i._loader.loadAsync(t,n,o,a,s)})},e.prototype.loadAssetContainerAsync=function(t,n,o,a,s){var i=this;return Promise.resolve().then(function(){i.onParsedObservable.notifyObservers(n),i.onParsedObservable.clear(),i._log("Loading ".concat(s||"")),i._loader=i._getLoader(n);var u=new c.AssetContainer(t),d=[];i.onMaterialLoadedObservable.add(function(y){d.push(y)});var h=[];i.onTextureLoadedObservable.add(function(y){h.push(y)});var m=[];i.onCameraLoadedObservable.add(function(y){m.push(y)});var _=[];return i.onMeshLoadedObservable.add(function(y){y.morphTargetManager&&_.push(y.morphTargetManager)}),i._loader.importMeshAsync(null,t,u,n,o,a,s).then(function(y){return Array.prototype.push.apply(u.geometries,y.geometries),Array.prototype.push.apply(u.meshes,y.meshes),Array.prototype.push.apply(u.particleSystems,y.particleSystems),Array.prototype.push.apply(u.skeletons,y.skeletons),Array.prototype.push.apply(u.animationGroups,y.animationGroups),Array.prototype.push.apply(u.materials,d),Array.prototype.push.apply(u.textures,h),Array.prototype.push.apply(u.lights,y.lights),Array.prototype.push.apply(u.transformNodes,y.transformNodes),Array.prototype.push.apply(u.cameras,m),Array.prototype.push.apply(u.morphTargetManagers,_),u})})},e.prototype.canDirectLoad=function(t){return function(n){return n.indexOf("asset")!==-1&&n.indexOf("version")!==-1||n.startsWith("data:base64,"+Ie)||n.startsWith("data:;base64,"+Ie)||n.startsWith("data:application/octet-stream;base64,"+Ie)||n.startsWith("data:model/gltf-binary;base64,"+Ie)}(t)},e.prototype.directLoad=function(t,n){if(n.startsWith("base64,"+Ie)||n.startsWith(";base64,"+Ie)||n.startsWith("application/octet-stream;base64,"+Ie)||n.startsWith("model/gltf-binary;base64,"+Ie)){var o=(0,c.DecodeBase64UrlToBinary)(n);return this._validate(t,new Uint8Array(o,0,o.byteLength)),this._unpackBinaryAsync(new c.DataReader({readAsync:function(a,s){return Or(o,a,s)},byteLength:o.byteLength}))}return this._validate(t,n),Promise.resolve({json:this._parseJson(n)})},e.prototype.createPlugin=function(t){return new e(t[Er])},Object.defineProperty(e.prototype,"loaderState",{get:function(){return this._state},enumerable:!1,configurable:!0}),e.prototype.whenCompleteAsync=function(){var t=this;return new Promise(function(n,o){t.onCompleteObservable.addOnce(function(){n()}),t.onErrorObservable.addOnce(function(a){o(a)})})},e.prototype._setState=function(t){this._state!==t&&(this._state=t,this.onLoaderStateChangedObservable.notifyObservers(this._state),this._log(me[this._state]))},e.prototype._loadFile=function(t,n,o,a,s,i){var u=this,d=t._loadFile(n,o,function(h){u._onProgress(h,d)},!0,a,s,i);return d.onCompleteObservable.add(function(){d._lengthComputable=!0,d._total=d._loaded}),this._requests.push(d),d},e.prototype._onProgress=function(t,n){if(this._progressCallback){n._lengthComputable=t.lengthComputable,n._loaded=t.loaded,n._total=t.total;for(var o=!0,a=0,s=0,i=0,u=this._requests;i<u.length;i++){var d=u[i];if(d._lengthComputable===void 0||d._loaded===void 0||d._total===void 0)return;o=o&&d._lengthComputable,a+=d._loaded,s+=d._total}this._progressCallback({lengthComputable:o,loaded:a,total:o?s:0})}},e.prototype._validate=function(t,n,o,a){var s=this;o===void 0&&(o=""),a===void 0&&(a=""),this.validate&&(this._startPerformanceCounter("Validate JSON"),en.ValidateAsync(n,o,a,function(i){return s.preprocessUrlAsync(o+i).then(function(u){return t._loadFileAsync(u,void 0,!0,!0).then(function(d){return new Uint8Array(d,0,d.byteLength)})})}).then(function(i){s._endPerformanceCounter("Validate JSON"),s.onValidatedObservable.notifyObservers(i),s.onValidatedObservable.clear()},function(i){s._endPerformanceCounter("Validate JSON"),c.Tools.Warn("Failed to validate: ".concat(i.message)),s.onValidatedObservable.clear()}))},e.prototype._getLoader=function(t){var n=t.json.asset||{};this._log("Asset version: ".concat(n.version)),n.minVersion&&this._log("Asset minimum version: ".concat(n.minVersion)),n.generator&&this._log("Asset generator: ".concat(n.generator));var o=e._parseVersion(n.version);if(!o)throw new Error("Invalid version: "+n.version);if(n.minVersion!==void 0){var a=e._parseVersion(n.minVersion);if(!a)throw new Error("Invalid minimum version: "+n.minVersion);if(e._compareVersion(a,{major:2,minor:0})>0)throw new Error("Incompatible minimum version: "+n.minVersion)}var s={1:e._CreateGLTF1Loader,2:e._CreateGLTF2Loader}[o.major];if(!s)throw new Error("Unsupported version: "+n.version);return s(this)},e.prototype._parseJson=function(t){this._startPerformanceCounter("Parse JSON"),this._log("JSON length: ".concat(t.length));var n=JSON.parse(t);return this._endPerformanceCounter("Parse JSON"),n},e.prototype._unpackBinaryAsync=function(t){var n=this;return this._startPerformanceCounter("Unpack Binary"),t.loadAsync(20).then(function(){var o=t.readUint32();if(o!==1179937895)throw new c.RuntimeError("Unexpected magic: "+o,c.ErrorCodes.GLTFLoaderUnexpectedMagicError);var a=t.readUint32();n.loggingEnabled&&n._log("Binary version: ".concat(a));var s,i=t.readUint32();switch(n.useRangeRequests||i===t.buffer.byteLength||c.Logger.Warn("Length in header does not match actual data length: ".concat(i," != ").concat(t.buffer.byteLength)),a){case 1:s=n._unpackBinaryV1Async(t,i);break;case 2:s=n._unpackBinaryV2Async(t,i);break;default:throw new Error("Unsupported version: "+a)}return n._endPerformanceCounter("Unpack Binary"),s})},e.prototype._unpackBinaryV1Async=function(t,n){var o=t.readUint32(),a=t.readUint32();if(a!==0)throw new Error("Unexpected content format: ".concat(a));var s=n-t.byteOffset,i={json:this._parseJson(t.readString(o)),bin:null};if(s!==0){var u=t.byteOffset;i.bin={readAsync:function(d,h){return t.buffer.readAsync(u+d,h)},byteLength:s}}return Promise.resolve(i)},e.prototype._unpackBinaryV2Async=function(t,n){var o=this,a=1313821514,s=t.readUint32();if(t.readUint32()!==a)throw new Error("First chunk format is not JSON");return t.byteOffset+s===n?t.loadAsync(s).then(function(){return{json:o._parseJson(t.readString(s)),bin:null}}):t.loadAsync(s+8).then(function(){var i={json:o._parseJson(t.readString(s)),bin:null},u=function(){var d=t.readUint32();switch(t.readUint32()){case a:throw new Error("Unexpected JSON chunk");case 5130562:var h=t.byteOffset;i.bin={readAsync:function(m,_){return t.buffer.readAsync(h+m,_)},byteLength:d},t.skipBytes(d);break;default:t.skipBytes(d)}return t.byteOffset!==n?t.loadAsync(8).then(u):Promise.resolve(i)};return u()})},e._parseVersion=function(t){if(t==="1.0"||t==="1.0.1")return{major:1,minor:0};var n=(t+"").match(/^(\d+)\.(\d+)/);return n?{major:parseInt(n[1]),minor:parseInt(n[2])}:null},e._compareVersion=function(t,n){return t.major>n.major?1:t.major<n.major?-1:t.minor>n.minor?1:t.minor<n.minor?-1:0},e.prototype._logOpen=function(t){this._log(t),this._logIndentLevel++},e.prototype._logClose=function(){--this._logIndentLevel},e.prototype._logEnabled=function(t){var n=e._logSpaces.substring(0,2*this._logIndentLevel);c.Logger.Log("".concat(n).concat(t))},e.prototype._logDisabled=function(t){},e.prototype._startPerformanceCounterEnabled=function(t){c.Tools.StartPerformanceCounter(t)},e.prototype._startPerformanceCounterDisabled=function(t){},e.prototype._endPerformanceCounterEnabled=function(t){c.Tools.EndPerformanceCounter(t)},e.prototype._endPerformanceCounterDisabled=function(t){},e.IncrementalLoading=!0,e.HomogeneousCoordinates=!1,e._logSpaces="                                ",e}(function(){function r(){this.coordinateSystemMode=Ge.AUTO,this.animationStartMode=Pe.FIRST,this.loadNodeAnimations=!0,this.loadSkins=!0,this.loadMorphTargets=!0,this.compileMaterials=!1,this.useClipPlane=!1,this.compileShadowGenerators=!1,this.transparencyAsCoverage=!1,this.useRangeRequests=!1,this.createInstances=!0,this.alwaysComputeBoundingBox=!1,this.loadAllMaterials=!1,this.loadOnlyMaterials=!1,this.skipMaterials=!1,this.useSRGBBuffers=!0,this.targetFps=60,this.alwaysComputeSkeletonRootNode=!1,this.useGltfTextureNames=!1,this.preprocessUrlAsync=function(e){return Promise.resolve(e)},this.extensionOptions={}}return r.prototype.copyFrom=function(e){var t,n,o,a,s,i,u,d,h,m,_,y,l,f,p,v,g,b,w,A,E;e&&(this.onParsed=e.onParsed,this.coordinateSystemMode=(t=e.coordinateSystemMode)!==null&&t!==void 0?t:this.coordinateSystemMode,this.animationStartMode=(n=e.animationStartMode)!==null&&n!==void 0?n:this.animationStartMode,this.loadNodeAnimations=(o=e.loadNodeAnimations)!==null&&o!==void 0?o:this.loadNodeAnimations,this.loadSkins=(a=e.loadSkins)!==null&&a!==void 0?a:this.loadSkins,this.loadMorphTargets=(s=e.loadMorphTargets)!==null&&s!==void 0?s:this.loadMorphTargets,this.compileMaterials=(i=e.compileMaterials)!==null&&i!==void 0?i:this.compileMaterials,this.useClipPlane=(u=e.useClipPlane)!==null&&u!==void 0?u:this.useClipPlane,this.compileShadowGenerators=(d=e.compileShadowGenerators)!==null&&d!==void 0?d:this.compileShadowGenerators,this.transparencyAsCoverage=(h=e.transparencyAsCoverage)!==null&&h!==void 0?h:this.transparencyAsCoverage,this.useRangeRequests=(m=e.useRangeRequests)!==null&&m!==void 0?m:this.useRangeRequests,this.createInstances=(_=e.createInstances)!==null&&_!==void 0?_:this.createInstances,this.alwaysComputeBoundingBox=(y=e.alwaysComputeBoundingBox)!==null&&y!==void 0?y:this.alwaysComputeBoundingBox,this.loadAllMaterials=(l=e.loadAllMaterials)!==null&&l!==void 0?l:this.loadAllMaterials,this.loadOnlyMaterials=(f=e.loadOnlyMaterials)!==null&&f!==void 0?f:this.loadOnlyMaterials,this.skipMaterials=(p=e.skipMaterials)!==null&&p!==void 0?p:this.skipMaterials,this.useSRGBBuffers=(v=e.useSRGBBuffers)!==null&&v!==void 0?v:this.useSRGBBuffers,this.targetFps=(g=e.targetFps)!==null&&g!==void 0?g:this.targetFps,this.alwaysComputeSkeletonRootNode=(b=e.alwaysComputeSkeletonRootNode)!==null&&b!==void 0?b:this.alwaysComputeSkeletonRootNode,this.useGltfTextureNames=(w=e.useGltfTextureNames)!==null&&w!==void 0?w:this.useGltfTextureNames,this.preprocessUrlAsync=(A=e.preprocessUrlAsync)!==null&&A!==void 0?A:this.preprocessUrlAsync,this.customRootNode=e.customRootNode,this.onMeshLoaded=e.onMeshLoaded,this.onSkinLoaded=e.onSkinLoaded,this.onTextureLoaded=e.onTextureLoaded,this.onMaterialLoaded=e.onMaterialLoaded,this.onCameraLoaded=e.onCameraLoaded,this.extensionOptions=(E=e.extensionOptions)!==null&&E!==void 0?E:this.extensionOptions)},r}());(0,c.RegisterSceneLoaderPlugin)(new we),function(r){r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.FLOAT=5126]="FLOAT"}(Le||(Le={})),function(r){r[r.FRAGMENT=35632]="FRAGMENT",r[r.VERTEX=35633]="VERTEX"}(ft||(ft={})),function(r){r[r.BYTE=5120]="BYTE",r[r.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",r[r.SHORT=5122]="SHORT",r[r.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",r[r.INT=5124]="INT",r[r.UNSIGNED_INT=5125]="UNSIGNED_INT",r[r.FLOAT=5126]="FLOAT",r[r.FLOAT_VEC2=35664]="FLOAT_VEC2",r[r.FLOAT_VEC3=35665]="FLOAT_VEC3",r[r.FLOAT_VEC4=35666]="FLOAT_VEC4",r[r.INT_VEC2=35667]="INT_VEC2",r[r.INT_VEC3=35668]="INT_VEC3",r[r.INT_VEC4=35669]="INT_VEC4",r[r.BOOL=35670]="BOOL",r[r.BOOL_VEC2=35671]="BOOL_VEC2",r[r.BOOL_VEC3=35672]="BOOL_VEC3",r[r.BOOL_VEC4=35673]="BOOL_VEC4",r[r.FLOAT_MAT2=35674]="FLOAT_MAT2",r[r.FLOAT_MAT3=35675]="FLOAT_MAT3",r[r.FLOAT_MAT4=35676]="FLOAT_MAT4",r[r.SAMPLER_2D=35678]="SAMPLER_2D"}(_e||(_e={})),function(r){r[r.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",r[r.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",r[r.REPEAT=10497]="REPEAT"}(He||(He={})),function(r){r[r.NEAREST=9728]="NEAREST",r[r.LINEAR=9728]="LINEAR",r[r.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",r[r.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",r[r.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",r[r.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"}(Te||(Te={})),function(r){r[r.ALPHA=6406]="ALPHA",r[r.RGB=6407]="RGB",r[r.RGBA=6408]="RGBA",r[r.LUMINANCE=6409]="LUMINANCE",r[r.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA"}(tn||(tn={})),function(r){r[r.FRONT=1028]="FRONT",r[r.BACK=1029]="BACK",r[r.FRONT_AND_BACK=1032]="FRONT_AND_BACK"}(dt||(dt={})),function(r){r[r.ZERO=0]="ZERO",r[r.ONE=1]="ONE",r[r.SRC_COLOR=768]="SRC_COLOR",r[r.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",r[r.DST_COLOR=774]="DST_COLOR",r[r.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",r[r.SRC_ALPHA=770]="SRC_ALPHA",r[r.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",r[r.DST_ALPHA=772]="DST_ALPHA",r[r.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",r[r.CONSTANT_COLOR=32769]="CONSTANT_COLOR",r[r.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",r[r.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",r[r.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",r[r.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}($||($={}));var Se,ye=function(){function r(){}return r.SetMatrix=function(e,t,n,o,a){var s=null;if(n.semantic==="MODEL"?s=t.getWorldMatrix():n.semantic==="PROJECTION"?s=e.getProjectionMatrix():n.semantic==="VIEW"?s=e.getViewMatrix():n.semantic==="MODELVIEWINVERSETRANSPOSE"?s=c.Matrix.Transpose(t.getWorldMatrix().multiply(e.getViewMatrix()).invert()):n.semantic==="MODELVIEW"?s=t.getWorldMatrix().multiply(e.getViewMatrix()):n.semantic==="MODELVIEWPROJECTION"?s=t.getWorldMatrix().multiply(e.getTransformMatrix()):n.semantic==="MODELINVERSE"?s=t.getWorldMatrix().invert():n.semantic==="VIEWINVERSE"?s=e.getViewMatrix().invert():n.semantic==="PROJECTIONINVERSE"?s=e.getProjectionMatrix().invert():n.semantic==="MODELVIEWINVERSE"?s=t.getWorldMatrix().multiply(e.getViewMatrix()).invert():n.semantic==="MODELVIEWPROJECTIONINVERSE"?s=t.getWorldMatrix().multiply(e.getTransformMatrix()).invert():n.semantic==="MODELINVERSETRANSPOSE"&&(s=c.Matrix.Transpose(t.getWorldMatrix().invert())),s)switch(n.type){case _e.FLOAT_MAT2:a.setMatrix2x2(o,c.Matrix.GetAsMatrix2x2(s));break;case _e.FLOAT_MAT3:a.setMatrix3x3(o,c.Matrix.GetAsMatrix3x3(s));break;case _e.FLOAT_MAT4:a.setMatrix(o,s)}},r.SetUniform=function(e,t,n,o){switch(o){case _e.FLOAT:return e.setFloat(t,n),!0;case _e.FLOAT_VEC2:return e.setVector2(t,c.Vector2.FromArray(n)),!0;case _e.FLOAT_VEC3:return e.setVector3(t,c.Vector3.FromArray(n)),!0;case _e.FLOAT_VEC4:return e.setVector4(t,c.Vector4.FromArray(n)),!0;default:return!1}},r.GetWrapMode=function(e){switch(e){case He.CLAMP_TO_EDGE:return c.Texture.CLAMP_ADDRESSMODE;case He.MIRRORED_REPEAT:return c.Texture.MIRROR_ADDRESSMODE;case He.REPEAT:default:return c.Texture.WRAP_ADDRESSMODE}},r.GetByteStrideFromType=function(e){switch(e.type){case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16;default:return 1}},r.GetTextureFilterMode=function(e){switch(e){case Te.LINEAR:case Te.LINEAR_MIPMAP_NEAREST:case Te.LINEAR_MIPMAP_LINEAR:return c.Texture.TRILINEAR_SAMPLINGMODE;case Te.NEAREST:case Te.NEAREST_MIPMAP_NEAREST:return c.Texture.NEAREST_SAMPLINGMODE;default:return c.Texture.BILINEAR_SAMPLINGMODE}},r.GetBufferFromBufferView=function(e,t,n,o,a){n=t.byteOffset+n;var s=e.loadedBufferViews[t.buffer];if(n+o>s.byteLength)throw new Error("Buffer access is out of range");var i=s.buffer;switch(n+=s.byteOffset,a){case Le.BYTE:return new Int8Array(i,n,o);case Le.UNSIGNED_BYTE:return new Uint8Array(i,n,o);case Le.SHORT:return new Int16Array(i,n,o);case Le.UNSIGNED_SHORT:return new Uint16Array(i,n,o);default:return new Float32Array(i,n,o)}},r.GetBufferFromAccessor=function(e,t){var n=e.bufferViews[t.bufferView],o=t.count*r.GetByteStrideFromType(t);return r.GetBufferFromBufferView(e,n,t.byteOffset,o,t.componentType)},r.DecodeBufferToText=function(e){for(var t="",n=e.byteLength,o=0;o<n;++o)t+=String.fromCharCode(e[o]);return t},r.GetDefaultMaterial=function(e){if(!r._DefaultMaterial){c.Effect.ShadersStore.GLTFDefaultMaterialVertexShader=["precision highp float;","","uniform mat4 worldView;","uniform mat4 projection;","","attribute vec3 position;","","void main(void)","{","    gl_Position = projection * worldView * vec4(position, 1.0);","}"].join(`
`),c.Effect.ShadersStore.GLTFDefaultMaterialPixelShader=["precision highp float;","","uniform vec4 u_emission;","","void main(void)","{","    gl_FragColor = u_emission;","}"].join(`
`);var t={attributes:["position"],uniforms:["worldView","projection","u_emission"],samplers:new Array,needAlphaBlending:!1};r._DefaultMaterial=new c.ShaderMaterial("GLTFDefaultMaterial",e,{vertex:"GLTFDefaultMaterial",fragment:"GLTFDefaultMaterial"},t),r._DefaultMaterial.setColor4("u_emission",new c.Color4(.5,.5,.5,1))}return r._DefaultMaterial},r._DefaultMaterial=null,r}();(function(r){r[r.IDENTIFIER=1]="IDENTIFIER",r[r.UNKNOWN=2]="UNKNOWN",r[r.END_OF_INPUT=3]="END_OF_INPUT"})(Se||(Se={}));var Mr=function(){function r(e){this._pos=0,this.currentToken=Se.UNKNOWN,this.currentIdentifier="",this.currentString="",this.isLetterOrDigitPattern=/^[a-zA-Z0-9]+$/,this._toParse=e,this._maxPos=e.length}return r.prototype.getNextToken=function(){if(this.isEnd())return Se.END_OF_INPUT;if(this.currentString=this.read(),this.currentToken=Se.UNKNOWN,this.currentString==="_"||this.isLetterOrDigitPattern.test(this.currentString))for(this.currentToken=Se.IDENTIFIER,this.currentIdentifier=this.currentString;!this.isEnd()&&(this.isLetterOrDigitPattern.test(this.currentString=this.peek())||this.currentString==="_");)this.currentIdentifier+=this.currentString,this.forward();return this.currentToken},r.prototype.peek=function(){return this._toParse[this._pos]},r.prototype.read=function(){return this._toParse[this._pos++]},r.prototype.forward=function(){this._pos++},r.prototype.isEnd=function(){return this._pos>=this._maxPos},r}(),Cr=["MODEL","VIEW","PROJECTION","MODELVIEW","MODELVIEWPROJECTION","JOINTMATRIX"],Lr=["world","view","projection","worldView","worldViewProjection","mBones"],to=["translation","rotation","scale"],no=["position","rotationQuaternion","scaling"],ve=function(r,e,t){for(var n in r){var o=r[n];t[e][n]=o}},ro=function(r){if(r)for(var e=0;e<r.length/2;e++)r[2*e+1]=1-r[2*e+1]},Rr=function(r){if(r.semantic==="NORMAL")return"normal";if(r.semantic==="POSITION")return"position";if(r.semantic==="JOINT")return"matricesIndices";if(r.semantic==="WEIGHT")return"matricesWeights";if(r.semantic==="COLOR")return"color";if(r.semantic&&r.semantic.indexOf("TEXCOORD_")!==-1){var e=Number(r.semantic.split("_")[1]);return"uv"+(e===0?"":e+1)}return null},nn=function(r){var e=null;if(r.translation||r.rotation||r.scale){var t=c.Vector3.FromArray(r.scale||[1,1,1]),n=c.Quaternion.FromArray(r.rotation||[0,0,0,1]),o=c.Vector3.FromArray(r.translation||[0,0,0]);e=c.Matrix.Compose(t,n,o)}else e=c.Matrix.FromArray(r.matrix);return e},Fr=function(r,e,t,n){for(var o=0;o<n.bones.length;o++)if(n.bones[o].name===t)return n.bones[o];var a=r.nodes;for(var s in a){var i=a[s];if(i.jointName){var u=i.children;for(o=0;o<u.length;o++){var d=r.nodes[u[o]];if(d.jointName&&d.jointName===t){var h=nn(i),m=new c.Bone(i.name||"",n,Fr(r,e,i.jointName,n),h);return m.id=s,m}}}}return null},oo=function(r,e){for(var t=0;t<r.length;t++)for(var n=r[t],o=0;o<n.node.children.length;o++)if(n.node.children[o]===e)return n.bone;return null},rn=function(r,e){var t=r.nodes,n=t[e];if(n)return{node:n,id:e};for(var o in t)if((n=t[o]).jointName===e)return{node:n,id:o};return null},ao=function(r,e){for(var t=0;t<r.jointNames.length;t++)if(r.jointNames[t]===e)return!0;return!1},Nr=function(r,e,t,n,o){if(o||(r.scene._blockEntityCollection=!!r.assetContainer,(o=new c.Mesh(e.name||"",r.scene))._parentContainer=r.assetContainer,r.scene._blockEntityCollection=!1,o.id=n),!e.babylonNode)return o;for(var a,s=[],i=null,u=[],d=[],h=[],m=[],_=0;_<t.length;_++){var y=t[_];if(B=r.meshes[y])for(var l=0;l<B.primitives.length;l++){var f=new c.VertexData,p=B.primitives[l];p.mode;var v=p.attributes,g=null,b=null;for(var w in v)if(g=r.accessors[v[w]],b=ye.GetBufferFromAccessor(r,g),w==="NORMAL")f.normals=new Float32Array(b.length),f.normals.set(b);else if(w==="POSITION"){if(we.HomogeneousCoordinates){f.positions=new Float32Array(b.length-b.length/4);for(var A=0;A<b.length;A+=4)f.positions[A]=b[A],f.positions[A+1]=b[A+1],f.positions[A+2]=b[A+2]}else f.positions=new Float32Array(b.length),f.positions.set(b);d.push(f.positions.length)}else if(w.indexOf("TEXCOORD_")!==-1){var E=Number(w.split("_")[1]),R=c.VertexBuffer.UVKind+(E===0?"":E+1),O=new Float32Array(b.length);O.set(b),ro(O),f.set(O,R)}else w==="JOINT"?(f.matricesIndices=new Float32Array(b.length),f.matricesIndices.set(b)):w==="WEIGHT"?(f.matricesWeights=new Float32Array(b.length),f.matricesWeights.set(b)):w==="COLOR"&&(f.colors=new Float32Array(b.length),f.colors.set(b));if(g=r.accessors[p.indices])b=ye.GetBufferFromAccessor(r,g),f.indices=new Int32Array(b.length),f.indices.set(b),m.push(f.indices.length);else{var I=[];for(A=0;A<f.positions.length/3;A++)I.push(A);f.indices=new Int32Array(I),m.push(f.indices.length)}i?i.merge(f):i=f;var L=r.scene.getMaterialById(p.material);s.push(L===null?ye.GetDefaultMaterial(r.scene):L),u.push(u.length===0?0:u[u.length-1]+d[d.length-2]),h.push(h.length===0?0:h[h.length-1]+m[m.length-2])}}r.scene._blockEntityCollection=!!r.assetContainer,s.length>1?(a=new c.MultiMaterial("multimat"+n,r.scene)).subMaterials=s:a=new c.StandardMaterial("multimat"+n,r.scene),s.length===1&&(a=s[0]),a._parentContainer=r.assetContainer,o.material||(o.material=a),new c.Geometry(n,r.scene,i,!1,o),o.computeWorldMatrix(!0),r.scene._blockEntityCollection=!1,o.subMeshes=[];var S=0;for(_=0;_<t.length;_++){var B;if(y=t[_],B=r.meshes[y])for(l=0;l<B.primitives.length;l++)B.primitives[l].mode,c.SubMesh.AddToMesh(S,u[S],d[S],h[S],m[S],o,o,!0),S++}return o},on=function(r,e,t,n){r.position&&(r.position=e),(r.rotationQuaternion||r.rotation)&&(r.rotationQuaternion=t),r.scaling&&(r.scaling=n)},io=function(r,e,t){var n=null;if(r.importOnlyMeshes&&(e.skin||e.meshes)&&r.importMeshesNames&&r.importMeshesNames.length>0&&r.importMeshesNames.indexOf(e.name||"")===-1)return null;if(e.skin){if(e.meshes){var o=r.skins[e.skin];(a=Nr(r,e,e.meshes,t,e.babylonNode)).skeleton=r.scene.getLastSkeletonById(e.skin),a.skeleton===null&&(a.skeleton=function(R,O,I,L){if(L||(L=new c.Skeleton(O.name||"","",R.scene)),!O.babylonSkeleton)return L;var S=[],B=[];(function(Q,oe,k,j){for(var xe in Q.nodes){var le=Q.nodes[xe],Oe=xe;if(le.jointName&&!ao(k,le.jointName)){var ne=nn(le),X=new c.Bone(le.name||"",oe,null,ne);X.id=Oe,j.push({bone:X,node:le,id:Oe})}}for(var ae=0;ae<j.length;ae++)for(var ue=j[ae],de=ue.node.children,he=0;he<de.length;he++){for(var fe=null,ge=0;ge<j.length;ge++)if(j[ge].id===de[he]){fe=j[ge];break}fe&&(fe.bone._parent=ue.bone,ue.bone.children.push(fe.bone))}})(R,L,O,S),L.bones=[];for(var P=0;P<O.jointNames.length;P++)if(J=rn(R,O.jointNames[P])){var re=J.node;if(re){var U=J.id,W=R.scene.getBoneById(U);if(W)L.bones.push(W);else{for(var F=!1,K=null,Y=0;Y<P;Y++){var ie=rn(R,O.jointNames[Y]);if(ie){var z=ie.node;if(z){var ee=z.children;if(ee){F=!1;for(var te=0;te<ee.length;te++)if(ee[te]===U){K=Fr(R,O,O.jointNames[Y],L),F=!0;break}if(F)break}}else c.Tools.Warn("Joint named "+O.jointNames[Y]+" does not exist when looking for parent")}}var se=nn(re);!K&&S.length>0&&(K=oo(S,U))&&B.indexOf(K)===-1&&B.push(K),new c.Bone(re.jointName||"",L,K,se).id=U}}else c.Tools.Warn("Joint named "+O.jointNames[P]+" does not exist")}var D=L.bones;for(L.bones=[],P=0;P<O.jointNames.length;P++){var J;if(J=rn(R,O.jointNames[P])){for(Y=0;Y<D.length;Y++)if(D[Y].id===J.id){L.bones.push(D[Y]);break}}}for(L.prepare(),P=0;P<B.length;P++)L.bones.push(B[P]);return L}(r,o,0,o.babylonSkeleton),o.babylonSkeleton||(o.babylonSkeleton=a.skeleton)),n=a}}else if(e.meshes){var a;n=a=Nr(r,e,e.mesh?[e.mesh]:e.meshes,t,e.babylonNode)}else if(!e.light||e.babylonNode||r.importOnlyMeshes){if(e.camera&&!e.babylonNode&&!r.importOnlyMeshes){var s=r.cameras[e.camera];if(s){if(r.scene._blockEntityCollection=!!r.assetContainer,s.type==="orthographic"){var i=new c.FreeCamera(e.camera,c.Vector3.Zero(),r.scene,!1);i.name=e.name||"",i.mode=c.Camera.ORTHOGRAPHIC_CAMERA,i.attachControl(),n=i,i._parentContainer=r.assetContainer}else if(s.type==="perspective"){var u=s[s.type],d=new c.FreeCamera(e.camera,c.Vector3.Zero(),r.scene,!1);d.name=e.name||"",d.attachControl(),u.aspectRatio||(u.aspectRatio=r.scene.getEngine().getRenderWidth()/r.scene.getEngine().getRenderHeight()),u.znear&&u.zfar&&(d.maxZ=u.zfar,d.minZ=u.znear),n=d,d._parentContainer=r.assetContainer}r.scene._blockEntityCollection=!1}}}else{var h=r.lights[e.light];if(h){if(h.type==="ambient"){var m=h[h.type],_=new c.HemisphericLight(e.light,c.Vector3.Zero(),r.scene);_.name=e.name||"",m.color&&(_.diffuse=c.Color3.FromArray(m.color)),n=_}else if(h.type==="directional"){var y=h[h.type],l=new c.DirectionalLight(e.light,c.Vector3.Zero(),r.scene);l.name=e.name||"",y.color&&(l.diffuse=c.Color3.FromArray(y.color)),n=l}else if(h.type==="point"){var f=h[h.type],p=new c.PointLight(e.light,c.Vector3.Zero(),r.scene);p.name=e.name||"",f.color&&(p.diffuse=c.Color3.FromArray(f.color)),n=p}else if(h.type==="spot"){var v=h[h.type],g=new c.SpotLight(e.light,c.Vector3.Zero(),c.Vector3.Zero(),0,0,r.scene);g.name=e.name||"",v.color&&(g.diffuse=c.Color3.FromArray(v.color)),v.fallOfAngle&&(g.angle=v.fallOfAngle),v.fallOffExponent&&(g.exponent=v.fallOffExponent),n=g}}}if(!e.jointName){if(e.babylonNode)return e.babylonNode;if(n===null){r.scene._blockEntityCollection=!!r.assetContainer;var b=new c.Mesh(e.name||"",r.scene);b._parentContainer=r.assetContainer,r.scene._blockEntityCollection=!1,e.babylonNode=b,n=b}}if(n!==null){if(e.matrix&&n instanceof c.Mesh)(function(R,O){if(O.matrix){var I=new c.Vector3(0,0,0),L=new c.Quaternion,S=new c.Vector3(0,0,0);c.Matrix.FromArray(O.matrix).decompose(S,L,I),on(R,I,L,S)}else O.translation&&O.rotation&&O.scale&&on(R,c.Vector3.FromArray(O.translation),c.Quaternion.FromArray(O.rotation),c.Vector3.FromArray(O.scale));R.computeWorldMatrix(!0)})(n,e);else{var w=e.translation||[0,0,0],A=e.rotation||[0,0,0,1],E=e.scale||[1,1,1];on(n,c.Vector3.FromArray(w),c.Quaternion.FromArray(A),c.Vector3.FromArray(E))}n.updateCache(!0),e.babylonNode=n}return n},Xe=function(r,e,t,n){n===void 0&&(n=!1);var o=r.nodes[e],a=null;if(n=!(r.importOnlyMeshes&&!n&&r.importMeshesNames)||r.importMeshesNames.indexOf(o.name||"")!==-1||r.importMeshesNames.length===0,!o.jointName&&n&&(a=io(r,o,e))!==null&&(a.id=e,a.parent=t),o.children)for(var s=0;s<o.children.length;s++)Xe(r,o.children[s],a,n)},Pr=function(r){var e=r.currentScene;if(e)for(var t=0;t<e.nodes.length;t++)Xe(r,e.nodes[t],null);else for(var n in r.scenes)for(e=r.scenes[n],t=0;t<e.nodes.length;t++)Xe(r,e.nodes[t],null);for(function(a){for(var s in a.animations){var i=a.animations[s];if(i.channels&&i.samplers)for(var u=null,d=0;d<i.channels.length;d++){var h=i.channels[d],m=i.samplers[h.sampler];if(m){var _=null,y=null;i.parameters?(_=i.parameters[m.input],y=i.parameters[m.output]):(_=m.input,y=m.output);var l=ye.GetBufferFromAccessor(a,a.accessors[_]),f=ye.GetBufferFromAccessor(a,a.accessors[y]),p=h.target.id,v=a.scene.getNodeById(p);if(v===null&&(v=a.scene.getNodeByName(p)),v!==null){var g=v instanceof c.Bone,b=h.target.path,w=to.indexOf(b);w!==-1&&(b=no[w]);var A=c.Animation.ANIMATIONTYPE_MATRIX;g||(b==="rotationQuaternion"?(A=c.Animation.ANIMATIONTYPE_QUATERNION,v.rotationQuaternion=new c.Quaternion):A=c.Animation.ANIMATIONTYPE_VECTOR3);var E=null,R=[],O=0,I=!1;g&&u&&u.getKeys().length===l.length&&(E=u,I=!0),I||(a.scene._blockEntityCollection=!!a.assetContainer,E=new c.Animation(s,g?"_matrix":b,1,A,c.Animation.ANIMATIONLOOPMODE_CYCLE),a.scene._blockEntityCollection=!1);for(var L=0;L<l.length;L++){var S=null;if(b==="rotationQuaternion"?(S=c.Quaternion.FromArray([f[O],f[O+1],f[O+2],f[O+3]]),O+=4):(S=c.Vector3.FromArray([f[O],f[O+1],f[O+2]]),O+=3),g){var B=v,P=c.Vector3.Zero(),re=new c.Quaternion,U=c.Vector3.Zero(),W=B.getBaseMatrix();I&&u&&(W=u.getKeys()[L].value),W.decompose(U,re,P),b==="position"?P=S:b==="rotationQuaternion"?re=S:U=S,S=c.Matrix.Compose(U,re,P)}I?u&&(u.getKeys()[L].value=S):R.push({frame:l[L],value:S})}!I&&E&&(E.setKeys(R),v.animations.push(E)),u=E,a.scene.stopAnimation(v),a.scene.beginAnimation(v,0,l[l.length-1],!0,1)}else c.Tools.Warn("Creating animation named "+s+". But cannot find node named "+p+" to attach to")}}}}(r),t=0;t<r.scene.skeletons.length;t++){var o=r.scene.skeletons[t];r.scene.beginAnimation(o,0,Number.MAX_VALUE,!0,1)}},Ir=function(r,e,t){for(var n in e.uniforms){var o=e.uniforms[n],a=e.parameters[o];if(r.currentIdentifier===n&&a.semantic&&!a.source&&!a.node){var s=Cr.indexOf(a.semantic);if(s!==-1)return delete t[n],Lr[s]}}return r.currentIdentifier},Sr=function(r){for(var e in r.materials)Ce.LoadMaterialAsync(r,e,function(){},function(){})},Me=function(){function r(){}return r.CreateRuntime=function(e,t,n){var o={extensions:{},accessors:{},buffers:{},bufferViews:{},meshes:{},lights:{},cameras:{},nodes:{},images:{},textures:{},shaders:{},programs:{},samplers:{},techniques:{},materials:{},animations:{},skins:{},extensionsUsed:[],scenes:{},buffersCount:0,shaderscount:0,scene:t,rootUrl:n,loadedBufferCount:0,loadedBufferViews:{},loadedShaderCount:0,importOnlyMeshes:!1,dummyNodes:[],assetContainer:null};return e.extensions&&ve(e.extensions,"extensions",o),e.extensionsUsed&&ve(e.extensionsUsed,"extensionsUsed",o),e.buffers&&function(a,s){for(var i in a){var u=a[i];s.buffers[i]=u,s.buffersCount++}}(e.buffers,o),e.bufferViews&&ve(e.bufferViews,"bufferViews",o),e.accessors&&ve(e.accessors,"accessors",o),e.meshes&&ve(e.meshes,"meshes",o),e.lights&&ve(e.lights,"lights",o),e.cameras&&ve(e.cameras,"cameras",o),e.nodes&&ve(e.nodes,"nodes",o),e.images&&ve(e.images,"images",o),e.textures&&ve(e.textures,"textures",o),e.shaders&&function(a,s){for(var i in a){var u=a[i];s.shaders[i]=u,s.shaderscount++}}(e.shaders,o),e.programs&&ve(e.programs,"programs",o),e.samplers&&ve(e.samplers,"samplers",o),e.techniques&&ve(e.techniques,"techniques",o),e.materials&&ve(e.materials,"materials",o),e.animations&&ve(e.animations,"animations",o),e.skins&&ve(e.skins,"skins",o),e.scenes&&(o.scenes=e.scenes),e.scene&&e.scenes&&(o.currentScene=e.scenes[e.scene]),o},r.LoadBufferAsync=function(e,t,n,o,a){var s=e.buffers[t];c.Tools.IsBase64(s.uri)?setTimeout(function(){return n(new Uint8Array(c.Tools.DecodeBase64(s.uri)))}):c.Tools.LoadFile(e.rootUrl+s.uri,function(i){return n(new Uint8Array(i))},a,void 0,!0,function(i){i&&o(i.status+" "+i.statusText)})},r.LoadTextureBufferAsync=function(e,t,n,o){var a=e.textures[t];if(a&&a.source)if(a.babylonTexture)n(null);else{var s=e.images[a.source];c.Tools.IsBase64(s.uri)?setTimeout(function(){return n(new Uint8Array(c.Tools.DecodeBase64(s.uri)))}):c.Tools.LoadFile(e.rootUrl+s.uri,function(i){return n(new Uint8Array(i))},void 0,void 0,!0,function(i){i&&o(i.status+" "+i.statusText)})}else o("")},r.CreateTextureAsync=function(e,t,n,o){var a=e.textures[t];if(a.babylonTexture)o(a.babylonTexture);else{var s=e.samplers[a.sampler],i=s.minFilter===Te.NEAREST_MIPMAP_NEAREST||s.minFilter===Te.NEAREST_MIPMAP_LINEAR||s.minFilter===Te.LINEAR_MIPMAP_NEAREST||s.minFilter===Te.LINEAR_MIPMAP_LINEAR,u=c.Texture.BILINEAR_SAMPLINGMODE,d=n==null?new Blob:new Blob([n]),h=URL.createObjectURL(d),m=function(){return URL.revokeObjectURL(h)},_=new c.Texture(h,e.scene,!i,!0,u,m,m);s.wrapS!==void 0&&(_.wrapU=ye.GetWrapMode(s.wrapS)),s.wrapT!==void 0&&(_.wrapV=ye.GetWrapMode(s.wrapT)),_.name=t,a.babylonTexture=_,o(_)}},r.LoadShaderStringAsync=function(e,t,n,o){var a=e.shaders[t];if(c.Tools.IsBase64(a.uri)){var s=atob(a.uri.split(",")[1]);n&&n(s)}else c.Tools.LoadFile(e.rootUrl+a.uri,n,void 0,void 0,!1,function(i){i&&o&&o(i.status+" "+i.statusText)})},r.LoadMaterialAsync=function(e,t,n,o){var a=e.materials[t];if(a.technique){var s=e.techniques[a.technique];if(!s){e.scene._blockEntityCollection=!!e.assetContainer;var i=new c.StandardMaterial(t,e.scene);return i._parentContainer=e.assetContainer,e.scene._blockEntityCollection=!1,i.diffuseColor=new c.Color3(.5,.5,.5),i.sideOrientation=c.Material.CounterClockWiseSideOrientation,void n(i)}var u=e.programs[s.program],d=s.states,h=c.Effect.ShadersStore[u.vertexShader+"VertexShader"],m=c.Effect.ShadersStore[u.fragmentShader+"PixelShader"],_="",y="",l=new Mr(h),f=new Mr(m),p={},v=[],g=[],b=[];for(var w in s.uniforms){var A=s.uniforms[w],E=s.parameters[A];if(p[w]=E,!E.semantic||E.node||E.source)E.type===_e.SAMPLER_2D?b.push(w):v.push(w);else{var R=Cr.indexOf(E.semantic);R!==-1?(v.push(Lr[R]),delete p[w]):v.push(w)}}for(var O in s.attributes){var I=s.attributes[O];if((B=s.parameters[I]).semantic){var L=Rr(B);L&&g.push(L)}}for(;!l.isEnd()&&l.getNextToken();)if(l.currentToken===Se.IDENTIFIER){var S=!1;for(var O in s.attributes){I=s.attributes[O];var B=s.parameters[I];if(l.currentIdentifier===O&&B.semantic){_+=Rr(B),S=!0;break}}S||(_+=Ir(l,s,p))}else _+=l.currentString;for(;!f.isEnd()&&f.getNextToken();)f.currentToken===Se.IDENTIFIER?y+=Ir(f,s,p):y+=f.currentString;var P={vertex:u.vertexShader+t,fragment:u.fragmentShader+t},re={attributes:g,uniforms:v,samplers:b,needAlphaBlending:d&&d.enable&&d.enable.indexOf(3042)!==-1};c.Effect.ShadersStore[u.vertexShader+t+"VertexShader"]=_,c.Effect.ShadersStore[u.fragmentShader+t+"PixelShader"]=y;var U=new c.ShaderMaterial(t,e.scene,P,re);if(U.onError=function(K,Y,ie){return function(z,ee){Y.dispose(!0),ie("Cannot compile program named "+K.name+". Error: "+ee+". Default material will be applied")}}(u,U,o),U.onCompiled=function(K,Y,ie,z,ee,te){return function(se){(function(D,J,Q,oe,k){var j=oe.values||Q.parameters,xe=Q.uniforms,le=function(ne){var X=k[ne],ae=X.type,ue=j[xe[ne]];if(ue===void 0&&(ue=X.value),!ue)return"continue";var de=function(he){return function(fe){X.value&&he&&(J.setTexture(he,fe),delete k[he])}};ae===_e.SAMPLER_2D?Ce.LoadTextureAsync(D,oe.values?ue:X.value,de(ne),function(){return de(null)}):X.value&&ye.SetUniform(J,ne,oe.values?ue:X.value,ae)&&delete k[ne]};for(var Oe in k)le(Oe)})(K,Y,ie,z,ee),Y.onBind=function(D){(function(J,Q,oe,k,j,xe,le){var Oe=xe.values||j.parameters;for(var ne in oe){var X=oe[ne],ae=X.type;if(ae===_e.FLOAT_MAT2||ae===_e.FLOAT_MAT3||ae===_e.FLOAT_MAT4)if(!X.semantic||X.source||X.node){if(X.semantic&&(X.source||X.node)){var ue=Q.scene.getNodeByName(X.source||X.node||"");if(ue===null&&(ue=Q.scene.getNodeById(X.source||X.node||"")),ue===null)continue;ye.SetMatrix(Q.scene,ue,X,ne,k.getEffect())}}else ye.SetMatrix(Q.scene,J,X,ne,k.getEffect());else{var de=Oe[j.uniforms[ne]];if(!de)continue;if(ae===_e.SAMPLER_2D){var he=Q.textures[xe.values?de:X.value].babylonTexture;if(he==null)continue;k.getEffect().setTexture(ne,he)}else ye.SetUniform(k.getEffect(),ne,de,ae)}}le(k)})(D,K,ee,Y,ie,z,te)}}}(e,U,s,a,p,n),U.sideOrientation=c.Material.CounterClockWiseSideOrientation,d&&d.functions){var W=d.functions;W.cullFace&&W.cullFace[0]!==dt.BACK&&(U.backFaceCulling=!1);var F=W.blendFuncSeparate;F&&(F[0]===$.SRC_ALPHA&&F[1]===$.ONE_MINUS_SRC_ALPHA&&F[2]===$.ONE&&F[3]===$.ONE?U.alphaMode=c.Constants.ALPHA_COMBINE:F[0]===$.ONE&&F[1]===$.ONE&&F[2]===$.ZERO&&F[3]===$.ONE?U.alphaMode=c.Constants.ALPHA_ONEONE:F[0]===$.SRC_ALPHA&&F[1]===$.ONE&&F[2]===$.ZERO&&F[3]===$.ONE?U.alphaMode=c.Constants.ALPHA_ADD:F[0]===$.ZERO&&F[1]===$.ONE_MINUS_SRC_COLOR&&F[2]===$.ONE&&F[3]===$.ONE?U.alphaMode=c.Constants.ALPHA_SUBTRACT:F[0]===$.DST_COLOR&&F[1]===$.ZERO&&F[2]===$.ONE&&F[3]===$.ONE?U.alphaMode=c.Constants.ALPHA_MULTIPLY:F[0]===$.SRC_ALPHA&&F[1]===$.ONE_MINUS_SRC_COLOR&&F[2]===$.ONE&&F[3]===$.ONE&&(U.alphaMode=c.Constants.ALPHA_MAXIMIZED))}}else o&&o("No technique found.")},r}(),Ue=function(){function r(){}return r.RegisterExtension=function(e){r.Extensions[e.name]?c.Tools.Error('Tool with the same name "'+e.name+'" already exists'):r.Extensions[e.name]=e},r.prototype.dispose=function(){},r.prototype._importMeshAsync=function(e,t,n,o,a,s,i,u){var d=this;return t.useRightHandedSystem=!0,Ce.LoadRuntimeAsync(t,n,o,function(h){h.assetContainer=a,h.importOnlyMeshes=!0,e===""?h.importMeshesNames=[]:typeof e=="string"?h.importMeshesNames=[e]:!e||e instanceof Array?(h.importMeshesNames=[],c.Tools.Warn("Argument meshesNames must be of type string or string[]")):h.importMeshesNames=[e],d._createNodes(h);var m=[],_=[];for(var y in h.nodes){var l=h.nodes[y];l.babylonNode instanceof c.AbstractMesh&&m.push(l.babylonNode)}for(var f in h.skins){var p=h.skins[f];p.babylonSkeleton instanceof c.Skeleton&&_.push(p.babylonSkeleton)}d._loadBuffersAsync(h,function(){d._loadShadersAsync(h,function(){Sr(h),Pr(h),!we.IncrementalLoading&&s&&s(m,_)})}),we.IncrementalLoading&&s&&s(m,_)},u),!0},r.prototype.importMeshAsync=function(e,t,n,o,a,s){var i=this;return new Promise(function(u,d){i._importMeshAsync(e,t,o,a,n,function(h,m){u({meshes:h,particleSystems:[],skeletons:m,animationGroups:[],lights:[],transformNodes:[],geometries:[],spriteManagers:[]})},s,function(h){d(new Error(h))})})},r.prototype._loadAsync=function(e,t,n,o,a,s){var i=this;e.useRightHandedSystem=!0,Ce.LoadRuntimeAsync(e,t,n,function(u){Ce.LoadRuntimeExtensionsAsync(u,function(){i._createNodes(u),i._loadBuffersAsync(u,function(){i._loadShadersAsync(u,function(){Sr(u),Pr(u),we.IncrementalLoading||o()})}),we.IncrementalLoading&&o()},s)},s)},r.prototype.loadAsync=function(e,t,n,o){return(0,T.sH)(this,void 0,void 0,function(){var a=this;return(0,T.YH)(this,function(s){switch(s.label){case 0:return[4,new Promise(function(i,u){a._loadAsync(e,t,n,function(){i()},o,function(d){u(new Error(d))})})];case 1:return[2,s.sent()]}})})},r.prototype._loadShadersAsync=function(e,t){var n=!1,o=function(i,u){Ce.LoadShaderStringAsync(e,i,function(d){d instanceof ArrayBuffer||(e.loadedShaderCount++,d&&(c.Effect.ShadersStore[i+(u.type===ft.VERTEX?"VertexShader":"PixelShader")]=d),e.loadedShaderCount===e.shaderscount&&t())},function(){c.Tools.Error("Error when loading shader program named "+i+" located at "+u.uri)})};for(var a in e.shaders){n=!0;var s=e.shaders[a];s?o.bind(this,a,s)():c.Tools.Error("No shader named: "+a)}n||t()},r.prototype._loadBuffersAsync=function(e,t){var n=!1,o=function(i,u){Ce.LoadBufferAsync(e,i,function(d){e.loadedBufferCount++,d&&(d.byteLength!=e.buffers[i].byteLength&&c.Tools.Error("Buffer named "+i+" is length "+d.byteLength+". Expected: "+u.byteLength),e.loadedBufferViews[i]=d),e.loadedBufferCount===e.buffersCount&&t()},function(){c.Tools.Error("Error when loading buffer named "+i+" located at "+u.uri)})};for(var a in e.buffers){n=!0;var s=e.buffers[a];s?o.bind(this,a,s)():c.Tools.Error("No buffer named: "+a)}n||t()},r.prototype._createNodes=function(e){var t=e.currentScene;if(t)for(var n=0;n<t.nodes.length;n++)Xe(e,t.nodes[n],null);else for(var o in e.scenes)for(t=e.scenes[o],n=0;n<t.nodes.length;n++)Xe(e,t.nodes[n],null)},r.Extensions={},r}(),Ce=function(){function r(e){this._name=e}return Object.defineProperty(r.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),r.prototype.loadRuntimeAsync=function(e,t,n,o,a){return!1},r.prototype.loadRuntimeExtensionsAsync=function(e,t,n){return!1},r.prototype.loadBufferAsync=function(e,t,n,o,a){return!1},r.prototype.loadTextureBufferAsync=function(e,t,n,o){return!1},r.prototype.createTextureAsync=function(e,t,n,o,a){return!1},r.prototype.loadShaderStringAsync=function(e,t,n,o){return!1},r.prototype.loadMaterialAsync=function(e,t,n,o){return!1},r.LoadRuntimeAsync=function(e,t,n,o,a){r._ApplyExtensions(function(s){return s.loadRuntimeAsync(e,t,n,o,a)},function(){setTimeout(function(){o&&o(Me.CreateRuntime(t.json,e,n))})})},r.LoadRuntimeExtensionsAsync=function(e,t,n){r._ApplyExtensions(function(o){return o.loadRuntimeExtensionsAsync(e,t,n)},function(){setTimeout(function(){t()})})},r.LoadBufferAsync=function(e,t,n,o,a){r._ApplyExtensions(function(s){return s.loadBufferAsync(e,t,n,o,a)},function(){Me.LoadBufferAsync(e,t,n,o,a)})},r.LoadTextureAsync=function(e,t,n,o){r._LoadTextureBufferAsync(e,t,function(a){a&&r._CreateTextureAsync(e,t,a,n,o)},o)},r.LoadShaderStringAsync=function(e,t,n,o){r._ApplyExtensions(function(a){return a.loadShaderStringAsync(e,t,n,o)},function(){Me.LoadShaderStringAsync(e,t,n,o)})},r.LoadMaterialAsync=function(e,t,n,o){r._ApplyExtensions(function(a){return a.loadMaterialAsync(e,t,n,o)},function(){Me.LoadMaterialAsync(e,t,n,o)})},r._LoadTextureBufferAsync=function(e,t,n,o){r._ApplyExtensions(function(a){return a.loadTextureBufferAsync(e,t,n,o)},function(){Me.LoadTextureBufferAsync(e,t,n,o)})},r._CreateTextureAsync=function(e,t,n,o,a){r._ApplyExtensions(function(s){return s.createTextureAsync(e,t,n,o,a)},function(){Me.CreateTextureAsync(e,t,n,o)})},r._ApplyExtensions=function(e,t){for(var n in Ue.Extensions)if(e(Ue.Extensions[n]))return;t()},r}();we._CreateGLTF1Loader=function(){return new Ue};var Br=function(r){function e(){return r.call(this,"KHR_binary_glTF")||this}return(0,T.C6)(e,r),e.prototype.loadRuntimeAsync=function(t,n,o,a){var s=n.json.extensionsUsed;return!(!s||s.indexOf(this.name)===-1||!n.bin||(this._bin=n.bin,a(Me.CreateRuntime(n.json,t,o)),0))},e.prototype.loadBufferAsync=function(t,n,o,a){return t.extensionsUsed.indexOf(this.name)!==-1&&n==="binary_glTF"&&(this._bin.readAsync(0,this._bin.byteLength).then(o,function(s){return a(s.message)}),!0)},e.prototype.loadTextureBufferAsync=function(t,n,o){var a=t.textures[n],s=t.images[a.source];if(!s.extensions||!(this.name in s.extensions))return!1;var i=s.extensions[this.name],u=t.bufferViews[i.bufferView];return o(ye.GetBufferFromBufferView(t,u,0,u.byteLength,Le.UNSIGNED_BYTE)),!0},e.prototype.loadShaderStringAsync=function(t,n,o){var a=t.shaders[n];if(!a.extensions||!(this.name in a.extensions))return!1;var s=a.extensions[this.name],i=t.bufferViews[s.bufferView],u=ye.GetBufferFromBufferView(t,i,0,i.byteLength,Le.UNSIGNED_BYTE);return setTimeout(function(){var d=ye.DecodeBufferToText(u);o(d)}),!0},e}(Ce);Ue.RegisterExtension(new Br);var kr=function(r){function e(){return r.call(this,"KHR_materials_common")||this}return(0,T.C6)(e,r),e.prototype.loadRuntimeExtensionsAsync=function(t){if(!t.extensions)return!1;var n=t.extensions[this.name];if(!n)return!1;var o=n.lights;if(o)for(var a in o){var s=o[a];switch(s.type){case"ambient":var i=new c.HemisphericLight(s.name,new c.Vector3(0,1,0),t.scene),u=s.ambient;u&&(i.diffuse=c.Color3.FromArray(u.color||[1,1,1]));break;case"point":var d=new c.PointLight(s.name,new c.Vector3(10,10,10),t.scene),h=s.point;h&&(d.diffuse=c.Color3.FromArray(h.color||[1,1,1]));break;case"directional":var m=new c.DirectionalLight(s.name,new c.Vector3(0,-1,0),t.scene),_=s.directional;_&&(m.diffuse=c.Color3.FromArray(_.color||[1,1,1]));break;case"spot":var y=s.spot;y&&(new c.SpotLight(s.name,new c.Vector3(0,10,0),new c.Vector3(0,-1,0),y.fallOffAngle||Math.PI,y.fallOffExponent||0,t.scene).diffuse=c.Color3.FromArray(y.color||[1,1,1]));break;default:c.Tools.Warn('GLTF Material Common extension: light type "'+s.type+"” not supported")}}return!1},e.prototype.loadMaterialAsync=function(t,n,o,a){var s=t.materials[n];if(!s||!s.extensions)return!1;var i=s.extensions[this.name];if(!i)return!1;var u=new c.StandardMaterial(n,t.scene);return u.sideOrientation=c.Material.CounterClockWiseSideOrientation,i.technique==="CONSTANT"&&(u.disableLighting=!0),u.backFaceCulling=i.doubleSided!==void 0&&!i.doubleSided,u.alpha=i.values.transparency===void 0?1:i.values.transparency,u.specularPower=i.values.shininess===void 0?0:i.values.shininess,typeof i.values.ambient=="string"?this._loadTexture(t,i.values.ambient,u,"ambientTexture",a):u.ambientColor=c.Color3.FromArray(i.values.ambient||[0,0,0]),typeof i.values.diffuse=="string"?this._loadTexture(t,i.values.diffuse,u,"diffuseTexture",a):u.diffuseColor=c.Color3.FromArray(i.values.diffuse||[0,0,0]),typeof i.values.emission=="string"?this._loadTexture(t,i.values.emission,u,"emissiveTexture",a):u.emissiveColor=c.Color3.FromArray(i.values.emission||[0,0,0]),typeof i.values.specular=="string"?this._loadTexture(t,i.values.specular,u,"specularTexture",a):u.specularColor=c.Color3.FromArray(i.values.specular||[0,0,0]),!0},e.prototype._loadTexture=function(t,n,o,a,s){Me.LoadTextureBufferAsync(t,n,function(i){Me.CreateTextureAsync(t,n,i,function(u){return o[a]=u})},s)},e}(Ce);Ue.RegisterExtension(new kr);var an=new Map,Gr=an;function H(r,e,t){G(r)&&c.Logger.Warn("Extension with the name '".concat(r,"' already exists")),an.set(r,{isGLTFExtension:e,factory:t})}function G(r){return an.delete(r)}var x=N(698),M=function(){function r(){}return r.Get=function(e,t,n){if(!t||n==null||!t[n])throw new Error("".concat(e,": Failed to find index (").concat(n,")"));return t[n]},r.TryGet=function(e,t){return e&&t!=null&&e[t]?e[t]:null},r.Assign=function(e){if(e)for(var t=0;t<e.length;t++)e[t].index=t},r}();function sn(r){if(r.min&&r.max){var e=r.min,t=r.max,n=c.TmpVectors.Vector3[0].copyFromFloats(e[0],e[1],e[2]),o=c.TmpVectors.Vector3[1].copyFromFloats(t[0],t[1],t[2]);if(r.normalized&&r.componentType!==5126){var a=1;switch(r.componentType){case 5120:a=127;break;case 5121:a=255;break;case 5122:a=32767;break;case 5123:a=65535}var s=1/a;n.scaleInPlace(s),o.scaleInPlace(s)}return new c.BoundingInfo(n,o)}return null}var V=function(){function r(e){this._completePromises=new Array,this._assetContainer=null,this._babylonLights=[],this._disableInstancedMesh=0,this._allMaterialsDirtyRequired=!1,this._skipStartAnimationStep=!1,this._extensions=new Array,this._disposed=!1,this._rootUrl=null,this._fileName=null,this._uniqueRootUrl=null,this._bin=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions=new Array,this._parent=e}return r.RegisterExtension=function(e,t){H(e,!1,t)},r.UnregisterExtension=function(e){return G(e)},Object.defineProperty(r.prototype,"gltf",{get:function(){if(!this._gltf)throw new Error("glTF JSON is not available");return this._gltf},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"bin",{get:function(){return this._bin},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"babylonScene",{get:function(){if(!this._babylonScene)throw new Error("Scene is not available");return this._babylonScene},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rootBabylonMesh",{get:function(){return this._rootBabylonMesh},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"rootUrl",{get:function(){return this._rootUrl},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){this._disposed||(this._disposed=!0,this._completePromises.length=0,this._extensions.forEach(function(e){return e.dispose&&e.dispose()}),this._extensions.length=0,this._gltf=null,this._bin=null,this._babylonScene=null,this._rootBabylonMesh=null,this._defaultBabylonMaterialData={},this._postSceneLoadActions.length=0,this._parent.dispose())},r.prototype.importMeshAsync=function(e,t,n,o,a,s){return(0,T.sH)(this,arguments,void 0,function(i,u,d,h,m,_,y){var l=this;return y===void 0&&(y=""),(0,T.YH)(this,function(f){switch(f.label){case 0:return[4,Promise.resolve().then(function(){return(0,T.sH)(l,void 0,void 0,function(){var p,v,g,b,w,A=this;return(0,T.YH)(this,function(E){switch(E.label){case 0:if(this._babylonScene=u,this._assetContainer=d,this._loadData(h),p=null,i){if(v={},this._gltf.nodes)for(g=0,b=this._gltf.nodes;g<b.length;g++)(w=b[g]).name&&(v[w.name]=w.index);p=(i instanceof Array?i:[i]).map(function(R){var O=v[R];if(O===void 0)throw new Error("Failed to find node '".concat(R,"'"));return O})}return[4,this._loadAsync(m,y,p,function(){return{meshes:A._getMeshes(),particleSystems:[],skeletons:A._getSkeletons(),animationGroups:A._getAnimationGroups(),lights:A._babylonLights,transformNodes:A._getTransformNodes(),geometries:A._getGeometries(),spriteManagers:[]}})];case 1:return[2,E.sent()]}})})})];case 1:return[2,f.sent()]}})})},r.prototype.loadAsync=function(e,t,n,o){return(0,T.sH)(this,arguments,void 0,function(a,s,i,u,d){return d===void 0&&(d=""),(0,T.YH)(this,function(h){switch(h.label){case 0:return this._babylonScene=a,this._loadData(s),[4,this._loadAsync(i,d,null,function(){})];case 1:return[2,h.sent()]}})})},r.prototype._loadAsync=function(e,t,n,o){return(0,T.sH)(this,void 0,void 0,function(){var a=this;return(0,T.YH)(this,function(s){switch(s.label){case 0:return[4,Promise.resolve().then(function(){return(0,T.sH)(a,void 0,void 0,function(){var i,u,d,h,m,_,y,l,f,p,v=this;return(0,T.YH)(this,function(g){switch(g.label){case 0:return this._rootUrl=e,this._uniqueRootUrl=!e.startsWith("file:")&&t?e:"".concat(e).concat(Date.now(),"/"),this._fileName=t,this._allMaterialsDirtyRequired=!1,[4,this._loadExtensionsAsync()];case 1:if(g.sent(),i="".concat(me[me.LOADING]," => ").concat(me[me.READY]),u="".concat(me[me.LOADING]," => ").concat(me[me.COMPLETE]),this._parent._startPerformanceCounter(i),this._parent._startPerformanceCounter(u),this._parent._setState(me.LOADING),this._extensionsOnLoading(),d=new Array,h=this._babylonScene.blockMaterialDirtyMechanism,this._babylonScene.blockMaterialDirtyMechanism=!0,this.parent.loadOnlyMaterials||(n?d.push(this.loadSceneAsync("/nodes",{nodes:n,index:-1})):(this._gltf.scene!=null||this._gltf.scenes&&this._gltf.scenes[0])&&(m=M.Get("/scene",this._gltf.scenes,this._gltf.scene||0),d.push(this.loadSceneAsync("/scenes/".concat(m.index),m)))),!this.parent.skipMaterials&&this.parent.loadAllMaterials&&this._gltf.materials)for(_=0;_<this._gltf.materials.length;++_)y=this._gltf.materials[_],l="/materials/"+_,f=c.Material.TriangleFillMode,d.push(this._loadMaterialAsync(l,y,null,f,function(){}));return this._allMaterialsDirtyRequired?this._babylonScene.blockMaterialDirtyMechanism=h:this._babylonScene._forceBlockMaterialDirtyMechanism(h),this._parent.compileMaterials&&d.push(this._compileMaterialsAsync()),this._parent.compileShadowGenerators&&d.push(this._compileShadowGeneratorsAsync()),p=Promise.all(d).then(function(){v._rootBabylonMesh&&v._rootBabylonMesh!==v._parent.customRootNode&&v._rootBabylonMesh.setEnabled(!0);for(var b=0,w=v._babylonScene.materials;b<w.length;b++){var A=w[b];A.maxSimultaneousLights!==void 0&&(A.maxSimultaneousLights=Math.max(A.maxSimultaneousLights,v._babylonScene.lights.length))}return v._extensionsOnReady(),v._parent._setState(me.READY),v._skipStartAnimationStep||v._startAnimations(),o()}),[4,p.then(function(b){return v._parent._endPerformanceCounter(i),c.Tools.SetImmediate(function(){v._disposed||Promise.all(v._completePromises).then(function(){v._parent._endPerformanceCounter(u),v._parent._setState(me.COMPLETE),v._parent.onCompleteObservable.notifyObservers(void 0),v._parent.onCompleteObservable.clear(),v.dispose()},function(w){v._parent.onErrorObservable.notifyObservers(w),v._parent.onErrorObservable.clear(),v.dispose()})}),b})];case 2:return[2,g.sent()]}})})}).catch(function(i){throw a._disposed||(a._parent.onErrorObservable.notifyObservers(i),a._parent.onErrorObservable.clear(),a.dispose()),i})];case 1:return[2,s.sent()]}})})},r.prototype._loadData=function(e){if(this._gltf=e.json,this._setupData(),e.bin){var t=this._gltf.buffers;if(t&&t[0]&&!t[0].uri){var n=t[0];(n.byteLength<e.bin.byteLength-3||n.byteLength>e.bin.byteLength)&&c.Logger.Warn("Binary buffer length (".concat(n.byteLength,") from JSON does not match chunk length (").concat(e.bin.byteLength,")")),this._bin=e.bin}else c.Logger.Warn("Unexpected BIN chunk")}},r.prototype._setupData=function(){if(M.Assign(this._gltf.accessors),M.Assign(this._gltf.animations),M.Assign(this._gltf.buffers),M.Assign(this._gltf.bufferViews),M.Assign(this._gltf.cameras),M.Assign(this._gltf.images),M.Assign(this._gltf.materials),M.Assign(this._gltf.meshes),M.Assign(this._gltf.nodes),M.Assign(this._gltf.samplers),M.Assign(this._gltf.scenes),M.Assign(this._gltf.skins),M.Assign(this._gltf.textures),this._gltf.nodes){for(var e={},t=0,n=this._gltf.nodes;t<n.length;t++)if((d=n[t]).children)for(var o=0,a=d.children;o<a.length;o++)e[a[o]]=d.index;for(var s=this._createRootNode(),i=0,u=this._gltf.nodes;i<u.length;i++){var d,h=e[(d=u[i]).index];d.parent=h===void 0?s:this._gltf.nodes[h]}}},r.prototype._loadExtensionsAsync=function(){return(0,T.sH)(this,void 0,void 0,function(){var e,t,n,o,a,s,i,u,d,h,m,_=this;return(0,T.YH)(this,function(y){switch(y.label){case 0:return e=[],Gr.forEach(function(l,f){var p;((p=_.parent.extensionOptions[f])===null||p===void 0?void 0:p.enabled)===!1?l.isGLTFExtension&&_.isExtensionUsed(f)&&c.Logger.Warn("Extension ".concat(f," is used but has been explicitly disabled.")):l.isGLTFExtension&&!_.isExtensionUsed(f)||e.push((0,T.sH)(_,void 0,void 0,function(){var v;return(0,T.YH)(this,function(g){switch(g.label){case 0:return[4,l.factory(this)];case 1:return(v=g.sent()).name!==f&&c.Logger.Warn("The name of the glTF loader extension instance does not match the registered name: ".concat(v.name," !== ").concat(f)),this._parent.onExtensionLoadedObservable.notifyObservers(v),[2,v]}})}))}),n=(t=(h=this._extensions).push).apply,o=[h],[4,Promise.all(e)];case 1:if(n.apply(t,o.concat([y.sent()])),this._extensions.sort(function(l,f){return(l.order||Number.MAX_VALUE)-(f.order||Number.MAX_VALUE)}),this._parent.onExtensionLoadedObservable.clear(),this._gltf.extensionsRequired)for(a=function(l){if(!s._extensions.some(function(f){return f.name===l&&f.enabled}))throw((m=s.parent.extensionOptions[l])===null||m===void 0?void 0:m.enabled)===!1?new Error("Required extension ".concat(l," is disabled")):new Error("Required extension ".concat(l," is not available"))},s=this,i=0,u=this._gltf.extensionsRequired;i<u.length;i++)d=u[i],a(d);return[2]}})})},r.prototype._createRootNode=function(){if(this._parent.customRootNode!==void 0)return this._rootBabylonMesh=this._parent.customRootNode,{_babylonTransformNode:this._rootBabylonMesh===null?void 0:this._rootBabylonMesh,index:-1};this._babylonScene._blockEntityCollection=!!this._assetContainer;var e=new c.Mesh("__root__",this._babylonScene);this._rootBabylonMesh=e,this._rootBabylonMesh._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._rootBabylonMesh.setEnabled(!1);var t={_babylonTransformNode:this._rootBabylonMesh,index:-1};switch(this._parent.coordinateSystemMode){case Ge.AUTO:this._babylonScene.useRightHandedSystem||(t.rotation=[0,1,0,0],t.scale=[1,1,-1],r._LoadTransform(t,this._rootBabylonMesh));break;case Ge.FORCE_RIGHT_HANDED:this._babylonScene.useRightHandedSystem=!0;break;default:throw new Error("Invalid coordinate system mode (".concat(this._parent.coordinateSystemMode,")"))}return this._parent.onMeshLoadedObservable.notifyObservers(e),t},r.prototype.loadSceneAsync=function(e,t){var n=this,o=this._extensionsLoadSceneAsync(e,t);if(o)return o;var a=new Array;if(this.logOpen("".concat(e," ").concat(t.name||"")),t.nodes)for(var s=0,i=t.nodes;s<i.length;s++){var u=i[s],d=M.Get("".concat(e,"/nodes/").concat(u),this._gltf.nodes,u);a.push(this.loadNodeAsync("/nodes/".concat(d.index),d,function(_){_.parent=n._rootBabylonMesh}))}for(var h=0,m=this._postSceneLoadActions;h<m.length;h++)(0,m[h])();return a.push(this._loadAnimationsAsync()),this.logClose(),Promise.all(a).then(function(){})},r.prototype._forEachPrimitive=function(e,t){if(e._primitiveBabylonMeshes)for(var n=0,o=e._primitiveBabylonMeshes;n<o.length;n++)t(o[n])},r.prototype._getGeometries=function(){var e=[],t=this._gltf.nodes;if(t)for(var n=0,o=t;n<o.length;n++){var a=o[n];this._forEachPrimitive(a,function(s){var i=s.geometry;i&&e.indexOf(i)===-1&&e.push(i)})}return e},r.prototype._getMeshes=function(){var e=[];this._rootBabylonMesh instanceof c.AbstractMesh&&e.push(this._rootBabylonMesh);var t=this._gltf.nodes;if(t)for(var n=0,o=t;n<o.length;n++){var a=o[n];this._forEachPrimitive(a,function(s){e.push(s)})}return e},r.prototype._getTransformNodes=function(){var e=[],t=this._gltf.nodes;if(t)for(var n=0,o=t;n<o.length;n++){var a=o[n];a._babylonTransformNode&&a._babylonTransformNode.getClassName()==="TransformNode"&&e.push(a._babylonTransformNode),a._babylonTransformNodeForSkin&&e.push(a._babylonTransformNodeForSkin)}return e},r.prototype._getSkeletons=function(){var e=[],t=this._gltf.skins;if(t)for(var n=0,o=t;n<o.length;n++){var a=o[n];a._data&&e.push(a._data.babylonSkeleton)}return e},r.prototype._getAnimationGroups=function(){var e=[],t=this._gltf.animations;if(t)for(var n=0,o=t;n<o.length;n++){var a=o[n];a._babylonAnimationGroup&&e.push(a._babylonAnimationGroup)}return e},r.prototype._startAnimations=function(){switch(this._parent.animationStartMode){case Pe.NONE:break;case Pe.FIRST:(e=this._getAnimationGroups()).length!==0&&e[0].start(!0);break;case Pe.ALL:for(var e,t=0,n=e=this._getAnimationGroups();t<n.length;t++)n[t].start(!0);break;default:return void c.Logger.Error("Invalid animation start mode (".concat(this._parent.animationStartMode,")"))}},r.prototype.loadNodeAsync=function(e,t,n){var o=this;n===void 0&&(n=function(){});var a=this._extensionsLoadNodeAsync(e,t,n);if(a)return a;if(t._babylonTransformNode)throw new Error("".concat(e,": Invalid recursive node hierarchy"));var s=new Array;this.logOpen("".concat(e," ").concat(t.name||""));var i=function(y){if(r.AddPointerMetadata(y,e),r._LoadTransform(t,y),t.camera!=null){var l=M.Get("".concat(e,"/camera"),o._gltf.cameras,t.camera);s.push(o.loadCameraAsync("/cameras/".concat(l.index),l,function(b){b.parent=y,o._babylonScene.useRightHandedSystem||(y.scaling.x=-1)}))}if(t.children)for(var f=0,p=t.children;f<p.length;f++){var v=p[f],g=M.Get("".concat(e,"/children/").concat(v),o._gltf.nodes,v);s.push(o.loadNodeAsync("/nodes/".concat(g.index),g,function(b){b.parent=y}))}n(y)},u=t.mesh!=null,d=this._parent.loadSkins&&t.skin!=null;if(!u||d){var h=t.name||"node".concat(t.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var m=new c.TransformNode(h,this._babylonScene);m._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t.mesh==null?t._babylonTransformNode=m:t._babylonTransformNodeForSkin=m,i(m)}if(u)if(d){var _=M.Get("".concat(e,"/mesh"),this._gltf.meshes,t.mesh);s.push(this._loadMeshAsync("/meshes/".concat(_.index),t,_,function(y){var l=t._babylonTransformNodeForSkin;y.metadata=(0,c.deepMerge)(l.metadata,y.metadata||{});var f=M.Get("".concat(e,"/skin"),o._gltf.skins,t.skin);s.push(o._loadSkinAsync("/skins/".concat(f.index),t,f,function(p){o._forEachPrimitive(t,function(v){v.skeleton=p}),o._postSceneLoadActions.push(function(){if(f.skeleton!=null){var v=M.Get("/skins/".concat(f.index,"/skeleton"),o._gltf.nodes,f.skeleton).parent;t.index===v.index?y.parent=l.parent:y.parent=v._babylonTransformNode}else y.parent=o._rootBabylonMesh;o._parent.onSkinLoadedObservable.notifyObservers({node:l,skinnedNode:y})})}))}))}else _=M.Get("".concat(e,"/mesh"),this._gltf.meshes,t.mesh),s.push(this._loadMeshAsync("/meshes/".concat(_.index),t,_,i));return this.logClose(),Promise.all(s).then(function(){return o._forEachPrimitive(t,function(y){var l=y;!l.isAnInstance&&l.geometry&&l.geometry.useBoundingInfoFromGeometry?y._updateBoundingInfo():y.refreshBoundingInfo(!0,!0)}),t._babylonTransformNode})},r.prototype._loadMeshAsync=function(e,t,n,o){var a=n.primitives;if(!a||!a.length)throw new Error("".concat(e,": Primitives are missing"));a[0].index==null&&M.Assign(a);var s=new Array;this.logOpen("".concat(e," ").concat(n.name||""));var i=t.name||"node".concat(t.index);if(a.length===1){var u=n.primitives[0];s.push(this._loadMeshPrimitiveAsync("".concat(e,"/primitives/").concat(u.index),i,t,n,u,function(m){t._babylonTransformNode=m,t._primitiveBabylonMeshes=[m]}))}else{this._babylonScene._blockEntityCollection=!!this._assetContainer,t._babylonTransformNode=new c.TransformNode(i,this._babylonScene),t._babylonTransformNode._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._primitiveBabylonMeshes=[];for(var d=0,h=a;d<h.length;d++)u=h[d],s.push(this._loadMeshPrimitiveAsync("".concat(e,"/primitives/").concat(u.index),"".concat(i,"_primitive").concat(u.index),t,n,u,function(m){m.parent=t._babylonTransformNode,t._primitiveBabylonMeshes.push(m)}))}return o(t._babylonTransformNode),this.logClose(),Promise.all(s).then(function(){return t._babylonTransformNode})},r.prototype._loadMeshPrimitiveAsync=function(e,t,n,o,a,s){var i=this,u=this._extensionsLoadMeshPrimitiveAsync(e,t,n,o,a,s);if(u)return u;this.logOpen("".concat(e));var d,h,m=this._disableInstancedMesh===0&&this._parent.createInstances&&n.skin==null&&!o.primitives[0].targets;if(m&&a._instanceData)this._babylonScene._blockEntityCollection=!!this._assetContainer,(d=a._instanceData.babylonSourceMesh.createInstance(t))._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,h=a._instanceData.promise;else{var _=new Array;this._babylonScene._blockEntityCollection=!!this._assetContainer;var y=new c.Mesh(t,this._babylonScene);y._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,y.sideOrientation=this._babylonScene.useRightHandedSystem?c.Material.CounterClockWiseSideOrientation:c.Material.ClockWiseSideOrientation,this._createMorphTargets(e,n,o,a,y),_.push(this._loadVertexDataAsync(e,a,y).then(function(v){return(0,T.sH)(i,void 0,void 0,function(){var g=this;return(0,T.YH)(this,function(b){switch(b.label){case 0:return[4,this._loadMorphTargetsAsync(e,a,y,v).then(function(){g._disposed||(g._babylonScene._blockEntityCollection=!!g._assetContainer,v.applyToMesh(y),v._parentContainer=g._assetContainer,g._babylonScene._blockEntityCollection=!1)})];case 1:return[2,b.sent()]}})})}));var l=r._GetDrawMode(e,a.mode);if(a.material==null){var f=this._defaultBabylonMaterialData[l];f||(f=this._createDefaultMaterial("__GLTFLoader._default",l),this._parent.onMaterialLoadedObservable.notifyObservers(f),this._defaultBabylonMaterialData[l]=f),y.material=f}else if(!this.parent.skipMaterials){var p=M.Get("".concat(e,"/material"),this._gltf.materials,a.material);_.push(this._loadMaterialAsync("/materials/".concat(p.index),p,y,l,function(v){y.material=v}))}h=Promise.all(_),m&&(a._instanceData={babylonSourceMesh:y,promise:h}),d=y}return r.AddPointerMetadata(d,e),this._parent.onMeshLoadedObservable.notifyObservers(d),s(d),this.logClose(),h.then(function(){return d})},r.prototype._loadVertexDataAsync=function(e,t,n){var o=this,a=this._extensionsLoadVertexDataAsync(e,t,n);if(a)return a;var s=t.attributes;if(!s)throw new Error("".concat(e,": Attributes are missing"));var i=new Array,u=new c.Geometry(n.name,this._babylonScene);if(t.indices==null)n.isUnIndexed=!0;else{var d=M.Get("".concat(e,"/indices"),this._gltf.accessors,t.indices);i.push(this._loadIndicesAccessorAsync("/accessors/".concat(d.index),d).then(function(m){u.setIndices(m)}))}var h=function(m,_,y){if(s[m]!=null){n._delayInfo=n._delayInfo||[],n._delayInfo.indexOf(_)===-1&&n._delayInfo.push(_);var l=M.Get("".concat(e,"/attributes/").concat(m),o._gltf.accessors,s[m]);i.push(o._loadVertexAccessorAsync("/accessors/".concat(l.index),l,_).then(function(f){if(f.getKind()===c.VertexBuffer.PositionKind&&!o.parent.alwaysComputeBoundingBox&&!n.skeleton){var p=sn(l);p&&(u._boundingInfo=p,u.useBoundingInfoFromGeometry=!0)}u.setVerticesBuffer(f,l.count)})),_==c.VertexBuffer.MatricesIndicesExtraKind&&(n.numBoneInfluencers=8),y&&y(l)}};return h("POSITION",c.VertexBuffer.PositionKind),h("NORMAL",c.VertexBuffer.NormalKind),h("TANGENT",c.VertexBuffer.TangentKind),h("TEXCOORD_0",c.VertexBuffer.UVKind),h("TEXCOORD_1",c.VertexBuffer.UV2Kind),h("TEXCOORD_2",c.VertexBuffer.UV3Kind),h("TEXCOORD_3",c.VertexBuffer.UV4Kind),h("TEXCOORD_4",c.VertexBuffer.UV5Kind),h("TEXCOORD_5",c.VertexBuffer.UV6Kind),h("JOINTS_0",c.VertexBuffer.MatricesIndicesKind),h("WEIGHTS_0",c.VertexBuffer.MatricesWeightsKind),h("JOINTS_1",c.VertexBuffer.MatricesIndicesExtraKind),h("WEIGHTS_1",c.VertexBuffer.MatricesWeightsExtraKind),h("COLOR_0",c.VertexBuffer.ColorKind,function(m){m.type==="VEC4"&&(n.hasVertexAlpha=!0)}),Promise.all(i).then(function(){return u})},r.prototype._createMorphTargets=function(e,t,n,o,a){if(o.targets&&this._parent.loadMorphTargets){if(t._numMorphTargets==null)t._numMorphTargets=o.targets.length;else if(o.targets.length!==t._numMorphTargets)throw new Error("".concat(e,": Primitives do not have the same number of targets"));var s=n.extras?n.extras.targetNames:null;this._babylonScene._blockEntityCollection=!!this._assetContainer,a.morphTargetManager=new c.MorphTargetManager(this._babylonScene),a.morphTargetManager._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,a.morphTargetManager.areUpdatesFrozen=!0;for(var i=0;i<o.targets.length;i++){var u=t.weights?t.weights[i]:n.weights?n.weights[i]:0,d=s?s[i]:"morphTarget".concat(i);a.morphTargetManager.addTarget(new c.MorphTarget(d,u,a.getScene()))}}},r.prototype._loadMorphTargetsAsync=function(e,t,n,o){if(!t.targets||!this._parent.loadMorphTargets)return Promise.resolve();for(var a=new Array,s=n.morphTargetManager,i=0;i<s.numTargets;i++){var u=s.getTarget(i);a.push(this._loadMorphTargetVertexDataAsync("".concat(e,"/targets/").concat(i),o,t.targets[i],u))}return Promise.all(a).then(function(){s.areUpdatesFrozen=!1})},r.prototype._loadMorphTargetVertexDataAsync=function(e,t,n,o){return(0,T.sH)(this,void 0,void 0,function(){var a,s,i=this;return(0,T.YH)(this,function(u){switch(u.label){case 0:return a=new Array,(s=function(d,h,m){if(n[d]!=null){var _=t.getVertexBuffer(h);if(_){var y=M.Get("".concat(e,"/").concat(d),i._gltf.accessors,n[d]);a.push(i._loadFloatAccessorAsync("/accessors/".concat(y.index),y).then(function(l){m(_,l)}))}}})("POSITION",c.VertexBuffer.PositionKind,function(d,h){var m=new Float32Array(h.length);d.forEach(h.length,function(_,y){m[y]=h[y]+_}),o.setPositions(m)}),s("NORMAL",c.VertexBuffer.NormalKind,function(d,h){var m=new Float32Array(h.length);d.forEach(m.length,function(_,y){m[y]=h[y]+_}),o.setNormals(m)}),s("TANGENT",c.VertexBuffer.TangentKind,function(d,h){var m=new Float32Array(h.length/3*4),_=0;d.forEach(h.length/3*4,function(y,l){(l+1)%4!=0&&(m[_]=h[_]+y,_++)}),o.setTangents(m)}),s("TEXCOORD_0",c.VertexBuffer.UVKind,function(d,h){var m=new Float32Array(h.length);d.forEach(h.length,function(_,y){m[y]=h[y]+_}),o.setUVs(m)}),s("TEXCOORD_1",c.VertexBuffer.UV2Kind,function(d,h){var m=new Float32Array(h.length);d.forEach(h.length,function(_,y){m[y]=h[y]+_}),o.setUV2s(m)}),s("COLOR_0",c.VertexBuffer.ColorKind,function(d,h){var m=null,_=d.getSize();if(_===3){m=new Float32Array(h.length/3*4),d.forEach(h.length,function(l,f){var p=Math.floor(f/3),v=f%3;m[4*p+v]=h[3*p+v]+l});for(var y=0;y<h.length/3;++y)m[4*y+3]=1}else{if(_!==4)throw new Error("".concat(e,": Invalid number of components (").concat(_,") for COLOR_0 attribute"));m=new Float32Array(h.length),d.forEach(h.length,function(l,f){m[f]=h[f]+l})}o.setColors(m)}),[4,Promise.all(a).then(function(){})];case 1:return[2,u.sent()]}})})},r._LoadTransform=function(e,t){if(e.skin==null){var n=c.Vector3.Zero(),o=c.Quaternion.Identity(),a=c.Vector3.One();e.matrix?c.Matrix.FromArray(e.matrix).decompose(a,o,n):(e.translation&&(n=c.Vector3.FromArray(e.translation)),e.rotation&&(o=c.Quaternion.FromArray(e.rotation)),e.scale&&(a=c.Vector3.FromArray(e.scale))),t.position=n,t.rotationQuaternion=o,t.scaling=a}},r.prototype._loadSkinAsync=function(e,t,n,o){var a=this;if(!this._parent.loadSkins)return Promise.resolve();var s=this._extensionsLoadSkinAsync(e,t,n);if(s)return s;if(n._data)return o(n._data.babylonSkeleton),n._data.promise;var i="skeleton".concat(n.index);this._babylonScene._blockEntityCollection=!!this._assetContainer;var u=new c.Skeleton(n.name||i,i,this._babylonScene);u._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,this._loadBones(e,n,u);var d=this._loadSkinInverseBindMatricesDataAsync(e,n).then(function(h){a._updateBoneMatrices(u,h)});return n._data={babylonSkeleton:u,promise:d},o(u),d},r.prototype._loadBones=function(e,t,n){if(t.skeleton==null||this._parent.alwaysComputeSkeletonRootNode){var o=this._findSkeletonRootNode("".concat(e,"/joints"),t.joints);if(o)if(t.skeleton===void 0)t.skeleton=o.index;else{var a=M.Get("".concat(e,"/skeleton"),this._gltf.nodes,t.skeleton);a===o||function(m,_){for(;_.parent;_=_.parent)if(_.parent===m)return!0;return!1}(a,o)||(c.Logger.Warn("".concat(e,"/skeleton: Overriding with nearest common ancestor as skeleton node is not a common root")),t.skeleton=o.index)}else c.Logger.Warn("".concat(e,": Failed to find common root"))}for(var s={},i=0,u=t.joints;i<u.length;i++){var d=u[i],h=M.Get("".concat(e,"/joints/").concat(d),this._gltf.nodes,d);this._loadBone(h,t,n,s)}},r.prototype._findSkeletonRootNode=function(e,t){if(t.length===0)return null;for(var n={},o=0,a=t;o<a.length;o++){for(var s=a[o],i=[],u=M.Get("".concat(e,"/").concat(s),this._gltf.nodes,s);u.index!==-1;)i.unshift(u),u=u.parent;n[s]=i}for(var d=null,h=0;;++h){if(h>=(i=n[t[0]]).length)return d;u=i[h];for(var m=1;m<t.length;++m)if(h>=(i=n[t[m]]).length||u!==i[h])return d;d=u}},r.prototype._loadBone=function(e,t,n,o){e._isJoint=!0;var a=o[e.index];if(a)return a;var s=null;e.index!==t.skeleton&&(e.parent&&e.parent.index!==-1?s=this._loadBone(e.parent,t,n,o):t.skeleton!==void 0&&c.Logger.Warn("/skins/".concat(t.index,"/skeleton: Skeleton node is not a common root")));var i=t.joints.indexOf(e.index);return a=new c.Bone(e.name||"joint".concat(e.index),n,s,this._getNodeMatrix(e),null,null,i),o[e.index]=a,this._postSceneLoadActions.push(function(){a.linkTransformNode(e._babylonTransformNode)}),a},r.prototype._loadSkinInverseBindMatricesDataAsync=function(e,t){if(t.inverseBindMatrices==null)return Promise.resolve(null);var n=M.Get("".concat(e,"/inverseBindMatrices"),this._gltf.accessors,t.inverseBindMatrices);return this._loadFloatAccessorAsync("/accessors/".concat(n.index),n)},r.prototype._updateBoneMatrices=function(e,t){for(var n=0,o=e.bones;n<o.length;n++){var a=o[n],s=c.Matrix.Identity(),i=a._index;t&&i!==-1&&(c.Matrix.FromArrayToRef(t,16*i,s),s.invertToRef(s));var u=a.getParent();u&&s.multiplyToRef(u.getAbsoluteInverseBindMatrix(),s),a.updateMatrix(s,!1,!1),a._updateAbsoluteBindMatrices(void 0,!1)}},r.prototype._getNodeMatrix=function(e){return e.matrix?c.Matrix.FromArray(e.matrix):c.Matrix.Compose(e.scale?c.Vector3.FromArray(e.scale):c.Vector3.One(),e.rotation?c.Quaternion.FromArray(e.rotation):c.Quaternion.Identity(),e.translation?c.Vector3.FromArray(e.translation):c.Vector3.Zero())},r.prototype.loadCameraAsync=function(e,t,n){n===void 0&&(n=function(){});var o=this._extensionsLoadCameraAsync(e,t,n);if(o)return o;var a=new Array;this.logOpen("".concat(e," ").concat(t.name||"")),this._babylonScene._blockEntityCollection=!!this._assetContainer;var s=new c.FreeCamera(t.name||"camera".concat(t.index),c.Vector3.Zero(),this._babylonScene,!1);switch(s._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,t._babylonCamera=s,s.setTarget(new c.Vector3(0,0,-1)),t.type){case"perspective":var i=t.perspective;if(!i)throw new Error("".concat(e,": Camera perspective properties are missing"));s.fov=i.yfov,s.minZ=i.znear,s.maxZ=i.zfar||0;break;case"orthographic":if(!t.orthographic)throw new Error("".concat(e,": Camera orthographic properties are missing"));s.mode=c.Camera.ORTHOGRAPHIC_CAMERA,s.orthoLeft=-t.orthographic.xmag,s.orthoRight=t.orthographic.xmag,s.orthoBottom=-t.orthographic.ymag,s.orthoTop=t.orthographic.ymag,s.minZ=t.orthographic.znear,s.maxZ=t.orthographic.zfar;break;default:throw new Error("".concat(e,": Invalid camera type (").concat(t.type,")"))}return r.AddPointerMetadata(s,e),this._parent.onCameraLoadedObservable.notifyObservers(s),n(s),this.logClose(),Promise.all(a).then(function(){return s})},r.prototype._loadAnimationsAsync=function(){var e=this._gltf.animations;if(!e)return Promise.resolve();for(var t=new Array,n=0;n<e.length;n++){var o=e[n];t.push(this.loadAnimationAsync("/animations/".concat(o.index),o).then(function(a){a.targetedAnimations.length===0&&a.dispose()}))}return Promise.all(t).then(function(){})},r.prototype.loadAnimationAsync=function(e,t){var n=this;return this._extensionsLoadAnimationAsync(e,t)||Promise.resolve().then(N.t.bind(N,597,23)).then(function(o){var a=o.AnimationGroup;n._babylonScene._blockEntityCollection=!!n._assetContainer;var s=new a(t.name||"animation".concat(t.index),n._babylonScene);s._parentContainer=n._assetContainer,n._babylonScene._blockEntityCollection=!1,t._babylonAnimationGroup=s;var i=new Array;M.Assign(t.channels),M.Assign(t.samplers);for(var u=0,d=t.channels;u<d.length;u++){var h=d[u];i.push(n._loadAnimationChannelAsync("".concat(e,"/channels/").concat(h.index),e,t,h,function(m,_){m.animations=m.animations||[],m.animations.push(_),s.addTargetedAnimation(_,m)}))}return Promise.all(i).then(function(){return s.normalize(0),s})})},r.prototype._loadAnimationChannelAsync=function(e,t,n,o,a){return(0,T.sH)(this,void 0,void 0,function(){var s,i,u,d,h,m,_,y,l,f;return(0,T.YH)(this,function(p){switch(p.label){case 0:return(s=this._extensionsLoadAnimationChannelAsync(e,t,n,o,a))?[4,s]:[3,2];case 1:case 3:case 5:case 7:case 10:return[2,p.sent()];case 2:return o.target.node!=null?[3,4]:[4,Promise.resolve()];case 4:return i=M.Get("".concat(e,"/target/node"),this._gltf.nodes,o.target.node),u=o.target.path,(d=u==="weights")&&!i._numMorphTargets||!d&&!i._babylonTransformNode?[4,Promise.resolve()]:[3,6];case 6:return this._parent.loadNodeAnimations||d||i._isJoint?[3,8]:[4,Promise.resolve()];case 8:return[4,Promise.resolve().then(N.bind(N,727))];case 9:switch(p.sent(),u){case"translation":h=(_=(0,x.tQ)("/nodes/{}/translation"))===null||_===void 0?void 0:_.interpolation;break;case"rotation":h=(y=(0,x.tQ)("/nodes/{}/rotation"))===null||y===void 0?void 0:y.interpolation;break;case"scale":h=(l=(0,x.tQ)("/nodes/{}/scale"))===null||l===void 0?void 0:l.interpolation;break;case"weights":h=(f=(0,x.tQ)("/nodes/{}/weights"))===null||f===void 0?void 0:f.interpolation;break;default:throw new Error("".concat(e,"/target/path: Invalid value (").concat(o.target.path,")"))}if(!h)throw new Error("".concat(e,"/target/path: Could not find interpolation properties for target path (").concat(o.target.path,")"));return m={object:i,info:h},[4,this._loadAnimationChannelFromTargetInfoAsync(e,t,n,o,m,a)]}})})},r.prototype._loadAnimationChannelFromTargetInfoAsync=function(e,t,n,o,a,s){var i=this.parent.targetFps,u=1/i,d=M.Get("".concat(e,"/sampler"),n.samplers,o.sampler);return this._loadAnimationSamplerAsync("".concat(t,"/samplers/").concat(o.sampler),d).then(function(h){for(var m=0,_=a.object,y=0,l=a.info;y<l.length;y++){var f=l[y],p=f.getStride(_),v=h.input,g=h.output,b=new Array(v.length),w=0;switch(h.interpolation){case"STEP":for(var A=0;A<v.length;A++){var E=f.getValue(_,g,w,1);w+=p,b[A]={frame:v[A]*i,value:E,interpolation:1}}break;case"CUBICSPLINE":for(A=0;A<v.length;A++){var R=f.getValue(_,g,w,u);w+=p,E=f.getValue(_,g,w,1),w+=p;var O=f.getValue(_,g,w,u);w+=p,b[A]={frame:v[A]*i,inTangent:R,value:E,outTangent:O}}break;case"LINEAR":for(A=0;A<v.length;A++)E=f.getValue(_,g,w,1),w+=p,b[A]={frame:v[A]*i,value:E}}if(w>0)for(var I="".concat(n.name||"animation".concat(n.index),"_channel").concat(o.index,"_").concat(m),L=0,S=f.buildAnimations(_,I,i,b);L<S.length;L++){var B=S[L];m++,s(B.babylonAnimatable,B.babylonAnimation)}}})},r.prototype._loadAnimationSamplerAsync=function(e,t){if(t._data)return t._data;var n=t.interpolation||"LINEAR";switch(n){case"STEP":case"LINEAR":case"CUBICSPLINE":break;default:throw new Error("".concat(e,"/interpolation: Invalid value (").concat(t.interpolation,")"))}var o=M.Get("".concat(e,"/input"),this._gltf.accessors,t.input),a=M.Get("".concat(e,"/output"),this._gltf.accessors,t.output);return t._data=Promise.all([this._loadFloatAccessorAsync("/accessors/".concat(o.index),o),this._loadFloatAccessorAsync("/accessors/".concat(a.index),a)]).then(function(s){var i=s[0],u=s[1];return{input:i,interpolation:n,output:u}}),t._data},r.prototype.loadBufferAsync=function(e,t,n,o){var a=this._extensionsLoadBufferAsync(e,t,n,o);if(a)return a;if(!t._data)if(t.uri)t._data=this.loadUriAsync("".concat(e,"/uri"),t,t.uri);else{if(!this._bin)throw new Error("".concat(e,": Uri is missing or the binary glTF is missing its binary chunk"));t._data=this._bin.readAsync(0,t.byteLength)}return t._data.then(function(s){try{return new Uint8Array(s.buffer,s.byteOffset+n,o)}catch(i){throw new Error("".concat(e,": ").concat(i.message))}})},r.prototype.loadBufferViewAsync=function(e,t){var n=this._extensionsLoadBufferViewAsync(e,t);if(n)return n;if(t._data)return t._data;var o=M.Get("".concat(e,"/buffer"),this._gltf.buffers,t.buffer);return t._data=this.loadBufferAsync("/buffers/".concat(o.index),o,t.byteOffset||0,t.byteLength),t._data},r.prototype._loadAccessorAsync=function(e,t,n){var o=this;if(t._data)return t._data;var a=r._GetNumComponents(e,t.type),s=a*c.VertexBuffer.GetTypeByteLength(t.componentType),i=a*t.count;if(t.bufferView==null)t._data=Promise.resolve(new n(i));else{var u=M.Get("".concat(e,"/bufferView"),this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/".concat(u.index),u).then(function(h){if(t.componentType!==5126||t.normalized||u.byteStride&&u.byteStride!==s){var m=new n(i);return c.VertexBuffer.ForEach(h,t.byteOffset||0,u.byteStride||s,a,t.componentType,m.length,t.normalized||!1,function(_,y){m[y]=_}),m}return r._GetTypedArray(e,t.componentType,h,t.byteOffset,i)})}if(t.sparse){var d=t.sparse;t._data=t._data.then(function(h){var m=h,_=M.Get("".concat(e,"/sparse/indices/bufferView"),o._gltf.bufferViews,d.indices.bufferView),y=M.Get("".concat(e,"/sparse/values/bufferView"),o._gltf.bufferViews,d.values.bufferView);return Promise.all([o.loadBufferViewAsync("/bufferViews/".concat(_.index),_),o.loadBufferViewAsync("/bufferViews/".concat(y.index),y)]).then(function(l){var f,p=l[0],v=l[1],g=r._GetTypedArray("".concat(e,"/sparse/indices"),d.indices.componentType,p,d.indices.byteOffset,d.count),b=a*d.count;if(t.componentType!==5126||t.normalized){var w=r._GetTypedArray("".concat(e,"/sparse/values"),t.componentType,v,d.values.byteOffset,b);f=new n(b),c.VertexBuffer.ForEach(w,0,s,a,t.componentType,f.length,t.normalized||!1,function(I,L){f[L]=I})}else f=r._GetTypedArray("".concat(e,"/sparse/values"),t.componentType,v,d.values.byteOffset,b);for(var A=0,E=0;E<g.length;E++)for(var R=g[E]*a,O=0;O<a;O++)m[R++]=f[A++];return m})})}return t._data},r.prototype._loadFloatAccessorAsync=function(e,t){return this._loadAccessorAsync(e,t,Float32Array)},r.prototype._loadIndicesAccessorAsync=function(e,t){if(t.type!=="SCALAR")throw new Error("".concat(e,"/type: Invalid value ").concat(t.type));if(t.componentType!==5121&&t.componentType!==5123&&t.componentType!==5125)throw new Error("".concat(e,"/componentType: Invalid value ").concat(t.componentType));if(t._data)return t._data;if(t.sparse){var n=r._GetTypedArrayConstructor("".concat(e,"/componentType"),t.componentType);t._data=this._loadAccessorAsync(e,t,n)}else{var o=M.Get("".concat(e,"/bufferView"),this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/".concat(o.index),o).then(function(a){return r._GetTypedArray(e,t.componentType,a,t.byteOffset,t.count)})}return t._data},r.prototype._loadVertexBufferViewAsync=function(e){if(e._babylonBuffer)return e._babylonBuffer;var t=this._babylonScene.getEngine();return e._babylonBuffer=this.loadBufferViewAsync("/bufferViews/".concat(e.index),e).then(function(n){return new c.Buffer(t,n,!1)}),e._babylonBuffer},r.prototype._loadVertexAccessorAsync=function(e,t,n){var o;if(!((o=t._babylonVertexBuffer)===null||o===void 0)&&o[n])return t._babylonVertexBuffer[n];t._babylonVertexBuffer||(t._babylonVertexBuffer={});var a=this._babylonScene.getEngine();if(t.sparse||t.bufferView==null)t._babylonVertexBuffer[n]=this._loadFloatAccessorAsync(e,t).then(function(i){return new c.VertexBuffer(a,i,n,!1)});else{var s=M.Get("".concat(e,"/bufferView"),this._gltf.bufferViews,t.bufferView);t._babylonVertexBuffer[n]=this._loadVertexBufferViewAsync(s).then(function(i){var u=r._GetNumComponents(e,t.type);return new c.VertexBuffer(a,i,n,!1,void 0,s.byteStride,void 0,t.byteOffset,u,t.componentType,t.normalized,!0,void 0,!0)})}return t._babylonVertexBuffer[n]},r.prototype._loadMaterialMetallicRoughnessPropertiesAsync=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=new Array;return t&&(t.baseColorFactor?(n.albedoColor=c.Color3.FromArray(t.baseColorFactor),n.alpha=t.baseColorFactor[3]):n.albedoColor=c.Color3.White(),n.metallic=t.metallicFactor==null?1:t.metallicFactor,n.roughness=t.roughnessFactor==null?1:t.roughnessFactor,t.baseColorTexture&&o.push(this.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),t.baseColorTexture,function(a){a.name="".concat(n.name," (Base Color)"),n.albedoTexture=a})),t.metallicRoughnessTexture&&(t.metallicRoughnessTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync("".concat(e,"/metallicRoughnessTexture"),t.metallicRoughnessTexture,function(a){a.name="".concat(n.name," (Metallic Roughness)"),n.metallicTexture=a})),n.useMetallnessFromMetallicTextureBlue=!0,n.useRoughnessFromMetallicTextureGreen=!0,n.useRoughnessFromMetallicTextureAlpha=!1)),Promise.all(o).then(function(){})},r.prototype._loadMaterialAsync=function(e,t,n,o,a){a===void 0&&(a=function(){});var s=this._extensionsLoadMaterialAsync(e,t,n,o,a);if(s)return s;t._data=t._data||{};var i=t._data[o];if(!i){this.logOpen("".concat(e," ").concat(t.name||""));var u=this.createMaterial(e,t,o);i={babylonMaterial:u,babylonMeshes:[],promise:this.loadMaterialPropertiesAsync(e,t,u)},t._data[o]=i,r.AddPointerMetadata(u,e),this._parent.onMaterialLoadedObservable.notifyObservers(u),this.logClose()}return n&&(i.babylonMeshes.push(n),n.onDisposeObservable.addOnce(function(){var d=i.babylonMeshes.indexOf(n);d!==-1&&i.babylonMeshes.splice(d,1)})),a(i.babylonMaterial),i.promise.then(function(){return i.babylonMaterial})},r.prototype._createDefaultMaterial=function(e,t){this._babylonScene._blockEntityCollection=!!this._assetContainer;var n=new c.PBRMaterial(e,this._babylonScene);return n._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,n.fillMode=t,n.enableSpecularAntiAliasing=!0,n.useRadianceOverAlpha=!this._parent.transparencyAsCoverage,n.useSpecularOverAlpha=!this._parent.transparencyAsCoverage,n.transparencyMode=c.PBRMaterial.PBRMATERIAL_OPAQUE,n.metallic=1,n.roughness=1,n},r.prototype.createMaterial=function(e,t,n){var o=this._extensionsCreateMaterial(e,t,n);if(o)return o;var a=t.name||"material".concat(t.index);return this._createDefaultMaterial(a,n)},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this._extensionsLoadMaterialPropertiesAsync(e,t,n);if(o)return o;var a=new Array;return a.push(this.loadMaterialBasePropertiesAsync(e,t,n)),t.pbrMetallicRoughness&&a.push(this._loadMaterialMetallicRoughnessPropertiesAsync("".concat(e,"/pbrMetallicRoughness"),t.pbrMetallicRoughness,n)),this.loadMaterialAlphaProperties(e,t,n),Promise.all(a).then(function(){})},r.prototype.loadMaterialBasePropertiesAsync=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=new Array;return n.emissiveColor=t.emissiveFactor?c.Color3.FromArray(t.emissiveFactor):new c.Color3(0,0,0),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),t.normalTexture&&(t.normalTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync("".concat(e,"/normalTexture"),t.normalTexture,function(a){a.name="".concat(n.name," (Normal)"),n.bumpTexture=a})),n.invertNormalMapX=!this._babylonScene.useRightHandedSystem,n.invertNormalMapY=this._babylonScene.useRightHandedSystem,t.normalTexture.scale!=null&&n.bumpTexture&&(n.bumpTexture.level=t.normalTexture.scale),n.forceIrradianceInFragment=!0),t.occlusionTexture&&(t.occlusionTexture.nonColorData=!0,o.push(this.loadTextureInfoAsync("".concat(e,"/occlusionTexture"),t.occlusionTexture,function(a){a.name="".concat(n.name," (Occlusion)"),n.ambientTexture=a})),n.useAmbientInGrayScale=!0,t.occlusionTexture.strength!=null&&(n.ambientTextureStrength=t.occlusionTexture.strength)),t.emissiveTexture&&o.push(this.loadTextureInfoAsync("".concat(e,"/emissiveTexture"),t.emissiveTexture,function(a){a.name="".concat(n.name," (Emissive)"),n.emissiveTexture=a})),Promise.all(o).then(function(){})},r.prototype.loadMaterialAlphaProperties=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));switch(t.alphaMode||"OPAQUE"){case"OPAQUE":n.transparencyMode=c.PBRMaterial.PBRMATERIAL_OPAQUE,n.alpha=1;break;case"MASK":n.transparencyMode=c.PBRMaterial.PBRMATERIAL_ALPHATEST,n.alphaCutOff=t.alphaCutoff==null?.5:t.alphaCutoff,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0);break;case"BLEND":n.transparencyMode=c.PBRMaterial.PBRMATERIAL_ALPHABLEND,n.albedoTexture&&(n.albedoTexture.hasAlpha=!0,n.useAlphaFromAlbedoTexture=!0);break;default:throw new Error("".concat(e,"/alphaMode: Invalid value (").concat(t.alphaMode,")"))}},r.prototype.loadTextureInfoAsync=function(e,t,n){var o=this;n===void 0&&(n=function(){});var a=this._extensionsLoadTextureInfoAsync(e,t,n);if(a)return a;if(this.logOpen("".concat(e)),t.texCoord>=6)throw new Error("".concat(e,"/texCoord: Invalid value (").concat(t.texCoord,")"));var s=M.Get("".concat(e,"/index"),this._gltf.textures,t.index);s._textureInfo=t;var i=this._loadTextureAsync("/textures/".concat(t.index),s,function(u){u.coordinatesIndex=t.texCoord||0,r.AddPointerMetadata(u,e),o._parent.onTextureLoadedObservable.notifyObservers(u),n(u)});return this.logClose(),i},r.prototype._loadTextureAsync=function(e,t,n){n===void 0&&(n=function(){});var o=this._extensionsLoadTextureAsync(e,t,n);if(o)return o;this.logOpen("".concat(e," ").concat(t.name||""));var a=t.sampler==null?r.DefaultSampler:M.Get("".concat(e,"/sampler"),this._gltf.samplers,t.sampler),s=M.Get("".concat(e,"/source"),this._gltf.images,t.source),i=this._createTextureAsync(e,a,s,n,void 0,!t._textureInfo.nonColorData);return this.logClose(),i},r.prototype._createTextureAsync=function(e,t,n,o,a,s){var i,u,d=this;o===void 0&&(o=function(){});var h=this._loadSampler("/samplers/".concat(t.index),t),m=new Array,_=new c.Deferred;this._babylonScene._blockEntityCollection=!!this._assetContainer;var y={noMipmap:h.noMipMaps,invertY:!1,samplingMode:h.samplingMode,onLoad:function(){d._disposed||_.resolve()},onError:function(f,p){d._disposed||_.reject(new Error("".concat(e,": ").concat(p&&p.message?p.message:f||"Failed to load texture")))},mimeType:(i=n.mimeType)!==null&&i!==void 0?i:(0,c.GetMimeType)((u=n.uri)!==null&&u!==void 0?u:""),loaderOptions:a,useSRGBBuffer:!!s&&this._parent.useSRGBBuffers},l=new c.Texture(null,this._babylonScene,y);return l._parentContainer=this._assetContainer,this._babylonScene._blockEntityCollection=!1,m.push(_.promise),m.push(this.loadImageAsync("/images/".concat(n.index),n).then(function(f){var p=n.uri||"".concat(d._fileName,"#image").concat(n.index),v="data:".concat(d._uniqueRootUrl).concat(p);l.updateURL(v,f);var g=l.getInternalTexture();g&&(g.label=n.name)})),l.wrapU=h.wrapU,l.wrapV=h.wrapV,o(l),this._parent.useGltfTextureNames&&(l.name=n.name||n.uri||"image".concat(n.index)),Promise.all(m).then(function(){return l})},r.prototype._loadSampler=function(e,t){return t._data||(t._data={noMipMaps:t.minFilter===9728||t.minFilter===9729,samplingMode:r._GetTextureSamplingMode(e,t),wrapU:r._GetTextureWrapMode("".concat(e,"/wrapS"),t.wrapS),wrapV:r._GetTextureWrapMode("".concat(e,"/wrapT"),t.wrapT)}),t._data},r.prototype.loadImageAsync=function(e,t){if(!t._data){if(this.logOpen("".concat(e," ").concat(t.name||"")),t.uri)t._data=this.loadUriAsync("".concat(e,"/uri"),t,t.uri);else{var n=M.Get("".concat(e,"/bufferView"),this._gltf.bufferViews,t.bufferView);t._data=this.loadBufferViewAsync("/bufferViews/".concat(n.index),n)}this.logClose()}return t._data},r.prototype.loadUriAsync=function(e,t,n){var o=this,a=this._extensionsLoadUriAsync(e,t,n);if(a)return a;if(!r._ValidateUri(n))throw new Error("".concat(e,": '").concat(n,"' is invalid"));if((0,c.IsBase64DataUrl)(n)){var s=new Uint8Array((0,c.DecodeBase64UrlToBinary)(n));return this.log("".concat(e,": Decoded ").concat(n.substring(0,64),"... (").concat(s.length," bytes)")),Promise.resolve(s)}return this.log("".concat(e,": Loading ").concat(n)),this._parent.preprocessUrlAsync(this._rootUrl+n).then(function(i){return new Promise(function(u,d){o._parent._loadFile(o._babylonScene,i,function(h){o._disposed||(o.log("".concat(e,": Loaded ").concat(n," (").concat(h.byteLength," bytes)")),u(new Uint8Array(h)))},!0,function(h){d(new c.LoadFileError("".concat(e,": Failed to load '").concat(n,"'").concat(h?": "+h.status+" "+h.statusText:""),h))})})})},r.AddPointerMetadata=function(e,t){e.metadata=e.metadata||{};var n=e._internalMetadata=e._internalMetadata||{},o=n.gltf=n.gltf||{};(o.pointers=o.pointers||[]).push(t)},r._GetTextureWrapMode=function(e,t){switch(t=t??10497){case 33071:return c.Texture.CLAMP_ADDRESSMODE;case 33648:return c.Texture.MIRROR_ADDRESSMODE;case 10497:return c.Texture.WRAP_ADDRESSMODE;default:return c.Logger.Warn("".concat(e,": Invalid value (").concat(t,")")),c.Texture.WRAP_ADDRESSMODE}},r._GetTextureSamplingMode=function(e,t){var n=t.magFilter==null?9729:t.magFilter,o=t.minFilter==null?9987:t.minFilter;if(n===9729)switch(o){case 9728:return c.Texture.LINEAR_NEAREST;case 9729:return c.Texture.LINEAR_LINEAR;case 9984:return c.Texture.LINEAR_NEAREST_MIPNEAREST;case 9985:return c.Texture.LINEAR_LINEAR_MIPNEAREST;case 9986:return c.Texture.LINEAR_NEAREST_MIPLINEAR;case 9987:return c.Texture.LINEAR_LINEAR_MIPLINEAR;default:return c.Logger.Warn("".concat(e,"/minFilter: Invalid value (").concat(o,")")),c.Texture.LINEAR_LINEAR_MIPLINEAR}else switch(n!==9728&&c.Logger.Warn("".concat(e,"/magFilter: Invalid value (").concat(n,")")),o){case 9728:return c.Texture.NEAREST_NEAREST;case 9729:return c.Texture.NEAREST_LINEAR;case 9984:return c.Texture.NEAREST_NEAREST_MIPNEAREST;case 9985:return c.Texture.NEAREST_LINEAR_MIPNEAREST;case 9986:return c.Texture.NEAREST_NEAREST_MIPLINEAR;case 9987:return c.Texture.NEAREST_LINEAR_MIPLINEAR;default:return c.Logger.Warn("".concat(e,"/minFilter: Invalid value (").concat(o,")")),c.Texture.NEAREST_NEAREST_MIPNEAREST}},r._GetTypedArrayConstructor=function(e,t){try{return(0,c.GetTypedArrayConstructor)(t)}catch(n){throw new Error("".concat(e,": ").concat(n.message))}},r._GetTypedArray=function(e,t,n,o,a){var s=n.buffer;o=n.byteOffset+(o||0);var i=r._GetTypedArrayConstructor("".concat(e,"/componentType"),t),u=c.VertexBuffer.GetTypeByteLength(t);return o%u!==0?(c.Logger.Warn("".concat(e,": Copying buffer as byte offset (").concat(o,") is not a multiple of component type byte length (").concat(u,")")),new i(s.slice(o,o+a*u),0)):new i(s,o,a)},r._GetNumComponents=function(e,t){switch(t){case"SCALAR":return 1;case"VEC2":return 2;case"VEC3":return 3;case"VEC4":case"MAT2":return 4;case"MAT3":return 9;case"MAT4":return 16}throw new Error("".concat(e,": Invalid type (").concat(t,")"))},r._ValidateUri=function(e){return c.Tools.IsBase64(e)||e.indexOf("..")===-1},r._GetDrawMode=function(e,t){switch(t==null&&(t=4),t){case 0:return c.Material.PointListDrawMode;case 1:return c.Material.LineListDrawMode;case 2:return c.Material.LineLoopDrawMode;case 3:return c.Material.LineStripDrawMode;case 4:return c.Material.TriangleFillMode;case 5:return c.Material.TriangleStripDrawMode;case 6:return c.Material.TriangleFanDrawMode}throw new Error("".concat(e,": Invalid mesh primitive mode (").concat(t,")"))},r.prototype._compileMaterialsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile materials");var t=new Array;if(this._gltf.materials)for(var n=0,o=this._gltf.materials;n<o.length;n++){var a=o[n];if(a._data)for(var s in a._data)for(var i=a._data[s],u=0,d=i.babylonMeshes;u<d.length;u++){var h=d[u];h.computeWorldMatrix(!0);var m=i.babylonMaterial;t.push(m.forceCompilationAsync(h)),t.push(m.forceCompilationAsync(h,{useInstances:!0})),this._parent.useClipPlane&&(t.push(m.forceCompilationAsync(h,{clipPlane:!0})),t.push(m.forceCompilationAsync(h,{clipPlane:!0,useInstances:!0})))}}return Promise.all(t).then(function(){e._parent._endPerformanceCounter("Compile materials")})},r.prototype._compileShadowGeneratorsAsync=function(){var e=this;this._parent._startPerformanceCounter("Compile shadow generators");for(var t=new Array,n=0,o=this._babylonScene.lights;n<o.length;n++){var a=o[n].getShadowGenerator();a&&t.push(a.forceCompilationAsync())}return Promise.all(t).then(function(){e._parent._endPerformanceCounter("Compile shadow generators")})},r.prototype._forEachExtensions=function(e){for(var t=0,n=this._extensions;t<n.length;t++){var o=n[t];o.enabled&&e(o)}},r.prototype._applyExtensions=function(e,t,n){for(var o=0,a=this._extensions;o<a.length;o++){var s=a[o];if(s.enabled){var i="".concat(s.name,".").concat(t),u=e;u._activeLoaderExtensionFunctions=u._activeLoaderExtensionFunctions||{};var d=u._activeLoaderExtensionFunctions;if(!d[i]){d[i]=!0;try{var h=n(s);if(h)return h}finally{delete d[i]}}}}return null},r.prototype._extensionsOnLoading=function(){this._forEachExtensions(function(e){return e.onLoading&&e.onLoading()})},r.prototype._extensionsOnReady=function(){this._forEachExtensions(function(e){return e.onReady&&e.onReady()})},r.prototype._extensionsLoadSceneAsync=function(e,t){return this._applyExtensions(t,"loadScene",function(n){return n.loadSceneAsync&&n.loadSceneAsync(e,t)})},r.prototype._extensionsLoadNodeAsync=function(e,t,n){return this._applyExtensions(t,"loadNode",function(o){return o.loadNodeAsync&&o.loadNodeAsync(e,t,n)})},r.prototype._extensionsLoadCameraAsync=function(e,t,n){return this._applyExtensions(t,"loadCamera",function(o){return o.loadCameraAsync&&o.loadCameraAsync(e,t,n)})},r.prototype._extensionsLoadVertexDataAsync=function(e,t,n){return this._applyExtensions(t,"loadVertexData",function(o){return o._loadVertexDataAsync&&o._loadVertexDataAsync(e,t,n)})},r.prototype._extensionsLoadMeshPrimitiveAsync=function(e,t,n,o,a,s){return this._applyExtensions(a,"loadMeshPrimitive",function(i){return i._loadMeshPrimitiveAsync&&i._loadMeshPrimitiveAsync(e,t,n,o,a,s)})},r.prototype._extensionsLoadMaterialAsync=function(e,t,n,o,a){return this._applyExtensions(t,"loadMaterial",function(s){return s._loadMaterialAsync&&s._loadMaterialAsync(e,t,n,o,a)})},r.prototype._extensionsCreateMaterial=function(e,t,n){return this._applyExtensions(t,"createMaterial",function(o){return o.createMaterial&&o.createMaterial(e,t,n)})},r.prototype._extensionsLoadMaterialPropertiesAsync=function(e,t,n){return this._applyExtensions(t,"loadMaterialProperties",function(o){return o.loadMaterialPropertiesAsync&&o.loadMaterialPropertiesAsync(e,t,n)})},r.prototype._extensionsLoadTextureInfoAsync=function(e,t,n){return this._applyExtensions(t,"loadTextureInfo",function(o){return o.loadTextureInfoAsync&&o.loadTextureInfoAsync(e,t,n)})},r.prototype._extensionsLoadTextureAsync=function(e,t,n){return this._applyExtensions(t,"loadTexture",function(o){return o._loadTextureAsync&&o._loadTextureAsync(e,t,n)})},r.prototype._extensionsLoadAnimationAsync=function(e,t){return this._applyExtensions(t,"loadAnimation",function(n){return n.loadAnimationAsync&&n.loadAnimationAsync(e,t)})},r.prototype._extensionsLoadAnimationChannelAsync=function(e,t,n,o,a){return this._applyExtensions(n,"loadAnimationChannel",function(s){return s._loadAnimationChannelAsync&&s._loadAnimationChannelAsync(e,t,n,o,a)})},r.prototype._extensionsLoadSkinAsync=function(e,t,n){return this._applyExtensions(n,"loadSkin",function(o){return o._loadSkinAsync&&o._loadSkinAsync(e,t,n)})},r.prototype._extensionsLoadUriAsync=function(e,t,n){return this._applyExtensions(t,"loadUri",function(o){return o._loadUriAsync&&o._loadUriAsync(e,t,n)})},r.prototype._extensionsLoadBufferViewAsync=function(e,t){return this._applyExtensions(t,"loadBufferView",function(n){return n.loadBufferViewAsync&&n.loadBufferViewAsync(e,t)})},r.prototype._extensionsLoadBufferAsync=function(e,t,n,o){return this._applyExtensions(t,"loadBuffer",function(a){return a.loadBufferAsync&&a.loadBufferAsync(e,t,n,o)})},r.LoadExtensionAsync=function(e,t,n,o){if(!t.extensions)return null;var a=t.extensions[n];return a?o("".concat(e,"/extensions/").concat(n),a):null},r.LoadExtraAsync=function(e,t,n,o){if(!t.extras)return null;var a=t.extras[n];return a?o("".concat(e,"/extras/").concat(n),a):null},r.prototype.isExtensionUsed=function(e){return!!this._gltf.extensionsUsed&&this._gltf.extensionsUsed.indexOf(e)!==-1},r.prototype.logOpen=function(e){this._parent._logOpen(e)},r.prototype.logClose=function(){this._parent._logClose()},r.prototype.log=function(e){this._parent._log(e)},r.prototype.startPerformanceCounter=function(e){this._parent._startPerformanceCounter(e)},r.prototype.endPerformanceCounter=function(e){this._parent._endPerformanceCounter(e)},r.DefaultSampler={index:-1},r}();we._CreateGLTF2Loader=function(r){return new V(r)};var Re=N(727),ht="EXT_lights_image_based",ln=function(){function r(e){this.name=ht,this._loader=e,this.enabled=this._loader.isExtensionUsed(ht)}return r.prototype.dispose=function(){this._loader=null,delete this._lights},r.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights}},r.prototype.loadSceneAsync=function(e,t){var n=this;return V.LoadExtensionAsync(e,t,this.name,function(o,a){return(0,T.sH)(n,void 0,void 0,function(){var s,i,u=this;return(0,T.YH)(this,function(d){switch(d.label){case 0:return this._loader._allMaterialsDirtyRequired=!0,(s=new Array).push(this._loader.loadSceneAsync(e,t)),this._loader.logOpen("".concat(o)),i=M.Get("".concat(o,"/light"),this._lights,a.light),s.push(this._loadLightAsync("/extensions/".concat(this.name,"/lights/").concat(a.light),i).then(function(h){u._loader.babylonScene.environmentTexture=h})),this._loader.logClose(),[4,Promise.all(s).then(function(){})];case 1:return[2,d.sent()]}})})})},r.prototype._loadLightAsync=function(e,t){var n=this;if(!t._loaded){var o=new Array;this._loader.logOpen("".concat(e));for(var a=new Array(t.specularImages.length),s=function(d){var h=t.specularImages[d];a[d]=new Array(h.length);for(var m=function(y){var l="".concat(e,"/specularImages/").concat(d,"/").concat(y);i._loader.logOpen("".concat(l));var f=h[y],p=M.Get(l,i._loader.gltf.images,f);o.push(i._loader.loadImageAsync("/images/".concat(f),p).then(function(v){a[d][y]=v})),i._loader.logClose()},_=0;_<h.length;_++)m(_)},i=this,u=0;u<t.specularImages.length;u++)s(u);this._loader.logClose(),t._loaded=Promise.all(o).then(function(){return(0,T.sH)(n,void 0,void 0,function(){var d,h,m,_,y;return(0,T.YH)(this,function(l){switch(l.label){case 0:if((d=new c.RawCubeTexture(this._loader.babylonScene,null,t.specularImageSize)).name=t.name||"environment",t._babylonTexture=d,t.intensity!=null&&(d.level=t.intensity),t.rotation&&(h=c.Quaternion.FromArray(t.rotation),this._loader.babylonScene.useRightHandedSystem||(h=c.Quaternion.Inverse(h)),c.Matrix.FromQuaternionToRef(h,d.getReflectionTextureMatrix())),!t.irradianceCoefficients)throw new Error("".concat(e,": Irradiance coefficients are missing"));return(m=c.SphericalHarmonics.FromArray(t.irradianceCoefficients)).scaleInPlace(t.intensity),m.convertIrradianceToLambertianRadiance(),_=c.SphericalPolynomial.FromHarmonics(m),y=(a.length-1)/Math.log2(t.specularImageSize),[4,d.updateRGBDAsync(a,_,y)];case 1:return[2,l.sent()]}})})})}return t._loaded.then(function(){return t._babylonTexture})},r}();G(ht),H(ht,!0,function(r){return new ln(r)});var pt="EXT_mesh_gpu_instancing",un=function(){function r(e){this.name=pt,this._loader=e,this.enabled=this._loader.isExtensionUsed(pt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadNodeAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i,u,d,h,m=this;return(0,T.YH)(this,function(_){switch(_.label){case 0:return this._loader._disableInstancedMesh++,i=this._loader.loadNodeAsync("/nodes/".concat(t.index),t,n),this._loader._disableInstancedMesh--,t._primitiveBabylonMeshes?[3,2]:[4,i];case 1:case 3:return[2,_.sent()];case 2:return u=new Array,d=0,(h=function(y){if(s.attributes[y]!=null){var l=M.Get("".concat(a,"/attributes/").concat(y),m._loader.gltf.accessors,s.attributes[y]);if(u.push(m._loader._loadFloatAccessorAsync("/accessors/".concat(l.bufferView),l)),d===0)d=l.count;else if(d!==l.count)throw new Error("".concat(a,"/attributes: Instance buffer accessors do not have the same count."))}else u.push(Promise.resolve(null))})("TRANSLATION"),h("ROTATION"),h("SCALE"),[4,i.then(function(y){return(0,T.sH)(m,void 0,void 0,function(){var l,f,p,v,g,b,w,A;return(0,T.YH)(this,function(E){switch(E.label){case 0:return[4,Promise.all(u)];case 1:for(l=E.sent(),f=l[0],p=l[1],v=l[2],g=new Float32Array(16*d),c.TmpVectors.Vector3[0].copyFromFloats(0,0,0),c.TmpVectors.Quaternion[0].copyFromFloats(0,0,0,1),c.TmpVectors.Vector3[1].copyFromFloats(1,1,1),b=0;b<d;++b)f&&c.Vector3.FromArrayToRef(f,3*b,c.TmpVectors.Vector3[0]),p&&c.Quaternion.FromArrayToRef(p,4*b,c.TmpVectors.Quaternion[0]),v&&c.Vector3.FromArrayToRef(v,3*b,c.TmpVectors.Vector3[1]),c.Matrix.ComposeToRef(c.TmpVectors.Vector3[1],c.TmpVectors.Quaternion[0],c.TmpVectors.Vector3[0],c.TmpVectors.Matrix[0]),c.TmpVectors.Matrix[0].copyToArray(g,16*b);for(w=0,A=t._primitiveBabylonMeshes;w<A.length;w++)A[w].thinInstanceSetBuffer("matrix",g,16,!0);return[2,y]}})})})]}})})})},r}();G(pt),H(pt,!0,function(r){return new un(r)});var mt="EXT_meshopt_compression",cn=function(){function r(e){this.name=mt,this.enabled=e.isExtensionUsed(mt),this._loader=e}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadBufferViewAsync=function(e,t){var n=this;return V.LoadExtensionAsync(e,t,this.name,function(o,a){return(0,T.sH)(n,void 0,void 0,function(){var s,i,u=this;return(0,T.YH)(this,function(d){switch(d.label){case 0:return(s=t)._meshOptData?[4,s._meshOptData]:[3,2];case 1:case 3:return[2,d.sent()];case 2:return i=M.Get("".concat(e,"/buffer"),this._loader.gltf.buffers,a.buffer),s._meshOptData=this._loader.loadBufferAsync("/buffers/".concat(i.index),i,a.byteOffset||0,a.byteLength).then(function(h){return(0,T.sH)(u,void 0,void 0,function(){return(0,T.YH)(this,function(m){switch(m.label){case 0:return[4,c.MeshoptCompression.Default.decodeGltfBufferAsync(h,a.count,a.byteStride,a.mode,a.filter)];case 1:return[2,m.sent()]}})})}),[4,s._meshOptData]}})})})},r}();G(mt),H(mt,!0,function(r){return new cn(r)});var _t="EXT_texture_webp",fn=function(){function r(e){this.name=_t,this._loader=e,this.enabled=e.isExtensionUsed(_t)}return r.prototype.dispose=function(){this._loader=null},r.prototype._loadTextureAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i,u;return(0,T.YH)(this,function(d){switch(d.label){case 0:return i=t.sampler==null?V.DefaultSampler:M.Get("".concat(e,"/sampler"),this._loader.gltf.samplers,t.sampler),u=M.Get("".concat(a,"/source"),this._loader.gltf.images,s.source),[4,this._loader._createTextureAsync(e,i,u,function(h){n(h)},void 0,!t._textureInfo.nonColorData)];case 1:return[2,d.sent()]}})})})},r}();G(_t),H(_t,!0,function(r){return new fn(r)});var vt="EXT_texture_avif",dn=function(){function r(e){this.name=vt,this._loader=e,this.enabled=e.isExtensionUsed(vt)}return r.prototype.dispose=function(){this._loader=null},r.prototype._loadTextureAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i,u;return(0,T.YH)(this,function(d){switch(d.label){case 0:return i=t.sampler==null?V.DefaultSampler:M.Get("".concat(e,"/sampler"),this._loader.gltf.samplers,t.sampler),u=M.Get("".concat(a,"/source"),this._loader.gltf.images,s.source),[4,this._loader._createTextureAsync(e,i,u,function(h){n(h)},void 0,!t._textureInfo.nonColorData)];case 1:return[2,d.sent()]}})})})},r}();G(vt),H(vt,!0,function(r){return new dn(r)});var yt="EXT_lights_ies",hn=function(){function r(e){this.name=yt,this._loader=e,this.enabled=this._loader.isExtensionUsed(yt)}return r.prototype.dispose=function(){this._loader=null,delete this._lights},r.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights,M.Assign(this._lights)}},r.prototype.loadNodeAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i,u,d,h,m,_=this;return(0,T.YH)(this,function(y){switch(y.label){case 0:return this._loader._allMaterialsDirtyRequired=!0,[4,this._loader.loadNodeAsync(e,t,function(l){var f=(u=M.Get(a,_._lights,s.light)).name||l.name;_._loader.babylonScene._blockEntityCollection=!!_._loader._assetContainer,(i=new c.SpotLight(f,c.Vector3.Zero(),c.Vector3.Backward(),0,1,_._loader.babylonScene)).angle=Math.PI/2,i.innerAngle=0,i._parentContainer=_._loader._assetContainer,_._loader.babylonScene._blockEntityCollection=!1,u._babylonLight=i,i.falloffType=c.Light.FALLOFF_GLTF,i.diffuse=s.color?c.Color3.FromArray(s.color):c.Color3.White(),i.intensity=s.multiplier||1,i.range=Number.MAX_VALUE,i.parent=l,_._loader._babylonLights.push(i),V.AddPointerMetadata(i,a),n(l)})];case 1:return d=y.sent(),u.uri?[4,this._loader.loadUriAsync(e,u,u.uri)]:[3,3];case 2:return h=y.sent(),[3,5];case 3:return m=M.Get("".concat(e,"/bufferView"),this._loader.gltf.bufferViews,u.bufferView),[4,this._loader.loadBufferViewAsync("/bufferViews/".concat(m.index),m)];case 4:h=y.sent(),y.label=5;case 5:return i.iesProfileTexture=new c.Texture(name+"_iesProfile",this._loader.babylonScene,!0,!1,void 0,null,null,h,!0,void 0,void 0,void 0,void 0,".ies"),[2,d]}})})})},r}();G(yt),H(yt,!0,function(r){return new hn(r)});var gt="KHR_draco_mesh_compression",pn=function(){function r(e){this.name=gt,this.useNormalizedFlagFromAccessor=!0,this._loader=e,this.enabled=c.DracoDecoder.DefaultAvailable&&this._loader.isExtensionUsed(gt)}return r.prototype.dispose=function(){delete this.dracoDecoder,this._loader=null},r.prototype._loadVertexDataAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i,u,d,h,m=this;return(0,T.YH)(this,function(_){switch(_.label){case 0:if(t.mode!=null&&t.mode!==4&&t.mode!==5)throw new Error("".concat(e,": Unsupported mode ").concat(t.mode));return i={},u={},(d=function(y,l){var f=s.attributes[y];if(f!=null&&(n._delayInfo=n._delayInfo||[],n._delayInfo.indexOf(l)===-1&&n._delayInfo.push(l),i[l]=f,m.useNormalizedFlagFromAccessor)){var p=M.TryGet(m._loader.gltf.accessors,t.attributes[y]);p&&(u[l]=p.normalized||!1)}})("POSITION",c.VertexBuffer.PositionKind),d("NORMAL",c.VertexBuffer.NormalKind),d("TANGENT",c.VertexBuffer.TangentKind),d("TEXCOORD_0",c.VertexBuffer.UVKind),d("TEXCOORD_1",c.VertexBuffer.UV2Kind),d("TEXCOORD_2",c.VertexBuffer.UV3Kind),d("TEXCOORD_3",c.VertexBuffer.UV4Kind),d("TEXCOORD_4",c.VertexBuffer.UV5Kind),d("TEXCOORD_5",c.VertexBuffer.UV6Kind),d("JOINTS_0",c.VertexBuffer.MatricesIndicesKind),d("WEIGHTS_0",c.VertexBuffer.MatricesWeightsKind),d("COLOR_0",c.VertexBuffer.ColorKind),(h=M.Get(a,this._loader.gltf.bufferViews,s.bufferView))._dracoBabylonGeometry||(h._dracoBabylonGeometry=this._loader.loadBufferViewAsync("/bufferViews/".concat(h.index),h).then(function(y){return(0,T.sH)(m,void 0,void 0,function(){var l,f,p;return(0,T.YH)(this,function(v){switch(v.label){case 0:return l=this.dracoDecoder||c.DracoDecoder.Default,f=M.TryGet(this._loader.gltf.accessors,t.attributes.POSITION),p=this._loader.parent.alwaysComputeBoundingBox||n.skeleton||!f?null:sn(f),[4,l._decodeMeshToGeometryForGltfAsync(n.name,this._loader.babylonScene,y,i,u,p).catch(function(g){throw new Error("".concat(e,": ").concat(g.message))})];case 1:return[2,v.sent()]}})})})),[4,h._dracoBabylonGeometry];case 1:return[2,_.sent()]}})})})},r}();G(gt),H(gt,!0,function(r){return new pn(r)});var bt="KHR_lights_punctual",mn=function(){function r(e){this.name=bt,this._loader=e,this.enabled=this._loader.isExtensionUsed(bt)}return r.prototype.dispose=function(){this._loader=null,delete this._lights},r.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._lights=t.lights,M.Assign(this._lights)}},r.prototype.loadNodeAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i=this;return(0,T.YH)(this,function(u){switch(u.label){case 0:return this._loader._allMaterialsDirtyRequired=!0,[4,this._loader.loadNodeAsync(e,t,function(d){var h,m=M.Get(a,i._lights,s.light),_=m.name||d.name;switch(i._loader.babylonScene._blockEntityCollection=!!i._loader._assetContainer,m.type){case"directional":var y=new c.DirectionalLight(_,c.Vector3.Backward(),i._loader.babylonScene);y.position.setAll(0),h=y;break;case"point":h=new c.PointLight(_,c.Vector3.Zero(),i._loader.babylonScene);break;case"spot":var l=new c.SpotLight(_,c.Vector3.Zero(),c.Vector3.Backward(),0,1,i._loader.babylonScene);l.angle=2*(m.spot&&m.spot.outerConeAngle||Math.PI/4),l.innerAngle=2*(m.spot&&m.spot.innerConeAngle||0),h=l;break;default:throw i._loader.babylonScene._blockEntityCollection=!1,new Error("".concat(a,": Invalid light type (").concat(m.type,")"))}h._parentContainer=i._loader._assetContainer,i._loader.babylonScene._blockEntityCollection=!1,m._babylonLight=h,h.falloffType=c.Light.FALLOFF_GLTF,h.diffuse=m.color?c.Color3.FromArray(m.color):c.Color3.White(),h.intensity=m.intensity==null?1:m.intensity,h.range=m.range==null?Number.MAX_VALUE:m.range,h.parent=d,i._loader._babylonLights.push(h),V.AddPointerMetadata(h,a),n(d)})];case 1:return[2,u.sent()]}})})})},r}();G(bt),H(bt,!0,function(r){return new mn(r)});var Tt="KHR_materials_pbrSpecularGlossiness",_n=function(){function r(e){this.name=Tt,this.order=200,this._loader=e,this.enabled=this._loader.isExtensionUsed(Tt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialBasePropertiesAsync(e,t,n)),i.push(this._loadSpecularGlossinessPropertiesAsync(a,s,n)),this._loader.loadMaterialAlphaProperties(e,t,n),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadSpecularGlossinessPropertiesAsync=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=new Array;return n.metallic=null,n.roughness=null,t.diffuseFactor?(n.albedoColor=c.Color3.FromArray(t.diffuseFactor),n.alpha=t.diffuseFactor[3]):n.albedoColor=c.Color3.White(),n.reflectivityColor=t.specularFactor?c.Color3.FromArray(t.specularFactor):c.Color3.White(),n.microSurface=t.glossinessFactor==null?1:t.glossinessFactor,t.diffuseTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/diffuseTexture"),t.diffuseTexture,function(a){a.name="".concat(n.name," (Diffuse)"),n.albedoTexture=a})),t.specularGlossinessTexture&&(o.push(this._loader.loadTextureInfoAsync("".concat(e,"/specularGlossinessTexture"),t.specularGlossinessTexture,function(a){a.name="".concat(n.name," (Specular Glossiness)"),n.reflectivityTexture=a,n.reflectivityTexture.hasAlpha=!0})),n.useMicroSurfaceFromReflectivityMapAlpha=!0),Promise.all(o).then(function(){})},r}();G(Tt),H(Tt,!0,function(r){return new _n(r)});var xt="KHR_materials_unlit",vn=function(){function r(e){this.name=xt,this.order=210,this._loader=e,this.enabled=this._loader.isExtensionUsed(xt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(){return(0,T.sH)(o,void 0,void 0,function(){return(0,T.YH)(this,function(a){switch(a.label){case 0:return[4,this._loadUnlitPropertiesAsync(e,t,n)];case 1:return[2,a.sent()]}})})})},r.prototype._loadUnlitPropertiesAsync=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=new Array;n.unlit=!0;var a=t.pbrMetallicRoughness;return a&&(a.baseColorFactor?(n.albedoColor=c.Color3.FromArray(a.baseColorFactor),n.alpha=a.baseColorFactor[3]):n.albedoColor=c.Color3.White(),a.baseColorTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/baseColorTexture"),a.baseColorTexture,function(s){s.name="".concat(n.name," (Base Color)"),n.albedoTexture=s}))),t.doubleSided&&(n.backFaceCulling=!1,n.twoSidedLighting=!0),this._loader.loadMaterialAlphaProperties(e,t,n),Promise.all(o).then(function(){})},r}();G(xt),H(xt,!0,function(r){return new vn(r)});var At="KHR_materials_clearcoat",yn=function(){function r(e){this.name=At,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(At)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadClearCoatPropertiesAsync(a,s,n)),[4,Promise.all(i)];case 1:return u.sent(),[2]}})})})},r.prototype._loadClearCoatPropertiesAsync=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=new Array;return n.clearCoat.isEnabled=!0,n.clearCoat.useRoughnessFromMainTexture=!1,n.clearCoat.remapF0OnInterfaceChange=!1,t.clearcoatFactor!=null?n.clearCoat.intensity=t.clearcoatFactor:n.clearCoat.intensity=0,t.clearcoatTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/clearcoatTexture"),t.clearcoatTexture,function(a){a.name="".concat(n.name," (ClearCoat)"),n.clearCoat.texture=a})),t.clearcoatRoughnessFactor!=null?n.clearCoat.roughness=t.clearcoatRoughnessFactor:n.clearCoat.roughness=0,t.clearcoatRoughnessTexture&&(t.clearcoatRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync("".concat(e,"/clearcoatRoughnessTexture"),t.clearcoatRoughnessTexture,function(a){a.name="".concat(n.name," (ClearCoat Roughness)"),n.clearCoat.textureRoughness=a}))),t.clearcoatNormalTexture&&(t.clearcoatNormalTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync("".concat(e,"/clearcoatNormalTexture"),t.clearcoatNormalTexture,function(a){a.name="".concat(n.name," (ClearCoat Normal)"),n.clearCoat.bumpTexture=a})),n.invertNormalMapX=!n.getScene().useRightHandedSystem,n.invertNormalMapY=n.getScene().useRightHandedSystem,t.clearcoatNormalTexture.scale!=null&&(n.clearCoat.bumpTexture.level=t.clearcoatNormalTexture.scale)),Promise.all(o).then(function(){})},r}();G(At),H(At,!0,function(r){return new yn(r)});var wt="KHR_materials_iridescence",gn=function(){function r(e){this.name=wt,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(wt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadIridescencePropertiesAsync(a,s,n)),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadIridescencePropertiesAsync=function(e,t,n){var o,a,s,i,u;if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var d=new Array;return n.iridescence.isEnabled=!0,n.iridescence.intensity=(o=t.iridescenceFactor)!==null&&o!==void 0?o:0,n.iridescence.indexOfRefraction=(s=(a=t.iridescenceIor)!==null&&a!==void 0?a:t.iridescenceIOR)!==null&&s!==void 0?s:1.3,n.iridescence.minimumThickness=(i=t.iridescenceThicknessMinimum)!==null&&i!==void 0?i:100,n.iridescence.maximumThickness=(u=t.iridescenceThicknessMaximum)!==null&&u!==void 0?u:400,t.iridescenceTexture&&d.push(this._loader.loadTextureInfoAsync("".concat(e,"/iridescenceTexture"),t.iridescenceTexture,function(h){h.name="".concat(n.name," (Iridescence)"),n.iridescence.texture=h})),t.iridescenceThicknessTexture&&d.push(this._loader.loadTextureInfoAsync("".concat(e,"/iridescenceThicknessTexture"),t.iridescenceThicknessTexture,function(h){h.name="".concat(n.name," (Iridescence Thickness)"),n.iridescence.thicknessTexture=h})),Promise.all(d).then(function(){})},r}();G(wt),H(wt,!0,function(r){return new gn(r)});var Et="KHR_materials_anisotropy",bn=function(){function r(e){this.name=Et,this.order=195,this._loader=e,this.enabled=this._loader.isExtensionUsed(Et)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadIridescencePropertiesAsync(a,s,n)),[4,Promise.all(i)];case 1:return u.sent(),[2]}})})})},r.prototype._loadIridescencePropertiesAsync=function(e,t,n){return(0,T.sH)(this,void 0,void 0,function(){var o,a,s;return(0,T.YH)(this,function(i){switch(i.label){case 0:if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));return o=new Array,n.anisotropy.isEnabled=!0,n.anisotropy.intensity=(a=t.anisotropyStrength)!==null&&a!==void 0?a:0,n.anisotropy.angle=(s=t.anisotropyRotation)!==null&&s!==void 0?s:0,t.anisotropyTexture&&(t.anisotropyTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync("".concat(e,"/anisotropyTexture"),t.anisotropyTexture,function(u){u.name="".concat(n.name," (Anisotropy Intensity)"),n.anisotropy.texture=u}))),[4,Promise.all(o)];case 1:return i.sent(),[2]}})})},r}();G(Et),H(Et,!0,function(r){return new bn(r)});var Ot="KHR_materials_emissive_strength",Tn=function(){function r(e){this.name=Ot,this.order=170,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ot)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i=this;return(0,T.YH)(this,function(u){switch(u.label){case 0:return[4,this._loader.loadMaterialPropertiesAsync(e,t,n).then(function(){i._loadEmissiveProperties(a,s,n)})];case 1:return[2,u.sent()]}})})})},r.prototype._loadEmissiveProperties=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));t.emissiveStrength!==void 0&&(n.emissiveIntensity=t.emissiveStrength)},r}();G(Ot),H(Ot,!0,function(r){return new Tn(r)});var Mt="KHR_materials_sheen",xn=function(){function r(e){this.name=Mt,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(Mt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadSheenPropertiesAsync(a,s,n)),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadSheenPropertiesAsync=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=new Array;return n.sheen.isEnabled=!0,n.sheen.intensity=1,t.sheenColorFactor!=null?n.sheen.color=c.Color3.FromArray(t.sheenColorFactor):n.sheen.color=c.Color3.Black(),t.sheenColorTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/sheenColorTexture"),t.sheenColorTexture,function(a){a.name="".concat(n.name," (Sheen Color)"),n.sheen.texture=a})),t.sheenRoughnessFactor!==void 0?n.sheen.roughness=t.sheenRoughnessFactor:n.sheen.roughness=0,t.sheenRoughnessTexture&&(t.sheenRoughnessTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync("".concat(e,"/sheenRoughnessTexture"),t.sheenRoughnessTexture,function(a){a.name="".concat(n.name," (Sheen Roughness)"),n.sheen.textureRoughness=a}))),n.sheen.albedoScaling=!0,n.sheen.useRoughnessFromMainTexture=!1,Promise.all(o).then(function(){})},r}();G(Mt),H(Mt,!0,function(r){return new xn(r)});var Ct="KHR_materials_specular",An=function(){function r(e){this.name=Ct,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ct)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadSpecularPropertiesAsync(a,s,n)),s.extensions&&s.extensions.EXT_materials_specular_edge_color&&n instanceof c.PBRMaterial&&s.extensions.EXT_materials_specular_edge_color.specularEdgeColorEnabled&&(n.brdf.dielectricSpecularModel=c.Constants.MATERIAL_DIELECTRIC_SPECULAR_MODEL_OPENPBR,n.brdf.conductorSpecularModel=c.Constants.MATERIAL_CONDUCTOR_SPECULAR_MODEL_OPENPBR),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadSpecularPropertiesAsync=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=new Array;return t.specularFactor!==void 0&&(n.metallicF0Factor=t.specularFactor),t.specularColorFactor!==void 0&&(n.metallicReflectanceColor=c.Color3.FromArray(t.specularColorFactor)),t.specularTexture&&(t.specularTexture.nonColorData=!0,o.push(this._loader.loadTextureInfoAsync("".concat(e,"/specularTexture"),t.specularTexture,function(a){a.name="".concat(n.name," (Specular)"),n.metallicReflectanceTexture=a,n.useOnlyMetallicFromMetallicReflectanceTexture=!0}))),t.specularColorTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/specularColorTexture"),t.specularColorTexture,function(a){a.name="".concat(n.name," (Specular Color)"),n.reflectanceTexture=a})),Promise.all(o).then(function(){})},r}();G(Ct),H(Ct,!0,function(r){return new An(r)});var Lt="KHR_materials_ior",wn=function(){function r(e){this.name=Lt,this.order=180,this._loader=e,this.enabled=this._loader.isExtensionUsed(Lt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadIorPropertiesAsync(a,s,n)),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadIorPropertiesAsync=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));return t.ior!==void 0?n.indexOfRefraction=t.ior:n.indexOfRefraction=r._DEFAULT_IOR,Promise.resolve()},r._DEFAULT_IOR=1.5,r}();G(Lt),H(Lt,!0,function(r){return new wn(r)});var pe="KHR_materials_variants",En=function(){function r(e){this.name=pe,this._loader=e,this.enabled=this._loader.isExtensionUsed(pe)}return r.prototype.dispose=function(){this._loader=null},r.GetAvailableVariants=function(e){var t=this._GetExtensionMetadata(e);return t?Object.keys(t.variants):[]},r.prototype.getAvailableVariants=function(e){return r.GetAvailableVariants(e)},r.SelectVariant=function(e,t){var n=this._GetExtensionMetadata(e);if(!n)throw new Error("Cannot select variant on a glTF mesh that does not have the ".concat(pe," extension"));var o=function(i){var u=n.variants[i];if(u)for(var d=0,h=u;d<h.length;d++){var m=h[d];m.mesh.material=m.material}};if(t instanceof Array)for(var a=0,s=t;a<s.length;a++)o(s[a]);else o(t);n.lastSelected=t},r.prototype.selectVariant=function(e,t){r.SelectVariant(e,t)},r.Reset=function(e){var t=this._GetExtensionMetadata(e);if(!t)throw new Error("Cannot reset on a glTF mesh that does not have the ".concat(pe," extension"));for(var n=0,o=t.original;n<o.length;n++){var a=o[n];a.mesh.material=a.material}t.lastSelected=null},r.prototype.reset=function(e){r.Reset(e)},r.GetLastSelectedVariant=function(e){var t=this._GetExtensionMetadata(e);if(!t)throw new Error("Cannot get the last selected variant on a glTF mesh that does not have the ".concat(pe," extension"));return t.lastSelected},r.prototype.getLastSelectedVariant=function(e){return r.GetLastSelectedVariant(e)},r._GetExtensionMetadata=function(e){var t,n;return((n=(t=e==null?void 0:e._internalMetadata)===null||t===void 0?void 0:t.gltf)===null||n===void 0?void 0:n[pe])||null},r.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._variants=t.variants}},r.prototype.onReady=function(){var e,t=this._loader.rootBabylonMesh;if(t){var n=this._loader.parent.extensionOptions[pe];n!=null&&n.defaultVariant&&r.SelectVariant(t,n.defaultVariant),(e=n==null?void 0:n.onLoaded)===null||e===void 0||e.call(n,{get variants(){return r.GetAvailableVariants(t)},get selectedVariant(){var o=r.GetLastSelectedVariant(t);return o?Array.isArray(o)?o[0]:o:r.GetAvailableVariants(t)[0]},set selectedVariant(o){r.SelectVariant(t,o)}})}},r.prototype._loadMeshPrimitiveAsync=function(e,t,n,o,a,s){var i=this;return V.LoadExtensionAsync(e,a,this.name,function(u,d){return(0,T.sH)(i,void 0,void 0,function(){var h,m=this;return(0,T.YH)(this,function(_){switch(_.label){case 0:return(h=new Array).push(this._loader._loadMeshPrimitiveAsync(e,t,n,o,a,function(y){if(s(y),y instanceof c.Mesh){var l=V._GetDrawMode(e,a.mode),f=m._loader.rootBabylonMesh,p=f?f._internalMetadata=f._internalMetadata||{}:{},v=p.gltf=p.gltf||{},g=v[pe]=v[pe]||{lastSelected:null,original:[],variants:{}};g.original.push({mesh:y,material:y.material});for(var b=function(A){var E=d.mappings[A],R=M.Get("".concat(u,"/mappings/").concat(A,"/material"),m._loader.gltf.materials,E.material);h.push(m._loader._loadMaterialAsync("#/materials/".concat(E.material),R,y,l,function(O){for(var I=function(S){var B=E.variants[S],P=M.Get("/extensions/".concat(pe,"/variants/").concat(B),m._variants,B);g.variants[P.name]=g.variants[P.name]||[],g.variants[P.name].push({mesh:y,material:O}),y.onClonedObservable.add(function(re){var U=re,W=null,F=U;do{if(!(F=F.parent))return;W=r._GetExtensionMetadata(F)}while(W===null);if(f&&W===r._GetExtensionMetadata(f)){for(var K in F._internalMetadata={},f._internalMetadata)F._internalMetadata[K]=f._internalMetadata[K];for(var K in F._internalMetadata.gltf=[],f._internalMetadata.gltf)F._internalMetadata.gltf[K]=f._internalMetadata.gltf[K];F._internalMetadata.gltf[pe]={lastSelected:null,original:[],variants:{}};for(var Y=0,ie=W.original;Y<ie.length;Y++){var z=ie[Y];F._internalMetadata.gltf[pe].original.push({mesh:z.mesh,material:z.material})}for(var K in W.variants)if(Object.prototype.hasOwnProperty.call(W.variants,K)){F._internalMetadata.gltf[pe].variants[K]=[];for(var ee=0,te=W.variants[K];ee<te.length;ee++){var se=te[ee];F._internalMetadata.gltf[pe].variants[K].push({mesh:se.mesh,material:se.material})}}W=F._internalMetadata.gltf[pe]}for(var D=0,J=W.original;D<J.length;D++)(k=J[D]).mesh===y&&(k.mesh=U);for(var Q=0,oe=W.variants[P.name];Q<oe.length;Q++){var k;(k=oe[Q]).mesh===y&&(k.mesh=U)}})},L=0;L<E.variants.length;++L)I(L)}))},w=0;w<d.mappings.length;++w)b(w)}})),[4,Promise.all(h).then(function(y){return y[0]})];case 1:return[2,_.sent()]}})})})},r}();G(pe),H(pe,!0,function(r){return new En(r)});var so=function(){function r(e,t){var n=this;this._opaqueRenderTarget=null,this._opaqueMeshesCache=[],this._transparentMeshesCache=[],this._materialObservers={},this._options=(0,T.Cl)((0,T.Cl)({},r._GetDefaultOptions()),e),this._scene=t,this._scene._transmissionHelper=this,this.onErrorObservable=new c.Observable,this._scene.onDisposeObservable.addOnce(function(){n.dispose()}),this._parseScene(),this._setupRenderTargets()}return r._GetDefaultOptions=function(){return{renderSize:1024,samples:4,lodGenerationScale:1,lodGenerationOffset:-4,renderTargetTextureType:c.Constants.TEXTURETYPE_HALF_FLOAT,generateMipmaps:!0}},r.prototype.updateOptions=function(e){var t=this,n=Object.keys(e).filter(function(s){return t._options[s]!==e[s]});if(n.length){var o=(0,T.Cl)((0,T.Cl)({},this._options),e),a=this._options;this._options=o,o.renderSize===a.renderSize&&o.renderTargetTextureType===a.renderTargetTextureType&&o.generateMipmaps===a.generateMipmaps&&this._opaqueRenderTarget?(this._opaqueRenderTarget.samples=o.samples,this._opaqueRenderTarget.lodGenerationScale=o.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=o.lodGenerationOffset):this._setupRenderTargets()}},r.prototype.getOpaqueTarget=function(){return this._opaqueRenderTarget},r.prototype._shouldRenderAsTransmission=function(e){return!!e&&!!(e instanceof c.PBRMaterial&&e.subSurface.isRefractionEnabled)},r.prototype._addMesh=function(e){var t=this;this._materialObservers[e.uniqueId]=e.onMaterialChangedObservable.add(this._onMeshMaterialChanged.bind(this)),c.Tools.SetImmediate(function(){t._shouldRenderAsTransmission(e.material)?(e.material.refractionTexture=t._opaqueRenderTarget,t._transparentMeshesCache.indexOf(e)===-1&&t._transparentMeshesCache.push(e)):t._opaqueMeshesCache.indexOf(e)===-1&&t._opaqueMeshesCache.push(e)})},r.prototype._removeMesh=function(e){e.onMaterialChangedObservable.remove(this._materialObservers[e.uniqueId]),delete this._materialObservers[e.uniqueId];var t=this._transparentMeshesCache.indexOf(e);t!==-1&&this._transparentMeshesCache.splice(t,1),(t=this._opaqueMeshesCache.indexOf(e))!==-1&&this._opaqueMeshesCache.splice(t,1)},r.prototype._parseScene=function(){this._scene.meshes.forEach(this._addMesh.bind(this)),this._scene.onNewMeshAddedObservable.add(this._addMesh.bind(this)),this._scene.onMeshRemovedObservable.add(this._removeMesh.bind(this))},r.prototype._onMeshMaterialChanged=function(e){var t=this._transparentMeshesCache.indexOf(e),n=this._opaqueMeshesCache.indexOf(e);this._shouldRenderAsTransmission(e.material)?(e.material instanceof c.PBRMaterial&&(e.material.subSurface.refractionTexture=this._opaqueRenderTarget),n!==-1?(this._opaqueMeshesCache.splice(n,1),this._transparentMeshesCache.push(e)):t===-1&&this._transparentMeshesCache.push(e)):t!==-1?(this._transparentMeshesCache.splice(t,1),this._opaqueMeshesCache.push(e)):n===-1&&this._opaqueMeshesCache.push(e)},r.prototype._isRenderTargetValid=function(){var e;return((e=this._opaqueRenderTarget)===null||e===void 0?void 0:e.getInternalTexture())!==null},r.prototype._setupRenderTargets=function(){var e,t,n,o=this;this._opaqueRenderTarget&&this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=new c.RenderTargetTexture("opaqueSceneTexture",this._options.renderSize,this._scene,this._options.generateMipmaps,void 0,this._options.renderTargetTextureType),this._opaqueRenderTarget.ignoreCameraViewport=!0,this._opaqueRenderTarget.renderList=this._opaqueMeshesCache,this._opaqueRenderTarget.clearColor=(t=(e=this._options.clearColor)===null||e===void 0?void 0:e.clone())!==null&&t!==void 0?t:this._scene.clearColor.clone(),this._opaqueRenderTarget.gammaSpace=!1,this._opaqueRenderTarget.lodGenerationScale=this._options.lodGenerationScale,this._opaqueRenderTarget.lodGenerationOffset=this._options.lodGenerationOffset,this._opaqueRenderTarget.samples=this._options.samples,this._opaqueRenderTarget.renderSprites=!0,this._opaqueRenderTarget.renderParticles=!0,this._opaqueRenderTarget.disableImageProcessing=!0,this._opaqueRenderTarget.onBeforeBindObservable.add(function(u){n=o._scene.environmentIntensity,o._scene.environmentIntensity=1,o._options.clearColor?u.clearColor.copyFrom(o._options.clearColor):o._scene.clearColor.toLinearSpaceToRef(u.clearColor,o._scene.getEngine().useExactSrgbConversions)}),this._opaqueRenderTarget.onAfterUnbindObservable.add(function(){o._scene.environmentIntensity=n});for(var a=0,s=this._transparentMeshesCache;a<s.length;a++){var i=s[a];this._shouldRenderAsTransmission(i.material)&&(i.material.refractionTexture=this._opaqueRenderTarget)}},r.prototype.dispose=function(){this._scene._transmissionHelper=void 0,this._opaqueRenderTarget&&(this._opaqueRenderTarget.dispose(),this._opaqueRenderTarget=null),this._transparentMeshesCache=[],this._opaqueMeshesCache=[]},r}(),Rt="KHR_materials_transmission",On=function(){function r(e){this.name=Rt,this.order=175,this._loader=e,this.enabled=this._loader.isExtensionUsed(Rt),this.enabled&&(e.parent.transparencyAsCoverage=!0)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadTransparentPropertiesAsync(a,t,n,s)),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadTransparentPropertiesAsync=function(e,t,n,o){var a,s;if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var i=n;if(i.subSurface.isRefractionEnabled=!0,i.subSurface.volumeIndexOfRefraction=1,i.subSurface.useAlbedoToTintRefraction=!0,o.transmissionFactor===void 0)return i.subSurface.refractionIntensity=0,i.subSurface.isRefractionEnabled=!1,Promise.resolve();i.subSurface.refractionIntensity=o.transmissionFactor;var u=i.getScene();return i.subSurface.refractionIntensity&&!u._transmissionHelper?new so({},i.getScene()):i.subSurface.refractionIntensity&&!(!((a=u._transmissionHelper)===null||a===void 0)&&a._isRenderTargetValid())&&((s=u._transmissionHelper)===null||s===void 0||s._setupRenderTargets()),i.subSurface.minimumThickness=0,i.subSurface.maximumThickness=0,o.transmissionTexture?(o.transmissionTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(e,"/transmissionTexture"),o.transmissionTexture,void 0).then(function(d){d.name="".concat(n.name," (Transmission)"),i.subSurface.refractionIntensityTexture=d,i.subSurface.useGltfStyleTextures=!0})):Promise.resolve()},r}();G(Rt),H(Rt,!0,function(r){return new On(r)});var Ft="KHR_materials_diffuse_transmission",Mn=function(){function r(e){this.name=Ft,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ft),this.enabled&&(e.parent.transparencyAsCoverage=!0)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadTranslucentPropertiesAsync(a,t,n,s)),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadTranslucentPropertiesAsync=function(e,t,n,o){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var a=n;if(a.subSurface.isTranslucencyEnabled=!0,a.subSurface.volumeIndexOfRefraction=1,a.subSurface.minimumThickness=0,a.subSurface.maximumThickness=0,a.subSurface.useAlbedoToTintTranslucency=!1,o.diffuseTransmissionFactor===void 0)return a.subSurface.translucencyIntensity=0,a.subSurface.isTranslucencyEnabled=!1,Promise.resolve();a.subSurface.translucencyIntensity=o.diffuseTransmissionFactor;var s=new Array;return a.subSurface.useGltfStyleTextures=!0,o.diffuseTransmissionTexture&&(o.diffuseTransmissionTexture.nonColorData=!0,s.push(this._loader.loadTextureInfoAsync("".concat(e,"/diffuseTransmissionTexture"),o.diffuseTransmissionTexture).then(function(i){i.name="".concat(n.name," (Diffuse Transmission)"),a.subSurface.translucencyIntensityTexture=i}))),o.diffuseTransmissionColorFactor!==void 0?a.subSurface.translucencyColor=c.Color3.FromArray(o.diffuseTransmissionColorFactor):a.subSurface.translucencyColor=c.Color3.White(),o.diffuseTransmissionColorTexture&&s.push(this._loader.loadTextureInfoAsync("".concat(e,"/diffuseTransmissionColorTexture"),o.diffuseTransmissionColorTexture).then(function(i){i.name="".concat(n.name," (Diffuse Transmission Color)"),a.subSurface.translucencyColorTexture=i})),Promise.all(s).then(function(){})},r}();G(Ft),H(Ft,!0,function(r){return new Mn(r)});var Nt="KHR_materials_volume",Cn=function(){function r(e){this.name=Nt,this.order=173,this._loader=e,this.enabled=this._loader.isExtensionUsed(Nt),this.enabled&&this._loader._disableInstancedMesh++}return r.prototype.dispose=function(){this.enabled&&this._loader._disableInstancedMesh--,this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadVolumePropertiesAsync(a,t,n,s)),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadVolumePropertiesAsync=function(e,t,n,o){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));if(!n.subSurface.isRefractionEnabled&&!n.subSurface.isTranslucencyEnabled||!o.thicknessFactor)return Promise.resolve();n.subSurface.volumeIndexOfRefraction=n.indexOfRefraction;var a=o.attenuationDistance!==void 0?o.attenuationDistance:Number.MAX_VALUE;return n.subSurface.tintColorAtDistance=a,o.attenuationColor!==void 0&&o.attenuationColor.length==3&&n.subSurface.tintColor.copyFromFloats(o.attenuationColor[0],o.attenuationColor[1],o.attenuationColor[2]),n.subSurface.minimumThickness=0,n.subSurface.maximumThickness=o.thicknessFactor,n.subSurface.useThicknessAsDepth=!0,o.thicknessTexture?(o.thicknessTexture.nonColorData=!0,this._loader.loadTextureInfoAsync("".concat(e,"/thicknessTexture"),o.thicknessTexture).then(function(s){s.name="".concat(n.name," (Thickness)"),n.subSurface.thicknessTexture=s,n.subSurface.useGltfStyleTextures=!0})):Promise.resolve()},r}();G(Nt),H(Nt,!0,function(r){return new Cn(r)});var Pt="KHR_materials_dispersion",Ln=function(){function r(e){this.name=Pt,this.order=174,this._loader=e,this.enabled=this._loader.isExtensionUsed(Pt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadDispersionPropertiesAsync(a,t,n,s)),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadDispersionPropertiesAsync=function(e,t,n,o){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));return n.subSurface.isRefractionEnabled&&o.dispersion&&(n.subSurface.isDispersionEnabled=!0,n.subSurface.dispersion=o.dispersion),Promise.resolve()},r}();G(Pt),H(Pt,!0,function(r){return new Ln(r)});var It="EXT_materials_diffuse_roughness",Rn=function(){function r(e){this.name=It,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(It)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:return(i=new Array).push(this._loader.loadMaterialPropertiesAsync(e,t,n)),i.push(this._loadDiffuseRoughnessPropertiesAsync(a,s,n)),[4,Promise.all(i).then(function(){})];case 1:return[2,u.sent()]}})})})},r.prototype._loadDiffuseRoughnessPropertiesAsync=function(e,t,n){if(!(n instanceof c.PBRMaterial))throw new Error("".concat(e,": Material type not supported"));var o=new Array;return n.brdf.baseDiffuseModel=c.Constants.MATERIAL_DIFFUSE_MODEL_E_OREN_NAYAR,t.diffuseRoughnessFactor!=null?n.baseDiffuseRoughness=t.diffuseRoughnessFactor:n.baseDiffuseRoughness=0,t.diffuseRoughnessTexture&&o.push(this._loader.loadTextureInfoAsync("".concat(e,"/diffuseRoughnessTexture"),t.diffuseRoughnessTexture,function(a){a.name="".concat(n.name," (Diffuse Roughness)"),n.baseDiffuseRoughnessTexture=a})),Promise.all(o).then(function(){})},r}();G(It),H(It,!0,function(r){return new Rn(r)});var St="KHR_mesh_quantization",Fn=function(){function r(e){this.name=St,this.enabled=e.isExtensionUsed(St)}return r.prototype.dispose=function(){},r}();G(St),H(St,!0,function(r){return new Fn(r)});var Bt="KHR_texture_basisu",Nn=function(){function r(e){this.name=Bt,this._loader=e,this.enabled=e.isExtensionUsed(Bt)}return r.prototype.dispose=function(){this._loader=null},r.prototype._loadTextureAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i,u;return(0,T.YH)(this,function(d){switch(d.label){case 0:return i=t.sampler==null?V.DefaultSampler:M.Get("".concat(e,"/sampler"),this._loader.gltf.samplers,t.sampler),u=M.Get("".concat(a,"/source"),this._loader.gltf.images,s.source),[4,this._loader._createTextureAsync(e,i,u,function(h){n(h)},t._textureInfo.nonColorData?{useRGBAIfASTCBC7NotAvailableWhenUASTC:!0}:void 0,!t._textureInfo.nonColorData)];case 1:return[2,d.sent()]}})})})},r}();G(Bt),H(Bt,!0,function(r){return new Nn(r)});var kt="KHR_texture_transform",Pn=function(){function r(e){this.name=kt,this._loader=e,this.enabled=this._loader.isExtensionUsed(kt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadTextureInfoAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){return(0,T.YH)(this,function(i){switch(i.label){case 0:return[4,this._loader.loadTextureInfoAsync(e,t,function(u){if(!(u instanceof c.Texture))throw new Error("".concat(a,": Texture type not supported"));s.offset&&(u.uOffset=s.offset[0],u.vOffset=s.offset[1]),u.uRotationCenter=0,u.vRotationCenter=0,s.rotation&&(u.wAng=-s.rotation),s.scale&&(u.uScale=s.scale[0],u.vScale=s.scale[1]),s.texCoord!=null&&(u.coordinatesIndex=s.texCoord),n(u)})];case 1:return[2,i.sent()]}})})})},r}();G(kt),H(kt,!0,function(r){return new Pn(r)});var Gt="KHR_xmp_json_ld",In=function(){function r(e){this.name=Gt,this.order=100,this._loader=e,this.enabled=this._loader.isExtensionUsed(Gt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.onLoading=function(){var e,t,n;if(this._loader.rootBabylonMesh!==null){var o=(e=this._loader.gltf.extensions)===null||e===void 0?void 0:e.KHR_xmp_json_ld,a=(n=(t=this._loader.gltf.asset)===null||t===void 0?void 0:t.extensions)===null||n===void 0?void 0:n.KHR_xmp_json_ld;if(o&&a){var s=+a.packet;o.packets&&s<o.packets.length&&(this._loader.rootBabylonMesh.metadata=this._loader.rootBabylonMesh.metadata||{},this._loader.rootBabylonMesh.metadata.xmp=o.packets[s])}}},r}();function Be(r,e,t,n){return c.Color3.FromArray(e,t).scale(n)}function q(r,e,t,n){return e[t]*n}function Sn(r,e,t,n){return-e[t]*n}function Vt(r,e,t,n){return e[t+1]*n}function Vr(r,e,t,n){return e[t]*n*2}function ce(r){return{scale:[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(r,".uScale"),q,function(){return 2}),new Z(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(r,".vScale"),Vt,function(){return 2})],offset:[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(r,".uOffset"),q,function(){return 2}),new Z(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(r,".vOffset"),Vt,function(){return 2})],rotation:[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"".concat(r,".wAng"),Sn,function(){return 1})]}}G(Gt),H(Gt,!0,function(r){return new In(r)});var Fe=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return(0,T.C6)(e,r),e.prototype.buildAnimations=function(t,n,o,a){return[{babylonAnimatable:t._babylonCamera,babylonAnimation:this._buildAnimation(n,o,a)}]},e}(Re.AnimationPropertyInfo),Z=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return(0,T.C6)(e,r),e.prototype.buildAnimations=function(t,n,o,a){var s=[];for(var i in t._data)s.push({babylonAnimatable:t._data[i].babylonMaterial,babylonAnimation:this._buildAnimation(n,o,a)});return s},e}(Re.AnimationPropertyInfo),Ve=function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return(0,T.C6)(e,r),e.prototype.buildAnimations=function(t,n,o,a){return[{babylonAnimatable:t._babylonLight,babylonAnimation:this._buildAnimation(n,o,a)}]},e}(Re.AnimationPropertyInfo);(0,x.ZU)("/cameras/{}/orthographic/xmag",[new Fe(c.Animation.ANIMATIONTYPE_FLOAT,"orthoLeft",Sn,function(){return 1}),new Fe(c.Animation.ANIMATIONTYPE_FLOAT,"orthoRight",Vt,function(){return 1})]),(0,x.ZU)("/cameras/{}/orthographic/ymag",[new Fe(c.Animation.ANIMATIONTYPE_FLOAT,"orthoBottom",Sn,function(){return 1}),new Fe(c.Animation.ANIMATIONTYPE_FLOAT,"orthoTop",Vt,function(){return 1})]),(0,x.ZU)("/cameras/{}/orthographic/zfar",[new Fe(c.Animation.ANIMATIONTYPE_FLOAT,"maxZ",q,function(){return 1})]),(0,x.ZU)("/cameras/{}/orthographic/znear",[new Fe(c.Animation.ANIMATIONTYPE_FLOAT,"minZ",q,function(){return 1})]),(0,x.ZU)("/cameras/{}/perspective/yfov",[new Fe(c.Animation.ANIMATIONTYPE_FLOAT,"fov",q,function(){return 1})]),(0,x.ZU)("/cameras/{}/perspective/zfar",[new Fe(c.Animation.ANIMATIONTYPE_FLOAT,"maxZ",q,function(){return 1})]),(0,x.ZU)("/cameras/{}/perspective/znear",[new Fe(c.Animation.ANIMATIONTYPE_FLOAT,"minZ",q,function(){return 1})]),(0,x.ZU)("/materials/{}/pbrMetallicRoughness/baseColorFactor",[new Z(c.Animation.ANIMATIONTYPE_COLOR3,"albedoColor",Be,function(){return 4}),new Z(c.Animation.ANIMATIONTYPE_FLOAT,"alpha",function(r,e,t,n){return e[t+3]*n},function(){return 4})]),(0,x.ZU)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"metallic",q,function(){return 1})]),(0,x.ZU)("/materials/{}/pbrMetallicRoughness/metallicFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"roughness",q,function(){return 1})]);var Bn=ce("albedoTexture");(0,x.ZU)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/scale",Bn.scale),(0,x.ZU)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/offset",Bn.offset),(0,x.ZU)("/materials/{}/pbrMetallicRoughness/baseColorTexture/extensions/KHR_texture_transform/rotation",Bn.rotation);var kn=ce("metallicTexture");(0,x.ZU)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/scale",kn.scale),(0,x.ZU)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/offset",kn.offset),(0,x.ZU)("//materials/{}/pbrMetallicRoughness/metallicRoughnessTexture/rotation",kn.rotation),(0,x.ZU)("/materials/{}/emissiveFactor",[new Z(c.Animation.ANIMATIONTYPE_COLOR3,"emissiveColor",Be,function(){return 3})]);var Gn=ce("bumpTexture");(0,x.ZU)("/materials/{}/normalTexture/scale",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"bumpTexture.level",q,function(){return 1})]),(0,x.ZU)("/materials/{}/normalTexture/extensions/KHR_texture_transform/scale",Gn.scale),(0,x.ZU)("/materials/{}/normalTexture/extensions/KHR_texture_transform/offset",Gn.offset),(0,x.ZU)("/materials/{}/normalTexture/extensions/KHR_texture_transform/rotation",Gn.rotation),(0,x.ZU)("/materials/{}/occlusionTexture/strength",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"ambientTextureStrength",q,function(){return 1})]);var Vn=ce("ambientTexture");(0,x.ZU)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/scale",Vn.scale),(0,x.ZU)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/offset",Vn.offset),(0,x.ZU)("/materials/{}/occlusionTexture/extensions/KHR_texture_transform/rotation",Vn.rotation);var Dn=ce("emissiveTexture");(0,x.ZU)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/scale",Dn.scale),(0,x.ZU)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/offset",Dn.offset),(0,x.ZU)("/materials/{}/emissiveTexture/extensions/KHR_texture_transform/rotation",Dn.rotation),(0,x.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyStrength",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"anisotropy.intensity",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyRotation",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"anisotropy.angle",q,function(){return 1})]);var Hn=ce("anisotropy.texture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/scale",Hn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/offset",Hn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_anisotropy/anisotropyTexture/extensions/KHR_texture_transform/rotation",Hn.rotation),(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"clearCoat.intensity",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"clearCoat.roughness",q,function(){return 1})]);var Un=ce("clearCoat.texture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/scale",Un.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/offset",Un.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatTexture/extensions/KHR_texture_transform/rotation",Un.rotation);var Kn=ce("clearCoat.bumpTexture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/scale",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"clearCoat.bumpTexture.level",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/scale",Kn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/offset",Kn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatNormalTexture/extensions/KHR_texture_transform/rotation",Kn.rotation);var jn=ce("clearCoat.textureRoughness");(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/scale",jn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/offset",jn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_clearcoat/clearcoatRoughnessTexture/extensions/KHR_texture_transform/rotation",jn.rotation),(0,x.ZU)("/materials/{}/extensions/KHR_materials_dispersion/dispersionFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.dispersion",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_emissive_strength/emissiveStrength",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"emissiveIntensity",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_ior/ior",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"indexOfRefraction",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"iridescence.intensity",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceIor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"iridescence.indexOfRefraction",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMinimum",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"iridescence.minimumThickness",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessMaximum",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"iridescence.maximumThickness",q,function(){return 1})]);var Yn=ce("iridescence.texture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/scale",Yn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/offset",Yn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceTexture/extensions/KHR_texture_transform/rotation",Yn.rotation);var Zn=ce("iridescence.thicknessTexture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/scale",Zn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/offset",Zn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_iridescence/iridescenceThicknessTexture/extensions/KHR_texture_transform/rotation",Zn.rotation),(0,x.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorFactor",[new Z(c.Animation.ANIMATIONTYPE_COLOR3,"sheen.color",Be,function(){return 3})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"sheen.roughness",q,function(){return 1})]);var Wn=ce("sheen.texture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/scale",Wn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/offset",Wn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenColorTexture/extensions/KHR_texture_transform/rotation",Wn.rotation);var qn=ce("sheen.textureRoughness");(0,x.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/scale",qn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/offset",qn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_sheen/sheenRoughnessTexture/extensions/KHR_texture_transform/rotation",qn.rotation),(0,x.ZU)("/materials/{}/extensions/KHR_materials_specular/specularFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"metallicF0Factor",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorFactor",[new Z(c.Animation.ANIMATIONTYPE_COLOR3,"metallicReflectanceColor",Be,function(){return 3})]);var zn=ce("metallicReflectanceTexture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/scale",zn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/offset",zn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_specular/specularTexture/extensions/KHR_texture_transform/rotation",zn.rotation);var Xn=ce("reflectanceTexture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/scale",Xn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/offset",Xn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_specular/specularColorTexture/extensions/KHR_texture_transform/rotation",Xn.rotation),(0,x.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.refractionIntensity",q,function(){return 1})]);var Qn=ce("subSurface.refractionIntensityTexture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/scale",Qn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/offset",Qn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_transmission/transmissionTexture/extensions/KHR_texture_transform/rotation",Qn.rotation),(0,x.ZU)("/materials/{}/extensions/KHR_materials_volume/attenuationColor",[new Z(c.Animation.ANIMATIONTYPE_COLOR3,"subSurface.tintColor",Be,function(){return 3})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_volume/attenuationDistance",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.tintColorAtDistance",q,function(){return 1})]),(0,x.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.maximumThickness",q,function(){return 1})]);var Jn=ce("subSurface.thicknessTexture");(0,x.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/scale",Jn.scale),(0,x.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/offset",Jn.offset),(0,x.ZU)("/materials/{}/extensions/KHR_materials_volume/thicknessTexture/extensions/KHR_texture_transform/rotation",Jn.rotation),(0,x.ZU)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionFactor",[new Z(c.Animation.ANIMATIONTYPE_FLOAT,"subSurface.translucencyIntensity",q,function(){return 1})]);var $n=ce("subSurface.translucencyIntensityTexture");(0,x.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/scale",$n.scale),(0,x.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/offset",$n.offset),(0,x.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionTexture/extensions/KHR_texture_transform/rotation",$n.rotation),(0,x.ZU)("/materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorFactor",[new Z(c.Animation.ANIMATIONTYPE_COLOR3,"subSurface.translucencyColor",Be,function(){return 3})]);var er=ce("subSurface.translucencyColorTexture");(0,x.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/scale",er.scale),(0,x.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/offset",er.offset),(0,x.ZU)("materials/{}/extensions/KHR_materials_diffuse_transmission/diffuseTransmissionColorTexture/extensions/KHR_texture_transform/rotation",er.rotation),(0,x.ZU)("/extensions/KHR_lights_punctual/lights/{}/color",[new Ve(c.Animation.ANIMATIONTYPE_COLOR3,"diffuse",Be,function(){return 3})]),(0,x.ZU)("/extensions/KHR_lights_punctual/lights/{}/intensity",[new Ve(c.Animation.ANIMATIONTYPE_FLOAT,"intensity",q,function(){return 1})]),(0,x.ZU)("/extensions/KHR_lights_punctual/lights/{}/range",[new Ve(c.Animation.ANIMATIONTYPE_FLOAT,"range",q,function(){return 1})]),(0,x.ZU)("/extensions/KHR_lights_punctual/lights/{}/spot/innerConeAngle",[new Ve(c.Animation.ANIMATIONTYPE_FLOAT,"innerAngle",Vr,function(){return 1})]),(0,x.ZU)("/extensions/KHR_lights_punctual/lights/{}/spot/outerConeAngle",[new Ve(c.Animation.ANIMATIONTYPE_FLOAT,"angle",Vr,function(){return 1})]),(0,x.ZU)("/nodes/{}/extensions/EXT_lights_ies/color",[new Ve(c.Animation.ANIMATIONTYPE_COLOR3,"diffuse",Be,function(){return 3})]),(0,x.ZU)("/nodes/{}/extensions/EXT_lights_ies/multiplier",[new Ve(c.Animation.ANIMATIONTYPE_FLOAT,"intensity",q,function(){return 1})]);var Dt="KHR_animation_pointer",tr=function(){function r(e){this.name=Dt,this._loader=e,this._pathToObjectConverter=(0,x.Wt)(this._loader.gltf)}return Object.defineProperty(r.prototype,"enabled",{get:function(){return this._loader.isExtensionUsed(Dt)},enumerable:!1,configurable:!0}),r.prototype.dispose=function(){this._loader=null,delete this._pathToObjectConverter},r.prototype._loadAnimationChannelAsync=function(e,t,n,o,a){var s,i=(s=o.target.extensions)===null||s===void 0?void 0:s.KHR_animation_pointer;if(!i||!this._pathToObjectConverter)return null;o.target.path!=="pointer"&&c.Logger.Warn("".concat(e,"/target/path: Value (").concat(o.target.path,") must be (").concat("pointer",") when using the ").concat(this.name," extension")),o.target.node!=null&&c.Logger.Warn("".concat(e,"/target/node: Value (").concat(o.target.node,") must not be present when using the ").concat(this.name," extension"));var u="".concat(e,"/extensions/").concat(this.name),d=i.pointer;if(!d)throw new Error("".concat(u,": Pointer is missing"));try{var h=this._pathToObjectConverter.convert(d);if(!h.info.interpolation)throw new Error("".concat(u,"/pointer: Interpolation is missing"));return this._loader._loadAnimationChannelFromTargetInfoAsync(e,t,n,o,{object:h.object,info:h.info.interpolation},a)}catch{return c.Logger.Warn("".concat(u,"/pointer: Invalid pointer (").concat(d,") skipped")),null}},r}();G(Dt),H(Dt,!0,function(r){return new tr(r)});var Ht="MSFT_audio_emitter",nr=function(){function r(e){this.name=Ht,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ht)}return r.prototype.dispose=function(){this._loader=null,this._clips=null,this._emitters=null},r.prototype.onLoading=function(){var e=this._loader.gltf.extensions;if(e&&e[this.name]){var t=e[this.name];this._clips=t.clips,this._emitters=t.emitters,M.Assign(this._clips),M.Assign(this._emitters)}},r.prototype.loadSceneAsync=function(e,t){var n=this;return V.LoadExtensionAsync(e,t,this.name,function(o,a){return(0,T.sH)(n,void 0,void 0,function(){var s,i,u,d,h;return(0,T.YH)(this,function(m){switch(m.label){case 0:for((s=new Array).push(this._loader.loadSceneAsync(e,t)),i=0,u=a.emitters;i<u.length;i++){if(d=u[i],(h=M.Get("".concat(o,"/emitters"),this._emitters,d)).refDistance!=null||h.maxDistance!=null||h.rolloffFactor!=null||h.distanceModel!=null||h.innerAngle!=null||h.outerAngle!=null)throw new Error("".concat(o,": Direction or Distance properties are not allowed on emitters attached to a scene"));s.push(this._loadEmitterAsync("".concat(o,"/emitters/").concat(h.index),h))}return[4,Promise.all(s)];case 1:return m.sent(),[2]}})})})},r.prototype.loadNodeAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i,u,d=this;return(0,T.YH)(this,function(h){switch(h.label){case 0:return i=new Array,[4,this._loader.loadNodeAsync(a,t,function(m){for(var _=function(f){var p=M.Get("".concat(a,"/emitters"),d._emitters,f);i.push(d._loadEmitterAsync("".concat(a,"/emitters/").concat(p.index),p).then(function(){for(var v=0,g=p._babylonSounds;v<g.length;v++){var b=g[v];b.attachToMesh(m),p.innerAngle==null&&p.outerAngle==null||(b.setLocalDirectionToMesh(c.Vector3.Forward()),b.setDirectionalCone(2*c.Tools.ToDegrees(p.innerAngle==null?Math.PI:p.innerAngle),2*c.Tools.ToDegrees(p.outerAngle==null?Math.PI:p.outerAngle),0))}}))},y=0,l=s.emitters;y<l.length;y++)_(l[y]);n(m)})];case 1:return u=h.sent(),[4,Promise.all(i)];case 2:return h.sent(),[2,u]}})})})},r.prototype.loadAnimationAsync=function(e,t){var n=this;return V.LoadExtensionAsync(e,t,this.name,function(o,a){return(0,T.sH)(n,void 0,void 0,function(){var s,i,u,d,h;return(0,T.YH)(this,function(m){switch(m.label){case 0:return[4,this._loader.loadAnimationAsync(e,t)];case 1:for(s=m.sent(),i=new Array,M.Assign(a.events),u=0,d=a.events;u<d.length;u++)h=d[u],i.push(this._loadAnimationEventAsync("".concat(o,"/events/").concat(h.index),e,t,h,s));return[4,Promise.all(i)];case 2:return m.sent(),[2,s]}})})})},r.prototype._loadClipAsync=function(e,t){if(t._objectURL)return t._objectURL;var n;if(t.uri)n=this._loader.loadUriAsync(e,t,t.uri);else{var o=M.Get("".concat(e,"/bufferView"),this._loader.gltf.bufferViews,t.bufferView);n=this._loader.loadBufferViewAsync("/bufferViews/".concat(o.index),o)}return t._objectURL=n.then(function(a){return URL.createObjectURL(new Blob([a],{type:t.mimeType}))}),t._objectURL},r.prototype._loadEmitterAsync=function(e,t){var n=this;if(t._babylonSounds=t._babylonSounds||[],!t._babylonData){for(var o=new Array,a=t.name||"emitter".concat(t.index),s={loop:!1,autoplay:!1,volume:t.volume==null?1:t.volume},i=function(m){var _="/extensions/".concat(u.name,"/clips"),y=M.Get(_,u._clips,t.clips[m].clip);o.push(u._loadClipAsync("".concat(_,"/").concat(t.clips[m].clip),y).then(function(l){var f=t._babylonSounds[m]=new c.Sound(a,l,n._loader.babylonScene,null,s);f.refDistance=t.refDistance||1,f.maxDistance=t.maxDistance||256,f.rolloffFactor=t.rolloffFactor||1,f.distanceModel=t.distanceModel||"exponential"}))},u=this,d=0;d<t.clips.length;d++)i(d);var h=Promise.all(o).then(function(){var m=t.clips.map(function(y){return y.weight||1}),_=new c.WeightedSound(t.loop||!1,t._babylonSounds,m);t.innerAngle&&(_.directionalConeInnerAngle=2*c.Tools.ToDegrees(t.innerAngle)),t.outerAngle&&(_.directionalConeOuterAngle=2*c.Tools.ToDegrees(t.outerAngle)),t.volume&&(_.volume=t.volume),t._babylonData.sound=_});t._babylonData={loaded:h}}return t._babylonData.loaded},r.prototype._getEventAction=function(e,t,n,o,a){switch(n){case"play":return function(s){var i=(a||0)+(s-o);t.play(i)};case"stop":return function(){t.stop()};case"pause":return function(){t.pause()};default:throw new Error("".concat(e,": Unsupported action ").concat(n))}},r.prototype._loadAnimationEventAsync=function(e,t,n,o,a){var s=this;if(a.targetedAnimations.length==0)return Promise.resolve();var i=a.targetedAnimations[0],u=o.emitter,d=M.Get("/extensions/".concat(this.name,"/emitters"),this._emitters,u);return this._loadEmitterAsync(e,d).then(function(){var h=d._babylonData.sound;if(h){var m=new c.AnimationEvent(o.time,s._getEventAction(e,h,o.action,o.time,o.startOffset));i.animation.addEvent(m),a.onAnimationGroupEndObservable.add(function(){h.stop()}),a.onAnimationGroupPauseObservable.add(function(){h.pause()})}})},r}();G(Ht),H(Ht,!0,function(r){return new nr(r)});var Qe="MSFT_lod",rr=function(){function r(e){var t,n;this.name=Qe,this.order=100,this.maxLODsToLoad=10,this.onNodeLODsLoadedObservable=new c.Observable,this.onMaterialLODsLoadedObservable=new c.Observable,this._bufferLODs=new Array,this._nodeIndexLOD=null,this._nodeSignalLODs=new Array,this._nodePromiseLODs=new Array,this._nodeBufferLODs=new Array,this._materialIndexLOD=null,this._materialSignalLODs=new Array,this._materialPromiseLODs=new Array,this._materialBufferLODs=new Array,this._loader=e,this.maxLODsToLoad=(n=(t=this._loader.parent.extensionOptions[Qe])===null||t===void 0?void 0:t.maxLODsToLoad)!==null&&n!==void 0?n:this.maxLODsToLoad,this.enabled=this._loader.isExtensionUsed(Qe)}return r.prototype.dispose=function(){this._loader=null,this._nodeIndexLOD=null,this._nodeSignalLODs.length=0,this._nodePromiseLODs.length=0,this._nodeBufferLODs.length=0,this._materialIndexLOD=null,this._materialSignalLODs.length=0,this._materialPromiseLODs.length=0,this._materialBufferLODs.length=0,this.onMaterialLODsLoadedObservable.clear(),this.onNodeLODsLoadedObservable.clear()},r.prototype.onReady=function(){for(var e=this,t=function(i){var u=Promise.all(n._nodePromiseLODs[i]).then(function(){i!==0&&(e._loader.endPerformanceCounter("Node LOD ".concat(i)),e._loader.log("Loaded node LOD ".concat(i))),e.onNodeLODsLoadedObservable.notifyObservers(i),i!==e._nodePromiseLODs.length-1&&(e._loader.startPerformanceCounter("Node LOD ".concat(i+1)),e._loadBufferLOD(e._nodeBufferLODs,i+1),e._nodeSignalLODs[i]&&e._nodeSignalLODs[i].resolve())});n._loader._completePromises.push(u)},n=this,o=0;o<this._nodePromiseLODs.length;o++)t(o);var a=function(i){var u=Promise.all(s._materialPromiseLODs[i]).then(function(){i!==0&&(e._loader.endPerformanceCounter("Material LOD ".concat(i)),e._loader.log("Loaded material LOD ".concat(i))),e.onMaterialLODsLoadedObservable.notifyObservers(i),i!==e._materialPromiseLODs.length-1&&(e._loader.startPerformanceCounter("Material LOD ".concat(i+1)),e._loadBufferLOD(e._materialBufferLODs,i+1),e._materialSignalLODs[i]&&e._materialSignalLODs[i].resolve())});s._loader._completePromises.push(u)},s=this;for(o=0;o<this._materialPromiseLODs.length;o++)a(o)},r.prototype.loadSceneAsync=function(e,t){var n=this._loader.loadSceneAsync(e,t);return this._loadBufferLOD(this._bufferLODs,0),n},r.prototype.loadNodeAsync=function(e,t,n){var o=this;return V.LoadExtensionAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i,u,d,h,m,_=this;return(0,T.YH)(this,function(y){switch(y.label){case 0:for(u=this._getLODs(a,t,this._loader.gltf.nodes,s.ids),this._loader.logOpen("".concat(a)),d=function(l){var f=u[l];l!==0&&(h._nodeIndexLOD=l,h._nodeSignalLODs[l]=h._nodeSignalLODs[l]||new c.Deferred);var p=h._loader.loadNodeAsync("/nodes/".concat(f.index),f,function(v){n(v),v.setEnabled(!1)}).then(function(v){if(l!==0){var g=u[l-1];g._babylonTransformNode&&(_._disposeTransformNode(g._babylonTransformNode),delete g._babylonTransformNode)}return v.setEnabled(!0),v});h._nodePromiseLODs[l]=h._nodePromiseLODs[l]||[],l===0?i=p:(h._nodeIndexLOD=null,h._nodePromiseLODs[l].push(p))},h=this,m=0;m<u.length;m++)d(m);return this._loader.logClose(),[4,i];case 1:return[2,y.sent()]}})})})},r.prototype._loadMaterialAsync=function(e,t,n,o,a){var s=this;return this._nodeIndexLOD?null:V.LoadExtensionAsync(e,t,this.name,function(i,u){return(0,T.sH)(s,void 0,void 0,function(){var d,h,m,_,y,l=this;return(0,T.YH)(this,function(f){switch(f.label){case 0:for(h=this._getLODs(i,t,this._loader.gltf.materials,u.ids),this._loader.logOpen("".concat(i)),m=function(p){var v=h[p];p!==0&&(_._materialIndexLOD=p);var g=_._loader._loadMaterialAsync("/materials/".concat(v.index),v,n,o,function(b){p===0&&a(b)}).then(function(b){if(p!==0){a(b);var w=h[p-1]._data;w[o]&&(l._disposeMaterials([w[o].babylonMaterial]),delete w[o])}return b});_._materialPromiseLODs[p]=_._materialPromiseLODs[p]||[],p===0?d=g:(_._materialIndexLOD=null,_._materialPromiseLODs[p].push(g))},_=this,y=0;y<h.length;y++)m(y);return this._loader.logClose(),[4,d];case 1:return[2,f.sent()]}})})})},r.prototype._loadUriAsync=function(e,t,n){var o=this;if(this._nodeIndexLOD!==null){this._loader.log("deferred");var a=this._nodeIndexLOD-1;return this._nodeSignalLODs[a]=this._nodeSignalLODs[a]||new c.Deferred,this._nodeSignalLODs[this._nodeIndexLOD-1].promise.then(function(){return(0,T.sH)(o,void 0,void 0,function(){return(0,T.YH)(this,function(s){switch(s.label){case 0:return[4,this._loader.loadUriAsync(e,t,n)];case 1:return[2,s.sent()]}})})})}return this._materialIndexLOD!==null?(this._loader.log("deferred"),a=this._materialIndexLOD-1,this._materialSignalLODs[a]=this._materialSignalLODs[a]||new c.Deferred,this._materialSignalLODs[a].promise.then(function(){return(0,T.sH)(o,void 0,void 0,function(){return(0,T.YH)(this,function(s){switch(s.label){case 0:return[4,this._loader.loadUriAsync(e,t,n)];case 1:return[2,s.sent()]}})})})):null},r.prototype.loadBufferAsync=function(e,t,n,o){var a=this;if(this._loader.parent.useRangeRequests&&!t.uri){if(!this._loader.bin)throw new Error("".concat(e,": Uri is missing or the binary glTF is missing its binary chunk"));var s=function(i,u){return(0,T.sH)(a,void 0,void 0,function(){var d,h,m;return(0,T.YH)(this,function(_){switch(_.label){case 0:return h=(d=n)+o-1,(m=i[u])?(m.start=Math.min(m.start,d),m.end=Math.max(m.end,h)):(m={start:d,end:h,loaded:new c.Deferred},i[u]=m),[4,m.loaded.promise.then(function(y){return new Uint8Array(y.buffer,y.byteOffset+n-m.start,o)})];case 1:return[2,_.sent()]}})})};return this._loader.log("deferred"),this._nodeIndexLOD!==null?s(this._nodeBufferLODs,this._nodeIndexLOD):this._materialIndexLOD!==null?s(this._materialBufferLODs,this._materialIndexLOD):s(this._bufferLODs,0)}return null},r.prototype._loadBufferLOD=function(e,t){var n=e[t];n&&(this._loader.log("Loading buffer range [".concat(n.start,"-").concat(n.end,"]")),this._loader.bin.readAsync(n.start,n.end-n.start+1).then(function(o){n.loaded.resolve(o)},function(o){n.loaded.reject(o)}))},r.prototype._getLODs=function(e,t,n,o){if(this.maxLODsToLoad<=0)throw new Error("maxLODsToLoad must be greater than zero");for(var a=[],s=o.length-1;s>=0;s--)if(a.push(M.Get("".concat(e,"/ids/").concat(o[s]),n,o[s])),a.length===this.maxLODsToLoad)return a;return a.push(t),a},r.prototype._disposeTransformNode=function(e){var t=this,n=[],o=e.material;o&&n.push(o);for(var a=0,s=e.getChildMeshes();a<s.length;a++){var i=s[a];i.material&&n.push(i.material)}e.dispose();var u=n.filter(function(d){return t._loader.babylonScene.meshes.every(function(h){return h.material!=d})});this._disposeMaterials(u)},r.prototype._disposeMaterials=function(e){for(var t={},n=0,o=e;n<o.length;n++){for(var a=0,s=(m=o[n]).getActiveTextures();a<s.length;a++){var i=s[a];t[i.uniqueId]=i}m.dispose()}for(var u in t)for(var d=0,h=this._loader.babylonScene.materials;d<h.length;d++){var m;(m=h[d]).hasTexture(t[u])&&delete t[u]}for(var u in t)t[u].dispose()},r}();G(Qe),H(Qe,!0,function(r){return new rr(r)});var Ut="MSFT_minecraftMesh",or=function(){function r(e){this.name=Ut,this._loader=e,this.enabled=this._loader.isExtensionUsed(Ut)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtraAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i;return(0,T.YH)(this,function(u){switch(u.label){case 0:if(!s)return[3,2];if(!(n instanceof c.PBRMaterial))throw new Error("".concat(a,": Material type not supported"));return i=this._loader.loadMaterialPropertiesAsync(e,t,n),n.needAlphaBlending()&&(n.forceDepthWrite=!0,n.separateCullingPass=!0),n.backFaceCulling=n.forceDepthWrite,n.twoSidedLighting=!0,[4,i];case 1:return[2,u.sent()];case 2:return[2]}})})})},r}();G(Ut),H(Ut,!0,function(r){return new or(r)});var Kt="MSFT_sRGBFactors",ar=function(){function r(e){this.name=Kt,this._loader=e,this.enabled=this._loader.isExtensionUsed(Kt)}return r.prototype.dispose=function(){this._loader=null},r.prototype.loadMaterialPropertiesAsync=function(e,t,n){var o=this;return V.LoadExtraAsync(e,t,this.name,function(a,s){return(0,T.sH)(o,void 0,void 0,function(){var i,u;return(0,T.YH)(this,function(d){switch(d.label){case 0:if(!s)return[3,2];if(!(n instanceof c.PBRMaterial))throw new Error("".concat(a,": Material type not supported"));return i=this._loader.loadMaterialPropertiesAsync(e,t,n),u=n.getScene().getEngine().useExactSrgbConversions,n.albedoTexture||n.albedoColor.toLinearSpaceToRef(n.albedoColor,u),n.reflectivityTexture||n.reflectivityColor.toLinearSpaceToRef(n.reflectivityColor,u),[4,i];case 1:return[2,d.sent()];case 2:return[2]}})})})},r}();function jt(r){var e=r.split(":");return Yt({op:e[0],extension:e[1]})}function Yt(r,e){var t;e===void 0&&(e=!0);var n=r.extension?(t=Zt[r.extension])===null||t===void 0?void 0:t[r.op]:Ke[r.op];if(!n&&(c.Logger.Warn("No mapping found for operation ".concat(r.op," and extension ").concat(r.extension||"KHR_interactivity")),e)){var o={},a={flows:{}};if(r.inputValueSockets)for(var s in o.values={},r.inputValueSockets)o.values[s]={name:s};return r.outputValueSockets&&(a.values={},Object.keys(r.outputValueSockets).forEach(function(i){a.values[i]={name:i}})),{blocks:[],inputs:o,outputs:a}}return n}function Je(r,e,t){Zt[e]||(Zt[e]={}),Zt[e][r]=t}G(Kt),H(Kt,!0,function(r){return new ar(r)});var Zt={BABYLON:{"flow/log":{blocks:["FlowGraphConsoleLogBlock"],inputs:{values:{message:{name:"message"}}}}}},Ke={"event/onStart":{blocks:["FlowGraphSceneReadyEventBlock"],outputs:{flows:{out:{name:"done"}}}},"event/onTick":{blocks:["FlowGraphSceneTickEventBlock"],inputs:{},outputs:{values:{timeSinceLastTick:{name:"deltaTime",gltfType:"number"}},flows:{out:{name:"done"}}}},"event/send":{blocks:["FlowGraphSendCustomEventBlock"],extraProcessor:function(r,e,t,n,o){if(e.op!=="event/send"||!r.configuration||Object.keys(r.configuration).length!==1)throw new Error("Receive event should have a single configuration object, the event itself");var a=r.configuration.event.value[0];if(typeof a!="number")throw new Error("Event id should be a number");var s=n.arrays.events[a],i=o[0];return i.config||(i.config={}),i.config.eventId=s.eventId,i.config.eventData=s.eventData,o}},"event/receive":{blocks:["FlowGraphReceiveCustomEventBlock"],outputs:{flows:{out:{name:"done"}}},validation:function(r,e){var t;if(!r.configuration)return c.Logger.Error("Receive event should have a configuration object"),{valid:!1,error:"Receive event should have a configuration object"};var n=r.configuration.event;if(!n)return c.Logger.Error("Receive event should have a single configuration object, the event itself"),{valid:!1,error:"Receive event should have a single configuration object, the event itself"};var o=n.value[0];return typeof o!="number"?(c.Logger.Error("Event id should be a number"),{valid:!1,error:"Event id should be a number"}):!((t=e.events)===null||t===void 0)&&t[o]?{valid:!0}:(c.Logger.Error("Event with id ".concat(o," not found")),{valid:!1,error:"Event with id ".concat(o," not found")})},extraProcessor:function(r,e,t,n,o){if(e.op!=="event/receive"||!r.configuration||Object.keys(r.configuration).length!==1)throw new Error("Receive event should have a single configuration object, the event itself");var a=r.configuration.event.value[0];if(typeof a!="number")throw new Error("Event id should be a number");var s=n.arrays.events[a],i=o[0];return i.config||(i.config={}),i.config.eventId=s.eventId,i.config.eventData=s.eventData,o}},"math/e":C("FlowGraphEBlock"),"math/pi":C("FlowGraphPIBlock"),"math/inf":C("FlowGraphInfBlock"),"math/nan":C("FlowGraphNaNBlock"),"math/abs":C("FlowGraphAbsBlock"),"math/sign":C("FlowGraphSignBlock"),"math/trunc":C("FlowGraphTruncBlock"),"math/floor":C("FlowGraphFloorBlock"),"math/ceil":C("FlowGraphCeilBlock"),"math/round":{blocks:["FlowGraphRoundBlock"],configuration:{},inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o){var a;return(a=o[0]).config||(a.config={}),o[0].config.roundHalfAwayFromZero=!0,o}},"math/fract":C("FlowGraphFractBlock"),"math/neg":C("FlowGraphNegationBlock"),"math/add":C("FlowGraphAddBlock",["a","b"],!0),"math/sub":C("FlowGraphSubtractBlock",["a","b"],!0),"math/mul":{blocks:["FlowGraphMultiplyBlock"],extraProcessor:function(r,e,t,n,o){var a;(a=o[0]).config||(a.config={}),o[0].config.useMatrixPerComponent=!0,o[0].config.preventIntegerFloatArithmetic=!0;var s=-1;return Object.keys(r.values||{}).find(function(i){var u;return((u=r.values)===null||u===void 0?void 0:u[i].type)!==void 0&&(s=r.values[i].type,!0)}),s!==-1&&(o[0].config.type=n.arrays.types[s].flowGraphType),o},validation:function(r){return r.values?Dr(r):{valid:!0}}},"math/div":C("FlowGraphDivideBlock",["a","b"],!0),"math/rem":C("FlowGraphModuloBlock",["a","b"]),"math/min":C("FlowGraphMinBlock",["a","b"]),"math/max":C("FlowGraphMaxBlock",["a","b"]),"math/clamp":C("FlowGraphClampBlock",["a","b","c"]),"math/saturate":C("FlowGraphSaturateBlock"),"math/mix":C("FlowGraphMathInterpolationBlock",["a","b","c"]),"math/eq":C("FlowGraphEqualityBlock",["a","b"]),"math/lt":C("FlowGraphLessThanBlock",["a","b"]),"math/le":C("FlowGraphLessThanOrEqualBlock",["a","b"]),"math/gt":C("FlowGraphGreaterThanBlock",["a","b"]),"math/ge":C("FlowGraphGreaterThanOrEqualBlock",["a","b"]),"math/isnan":C("FlowGraphIsNaNBlock"),"math/isinf":C("FlowGraphIsInfBlock"),"math/select":{blocks:["FlowGraphConditionalBlock"],inputs:{values:{condition:{name:"condition"},a:{name:"onTrue"},b:{name:"onFalse"}}},outputs:{values:{value:{name:"output"}}}},"math/random":{blocks:["FlowGraphRandomBlock"],outputs:{values:{value:{name:"value"}}}},"math/sin":C("FlowGraphSinBlock"),"math/cos":C("FlowGraphCosBlock"),"math/tan":C("FlowGraphTanBlock"),"math/asin":C("FlowGraphASinBlock"),"math/acos":C("FlowGraphACosBlock"),"math/atan":C("FlowGraphATanBlock"),"math/atan2":C("FlowGraphATan2Block",["a","b"]),"math/sinh":C("FlowGraphSinhBlock"),"math/cosh":C("FlowGraphCoshBlock"),"math/tanh":C("FlowGraphTanhBlock"),"math/asinh":C("FlowGraphASinhBlock"),"math/acosh":C("FlowGraphACoshBlock"),"math/atanh":C("FlowGraphATanhBlock"),"math/exp":C("FlowGraphExponentialBlock"),"math/log":C("FlowGraphLogBlock"),"math/log2":C("FlowGraphLog2Block"),"math/log10":C("FlowGraphLog10Block"),"math/sqrt":C("FlowGraphSquareRootBlock"),"math/cbrt":C("FlowGraphCubeRootBlock"),"math/pow":C("FlowGraphPowerBlock",["a","b"]),"math/length":C("FlowGraphLengthBlock"),"math/normalize":C("FlowGraphNormalizeBlock"),"math/dot":C("FlowGraphDotBlock",["a","b"]),"math/cross":C("FlowGraphCrossBlock",["a","b"]),"math/rotate2D":C("FlowGraphRotate2DBlock",["a","b"]),"math/rotate3D":C("FlowGraphRotate3DBlock",["a","b"]),"math/transform":{blocks:["FlowGraphTransformVectorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}}},"math/combine2":{blocks:["FlowGraphCombineVector2Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine3":{blocks:["FlowGraphCombineVector3Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/combine4":{blocks:["FlowGraphCombineVector4Block"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/extract2":{blocks:["FlowGraphExtractVector2Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"}}}},"math/extract3":{blocks:["FlowGraphExtractVector3Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"}}}},"math/extract4":{blocks:["FlowGraphExtractVector4Block"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/transpose":C("FlowGraphTransposeBlock"),"math/determinant":C("FlowGraphDeterminantBlock"),"math/inverse":C("FlowGraphInvertMatrixBlock"),"math/matmul":C("FlowGraphMatrixMultiplicationBlock",["a","b"]),"math/matCompose":{blocks:["FlowGraphMatrixCompose"],inputs:{values:{translation:{name:"position",gltfType:"float3"},rotation:{name:"rotationQuaternion",gltfType:"float4"},scale:{name:"scaling",gltfType:"float3"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o,a){var s=o[0].dataInputs.find(function(i){return i.name==="rotationQuaternion"});if(!s)throw new Error("Rotation quaternion input not found");return a._connectionValues[s.uniqueId]&&(a._connectionValues[s.uniqueId].type="Quaternion"),o}},"math/matDecompose":{blocks:["FlowGraphMatrixDecompose"],inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{translation:{name:"position"},rotation:{name:"rotationQuaternion"},scale:{name:"scaling"}}}},"math/quatConjugate":C("FlowGraphConjugateBlock",["a"]),"math/quatMul":{blocks:["FlowGraphMultiplyBlock"],inputs:{values:{a:{name:"a",gltfType:"vector4"},b:{name:"b",gltfType:"vector4"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o){var a;return(a=o[0]).config||(a.config={}),o[0].config.type="Quaternion",o}},"math/quatAngleBetween":C("FlowGraphAngleBetweenBlock",["a","b"]),"math/quatFromAxisAngle":{blocks:["FlowGraphQuaternionFromAxisAngleBlock"],inputs:{values:{axis:{name:"a",gltfType:"float3"},angle:{name:"b",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}}},"math/quatToAxisAngle":C("FlowGraphAxisAngleFromQuaternionBlock",["a"]),"math/quatFromDirections":C("FlowGraphQuaternionFromDirectionsBlock",["a","b"]),"math/combine2x2":{blocks:["FlowGraphCombineMatrix2DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o){var a;return(a=o[0]).config||(a.config={}),o[0].config.inputIsColumnMajor=!0,o}},"math/extract2x2":{blocks:["FlowGraphExtractMatrix2DBlock"],inputs:{values:{a:{name:"input",gltfType:"float2x2"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"}}}},"math/combine3x3":{blocks:["FlowGraphCombineMatrix3DBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o){var a;return(a=o[0]).config||(a.config={}),o[0].config.inputIsColumnMajor=!0,o}},"math/extract3x3":{blocks:["FlowGraphExtractMatrix3DBlock"],inputs:{values:{a:{name:"input",gltfType:"float3x3"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"}}}},"math/combine4x4":{blocks:["FlowGraphCombineMatrixBlock"],inputs:{values:{a:{name:"input_0",gltfType:"number"},b:{name:"input_1",gltfType:"number"},c:{name:"input_2",gltfType:"number"},d:{name:"input_3",gltfType:"number"},e:{name:"input_4",gltfType:"number"},f:{name:"input_5",gltfType:"number"},g:{name:"input_6",gltfType:"number"},h:{name:"input_7",gltfType:"number"},i:{name:"input_8",gltfType:"number"},j:{name:"input_9",gltfType:"number"},k:{name:"input_10",gltfType:"number"},l:{name:"input_11",gltfType:"number"},m:{name:"input_12",gltfType:"number"},n:{name:"input_13",gltfType:"number"},o:{name:"input_14",gltfType:"number"},p:{name:"input_15",gltfType:"number"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o){var a;return(a=o[0]).config||(a.config={}),o[0].config.inputIsColumnMajor=!0,o}},"math/extract4x4":{blocks:["FlowGraphExtractMatrixBlock"],configuration:{},inputs:{values:{a:{name:"input",gltfType:"number"}}},outputs:{values:{0:{name:"output_0"},1:{name:"output_1"},2:{name:"output_2"},3:{name:"output_3"},4:{name:"output_4"},5:{name:"output_5"},6:{name:"output_6"},7:{name:"output_7"},8:{name:"output_8"},9:{name:"output_9"},10:{name:"output_10"},11:{name:"output_11"},12:{name:"output_12"},13:{name:"output_13"},14:{name:"output_14"},15:{name:"output_15"}}}},"math/not":{blocks:["FlowGraphBitwiseNotBlock"],inputs:{values:{a:{name:"a"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o,a){var s,i,u;(u=o[0]).config||(u.config={});var d=o[0].dataInputs[0];return o[0].config.valueType=(i=(s=a._connectionValues[d.uniqueId])===null||s===void 0?void 0:s.type)!==null&&i!==void 0?i:"FlowGraphInteger",o}},"math/and":{blocks:["FlowGraphBitwiseAndBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o,a){var s,i,u,d,h;(h=o[0]).config||(h.config={});var m=o[0].dataInputs[0],_=o[0].dataInputs[1];return o[0].config.valueType=(d=(i=(s=a._connectionValues[m.uniqueId])===null||s===void 0?void 0:s.type)!==null&&i!==void 0?i:(u=a._connectionValues[_.uniqueId])===null||u===void 0?void 0:u.type)!==null&&d!==void 0?d:"FlowGraphInteger",o}},"math/or":{blocks:["FlowGraphBitwiseOrBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o,a){var s,i,u,d,h;(h=o[0]).config||(h.config={});var m=o[0].dataInputs[0],_=o[0].dataInputs[1];return o[0].config.valueType=(d=(i=(s=a._connectionValues[m.uniqueId])===null||s===void 0?void 0:s.type)!==null&&i!==void 0?i:(u=a._connectionValues[_.uniqueId])===null||u===void 0?void 0:u.type)!==null&&d!==void 0?d:"FlowGraphInteger",o}},"math/xor":{blocks:["FlowGraphBitwiseXorBlock"],inputs:{values:{a:{name:"a"},b:{name:"b"}}},outputs:{values:{value:{name:"value"}}},extraProcessor:function(r,e,t,n,o,a){var s,i,u,d,h;(h=o[0]).config||(h.config={});var m=o[0].dataInputs[0],_=o[0].dataInputs[1];return o[0].config.valueType=(d=(i=(s=a._connectionValues[m.uniqueId])===null||s===void 0?void 0:s.type)!==null&&i!==void 0?i:(u=a._connectionValues[_.uniqueId])===null||u===void 0?void 0:u.type)!==null&&d!==void 0?d:"FlowGraphInteger",o}},"math/asr":C("FlowGraphBitwiseRightShiftBlock",["a","b"]),"math/lsl":C("FlowGraphBitwiseLeftShiftBlock",["a","b"]),"math/clz":C("FlowGraphLeadingZerosBlock"),"math/ctz":C("FlowGraphTrailingZerosBlock"),"math/popcnt":C("FlowGraphOneBitsCounterBlock"),"math/rad":C("FlowGraphDegToRadBlock"),"math/deg":C("FlowGraphRadToDegBlock"),"type/boolToInt":C("FlowGraphBooleanToInt"),"type/boolToFloat":C("FlowGraphBooleanToFloat"),"type/intToBool":C("FlowGraphIntToBoolean"),"type/intToFloat":C("FlowGraphIntToFloat"),"type/floatToInt":C("FlowGraphFloatToInt"),"type/floatToBool":C("FlowGraphFloatToBoolean"),"flow/sequence":{blocks:["FlowGraphSequenceBlock"],extraProcessor:function(r,e,t,n,o){var a=o[0];return a.config||(a.config={}),a.config.outputSignalCount=Object.keys(r.flows||[]).length,a.signalOutputs.forEach(function(s,i){s.name="out_"+i}),o}},"flow/branch":{blocks:["FlowGraphBranchBlock"],outputs:{flows:{true:{name:"onTrue"},false:{name:"onFalse"}}}},"flow/switch":{blocks:["FlowGraphSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"},default:{name:"default"}}},validation:function(r){if(r.configuration&&r.configuration.cases){var e=r.configuration.cases.value;if(!e.every(function(n){return typeof n=="number"&&/^-?\d+$/.test(n.toString())}))return c.Logger.Warn("Switch cases should be integers. Using empty array instead."),r.configuration.cases.value=[],{valid:!0};var t=new Set(e);r.configuration.cases.value=Array.from(t)}return{valid:!0}},extraProcessor:function(r,e,t,n,o){if(e.op!=="flow/switch"||!r.flows||Object.keys(r.flows).length===0)throw new Error("Switch should have a single configuration object, the cases array");return o[0].signalOutputs.forEach(function(a){a.name!=="default"&&(a.name="out_"+a.name)}),o}},"flow/while":{blocks:["FlowGraphWhileLoopBlock"],outputs:{flows:{loopBody:{name:"executionFlow"}}}},"flow/for":{blocks:["FlowGraphForLoopBlock"],configuration:{initialIndex:{name:"initialIndex",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{values:{startIndex:{name:"startIndex",gltfType:"number"},endIndex:{name:"endIndex",gltfType:"number"}}},outputs:{values:{index:{name:"index"}},flows:{loopBody:{name:"executionFlow"}}},extraProcessor:function(r,e,t,n,o){var a=o[0];return a.config||(a.config={}),a.config.incrementIndexWhenLoopDone=!0,o}},"flow/doN":{blocks:["FlowGraphDoNBlock"],configuration:{},inputs:{values:{n:{name:"maxExecutions",gltfType:"number"}}},outputs:{values:{currentCount:{name:"executionCount"}}}},"flow/multiGate":{blocks:["FlowGraphMultiGateBlock"],configuration:{isRandom:{name:"isRandom",gltfType:"boolean",inOptions:!0,defaultValue:!1},isLoop:{name:"isLoop",gltfType:"boolean",inOptions:!0,defaultValue:!1}},extraProcessor:function(r,e,t,n,o){if(e.op!=="flow/multiGate"||!r.flows||Object.keys(r.flows).length===0)throw new Error("MultiGate should have a single configuration object, the number of output flows");var a=o[0];return a.config||(a.config={}),a.config.outputSignalCount=Object.keys(r.flows).length,a.signalOutputs.forEach(function(s,i){s.name="out_"+i}),o}},"flow/waitAll":{blocks:["FlowGraphWaitAllBlock"],configuration:{inputFlows:{name:"inputSignalCount",gltfType:"number",inOptions:!0,defaultValue:0}},inputs:{flows:{reset:{name:"reset"},"[segment]":{name:"in_$1"}}},validation:function(r){var e,t;return typeof((t=(e=r.configuration)===null||e===void 0?void 0:e.inputFlows)===null||t===void 0?void 0:t.value[0])!="number"&&(r.configuration=r.configuration||{inputFlows:{value:[0]}},r.configuration.inputFlows.value=[0]),{valid:!0}}},"flow/throttle":{blocks:["FlowGraphThrottleBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/setDelay":{blocks:["FlowGraphSetDelayBlock"],outputs:{flows:{err:{name:"error"}}}},"flow/cancelDelay":{blocks:["FlowGraphCancelDelayBlock"]},"variable/get":{blocks:["FlowGraphGetVariableBlock"],validation:function(r){var e,t;return!((t=(e=r.configuration)===null||e===void 0?void 0:e.variable)===null||t===void 0)&&t.value?{valid:!0}:(c.Logger.Error("Variable get block should have a variable configuration"),{valid:!1,error:"Variable get block should have a variable configuration"})},configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:function(r,e){return[e.getVariableName(r[0])]}}}},"variable/set":{blocks:["FlowGraphSetVariableBlock"],configuration:{variable:{name:"variable",gltfType:"number",flowGraphType:"string",inOptions:!0,isVariable:!0,dataTransformer:function(r,e){return[e.getVariableName(r[0])]}}}},"variable/setMultiple":{blocks:["FlowGraphSetVariableBlock"],configuration:{variables:{name:"variables",gltfType:"number",flowGraphType:"string",inOptions:!0,dataTransformer:function(r,e){return[r[0].map(function(t){return e.getVariableName(t)})]}}},extraProcessor:function(r,e,t,n,o){return o[0].dataInputs.forEach(function(a){a.name=n.getVariableName(+a.name)}),o}},"variable/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphContextBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing","FlowGraphGetVariableBlock"],configuration:{variable:{name:"propertyName",inOptions:!0,isVariable:!0,dataTransformer:function(r,e){return[e.getVariableName(r[0])]}},useSlerp:{name:"animationType",inOptions:!0,defaultValue:!1,dataTransformer:function(r){return r[0]===!0?["Quaternion"]:[void 0]}}},inputs:{values:{value:{name:"value_1"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"userVariables",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:4,isVariable:!0}],extraProcessor:function(r,e,t,n,o){var a,s,i,u=o[0],d=(a=r.configuration)===null||a===void 0?void 0:a.variable.value[0];if(typeof d!="number")throw c.Logger.Error("Variable index is not defined for variable interpolation block"),new Error("Variable index is not defined for variable interpolation block");var h=n.arrays.staticVariables[d];u.config.animationType.value===void 0&&(n.arrays.staticVariables,u.config.animationType.value=(0,c.getAnimationTypeByFlowGraphType)(h.type));var m=o[4];return m.config||(m.config={}),(s=m.config).variable||(s.variable={}),m.config.variable.value=n.getVariableName(d),(i=o[3]).config||(i.config={}),o}},"pointer/get":{blocks:["FlowGraphGetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customGetFunction",output:"getFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:function(r,e,t,n,o){return o.forEach(function(a){a.className==="FlowGraphJsonPointerParserBlock"&&(a.config||(a.config={}),a.config.outputValue=!0)}),o}},"pointer/set":{blocks:["FlowGraphSetPropertyBlock","FlowGraphJsonPointerParserBlock"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customSetFunction",output:"setFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:function(r,e,t,n,o){return o.forEach(function(a){a.className==="FlowGraphJsonPointerParserBlock"&&(a.config||(a.config={}),a.config.outputValue=!0)}),o}},"pointer/interpolate":{blocks:["FlowGraphInterpolationBlock","FlowGraphJsonPointerParserBlock","FlowGraphPlayAnimationBlock","FlowGraphBezierCurveEasing"],configuration:{pointer:{name:"jsonPointer",toBlock:"FlowGraphJsonPointerParserBlock"}},inputs:{values:{value:{name:"value_1"},"[segment]":{name:"$1",toBlock:"FlowGraphJsonPointerParserBlock"},duration:{name:"duration_1",gltfType:"number"},p1:{name:"controlPoint1",toBlock:"FlowGraphBezierCurveEasing"},p2:{name:"controlPoint2",toBlock:"FlowGraphBezierCurveEasing"}},flows:{in:{name:"in",toBlock:"FlowGraphPlayAnimationBlock"}}},outputs:{flows:{err:{name:"error",toBlock:"FlowGraphPlayAnimationBlock"},out:{name:"out",toBlock:"FlowGraphPlayAnimationBlock"},done:{name:"done",toBlock:"FlowGraphPlayAnimationBlock"}}},interBlockConnectors:[{input:"object",output:"object",inputBlockIndex:2,outputBlockIndex:1,isVariable:!0},{input:"propertyName",output:"propertyName",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"customBuildAnimation",output:"generateAnimationsFunction",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"animation",output:"animation",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0},{input:"easingFunction",output:"easingFunction",inputBlockIndex:0,outputBlockIndex:3,isVariable:!0},{input:"value_0",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0}],extraProcessor:function(r,e,t,n,o){return o.forEach(function(a){a.className==="FlowGraphJsonPointerParserBlock"?(a.config||(a.config={}),a.config.outputValue=!0):a.className==="FlowGraphInterpolationBlock"&&(a.config||(a.config={}),Object.keys(r.values||[]).forEach(function(s){var i,u=(i=r.values)===null||i===void 0?void 0:i[s];if(s==="value"&&u){var d=u.type;d!==void 0&&(a.config.animationType=n.arrays.types[d].flowGraphType)}}))}),o}},"animation/start":{blocks:["FlowGraphPlayAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},speed:{name:"speed",gltfType:"number"},startTime:{name:"from",gltfType:"number",dataTransformer:function(r,e){return[r[0]*e._animationTargetFps]}},endTime:{name:"to",gltfType:"number",dataTransformer:function(r,e){return[r[0]*e._animationTargetFps]}}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor:function(r,e,t,n,o,a,s){var i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=s,o}},"animation/stop":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor:function(r,e,t,n,o,a,s){var i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=s,o}},"animation/stopAt":{blocks:["FlowGraphStopAnimationBlock","FlowGraphArrayIndexBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{},inputs:{values:{animation:{name:"index",gltfType:"number",toBlock:"FlowGraphArrayIndexBlock"},stopTime:{name:"stopAtFrame",gltfType:"number",dataTransformer:function(r,e){return[r[0]*e._animationTargetFps]}}}},outputs:{flows:{err:{name:"error"}}},interBlockConnectors:[{input:"animationGroup",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"animationGroups",inputBlockIndex:1,outputBlockIndex:2,isVariable:!0}],extraProcessor:function(r,e,t,n,o,a,s){var i=o[o.length-1];return i.config||(i.config={}),i.config.glTF=s,o}},"math/switch":{blocks:["FlowGraphDataSwitchBlock"],configuration:{cases:{name:"cases",inOptions:!0,defaultValue:[]}},inputs:{values:{selection:{name:"case"}}},validation:function(r){if(r.configuration&&r.configuration.cases){var e=r.configuration.cases.value;if(!e.every(function(n){return typeof n=="number"&&/^-?\d+$/.test(n.toString())}))return c.Logger.Warn("Switch cases should be integers. Using empty array instead."),r.configuration.cases.value=[],{valid:!0};var t=new Set(e);r.configuration.cases.value=Array.from(t)}return{valid:!0}},extraProcessor:function(r,e,t,n,o){var a=o[0];return a.dataInputs.forEach(function(s){s.name!=="default"&&s.name!=="case"&&(s.name="in_"+s.name)}),a.config||(a.config={}),a.config.treatCasesAsIntegers=!0,o}},"debug/log":{blocks:["FlowGraphConsoleLogBlock"],configuration:{message:{name:"messageTemplate",inOptions:!0}}}};function C(r,e,t){return e===void 0&&(e=["a"]),{blocks:[r],inputs:{values:e.reduce(function(n,o){return n[o]={name:o},n},{})},outputs:{values:{value:{name:"value"}}},extraProcessor:function(n,o,a,s,i){var u;if(t){(u=i[0]).config||(u.config={}),i[0].config.preventIntegerFloatArithmetic=!0;var d=-1;Object.keys(n.values||{}).find(function(h){var m;return((m=n.values)===null||m===void 0?void 0:m[h].type)!==void 0&&(d=n.values[h].type,!0)}),d!==-1&&(i[0].config.type=s.arrays.types[d].flowGraphType)}return i},validation:function(n){return t?Dr(n):{valid:!0}}}}function Dr(r){if(r.values){var e=Object.keys(r.values).map(function(t){return r.values[t].type}).filter(function(t){return t!==void 0});if(!e.every(function(t){return t===e[0]}))return{valid:!1,error:"All inputs must be of the same type"}}return{valid:!0}}function Hr(){return Object.keys(Ke)}Ke["math/compose"]=Ke["math/matCompose"],Ke["math/decompose"]=Ke["math/matDecompose"];var ir={float:{length:1,flowGraphType:"number",elementType:"number"},bool:{length:1,flowGraphType:"boolean",elementType:"boolean"},float2:{length:2,flowGraphType:"Vector2",elementType:"number"},float3:{length:3,flowGraphType:"Vector3",elementType:"number"},float4:{length:4,flowGraphType:"Vector4",elementType:"number"},float4x4:{length:16,flowGraphType:"Matrix",elementType:"number"},float2x2:{length:4,flowGraphType:"Matrix2D",elementType:"number"},float3x3:{length:9,flowGraphType:"Matrix3D",elementType:"number"},int:{length:1,flowGraphType:"FlowGraphInteger",elementType:"number"}},sr=function(){function r(e,t,n){n===void 0&&(n=60),this._interactivityGraph=e,this._gltf=t,this._animationTargetFps=n,this._types=[],this._mappings=[],this._staticVariables=[],this._events=[],this._internalEventsCounter=0,this._nodes=[],this._parseTypes(),this._parseDeclarations(),this._parseVariables(),this._parseEvents(),this._parseNodes()}return Object.defineProperty(r.prototype,"arrays",{get:function(){return{types:this._types,mappings:this._mappings,staticVariables:this._staticVariables,events:this._events,nodes:this._nodes}},enumerable:!1,configurable:!0}),r.prototype._parseTypes=function(){if(this._interactivityGraph.types)for(var e=0,t=this._interactivityGraph.types;e<t.length;e++){var n=t[e];this._types.push(ir[n.signature])}},r.prototype._parseDeclarations=function(){if(this._interactivityGraph.declarations)for(var e=0,t=this._interactivityGraph.declarations;e<t.length;e++){var n=t[e],o=Yt(n);if(!o)throw c.Logger.Error(["No mapping found for declaration",n]),new Error("Error parsing declarations");this._mappings.push({flowGraphMapping:o,fullOperationName:n.extension?n.op+":"+n.extension:n.op})}},r.prototype._parseVariables=function(){if(this._interactivityGraph.variables)for(var e=0,t=this._interactivityGraph.variables;e<t.length;e++){var n=t[e],o=this._parseVariable(n);this._staticVariables.push(o)}},r.prototype._parseVariable=function(e,t){var n=this._types[e.type];if(!n)throw c.Logger.Error(["No type found for variable",e]),new Error("Error parsing variables");if(e.value&&e.value.length!==n.length)throw c.Logger.Error(["Invalid value length for variable",e,n]),new Error("Error parsing variables");var o=e.value||[];if(!o.length)switch(n.flowGraphType){case"boolean":o.push(!1);break;case"FlowGraphInteger":o.push(0);break;case"number":o.push(NaN);break;case"Vector2":o.push(NaN,NaN);break;case"Vector3":o.push(NaN,NaN,NaN);break;case"Vector4":case"Matrix2D":case"Quaternion":o.fill(NaN,0,4);break;case"Matrix":o.fill(NaN,0,16);break;case"Matrix3D":o.fill(NaN,0,9)}return n.elementType==="number"&&typeof o[0]=="string"&&(o[0]=parseFloat(o[0])),{type:n.flowGraphType,value:t?t(o,this):o}},r.prototype._parseEvents=function(){var e=this;if(this._interactivityGraph.events)for(var t=function(s){var i={eventId:s.id||"internalEvent_"+n._internalEventsCounter++};s.values&&(i.eventData=Object.keys(s.values).map(function(u){var d,h=(d=s.values)===null||d===void 0?void 0:d[u];if(!h)throw c.Logger.Error(["No value found for event key",u]),new Error("Error parsing events");var m=e._types[h.type];if(!m)throw c.Logger.Error(["No type found for event value",h]),new Error("Error parsing events");var _=h.value!==void 0?e._parseVariable(h):void 0;return{id:u,type:m.flowGraphType,eventData:!0,value:_}})),n._events.push(i)},n=this,o=0,a=this._interactivityGraph.events;o<a.length;o++)t(a[o])},r.prototype._parseNodes=function(){var e;if(this._interactivityGraph.nodes)for(var t=0,n=this._interactivityGraph.nodes;t<n.length;t++){var o=n[t];if(typeof o.declaration!="number")throw c.Logger.Error(["No declaration found for node",o]),new Error("Error parsing nodes");var a=this._mappings[o.declaration];if(!a)throw c.Logger.Error(["No mapping found for node",o]),new Error("Error parsing nodes");if(a.flowGraphMapping.validation){var s=a.flowGraphMapping.validation(o,this._interactivityGraph,this._gltf);if(!s.valid)throw new Error("Error validating interactivity node ".concat((e=this._interactivityGraph.declarations)===null||e===void 0?void 0:e[o.declaration].op," - ").concat(s.error))}for(var i=[],u=0,d=a.flowGraphMapping.blocks;u<d.length;u++){var h=d[u],m=this._getEmptyBlock(h,a.fullOperationName);this._parseNodeConfiguration(o,m,a.flowGraphMapping,h),i.push(m)}this._nodes.push({blocks:i,fullOperationName:a.fullOperationName})}},r.prototype._getEmptyBlock=function(e,t){return{uniqueId:(0,c.RandomGUID)(),className:e,dataInputs:[],dataOutputs:[],signalInputs:[],signalOutputs:[],config:{},type:t,metadata:{}}},r.prototype._parseNodeConfiguration=function(e,t,n,o){var a,s,i=t.config;if(e.configuration)for(var u=0,d=Object.keys(e.configuration);u<d.length;u++){var h=d[u],m=(a=e.configuration)===null||a===void 0?void 0:a[h];if(!m)throw c.Logger.Error(["No value found for node configuration",h]),new Error("Error parsing node configuration");var _=(s=n.configuration)===null||s===void 0?void 0:s[h];if(_&&_.toBlock?_.toBlock===o:n.blocks.indexOf(o)===0){var y=(_==null?void 0:_.name)||h;m&&m.value!==void 0||(_==null?void 0:_.defaultValue)===void 0?m.value.length>=0?i[y]={value:m.value.length===1?m.value[0]:m.value}:c.Logger.Warn(["Invalid value for node configuration",m]):i[y]={value:_.defaultValue},_&&_.dataTransformer&&(i[y].value=_.dataTransformer([i[y].value],this)[0])}}},r.prototype._parseNodeConnections=function(e){for(var t,n,o,a,s,i,u,d,h,m,_,y,l,f,p,v,g,b,w,A=0;A<this._nodes.length;A++){var E=(t=this._interactivityGraph.nodes)===null||t===void 0?void 0:t[A];if(!E)throw c.Logger.Error(["No node found for interactivity node",this._nodes[A]]),new Error("Error parsing node connections");var R=this._nodes[A],O=this._mappings[E.declaration];if(!O)throw c.Logger.Error(["No mapping found for node",E]),new Error("Error parsing node connections");for(var I=E.flows||{},L=Object.keys(I).sort(),S=function(oe){var k=I[oe],j=(o=(n=O.flowGraphMapping.outputs)===null||n===void 0?void 0:n.flows)===null||o===void 0?void 0:o[oe],xe=(j==null?void 0:j.name)||oe,le=B._createNewSocketConnection(xe,!0);(j&&j.toBlock&&R.blocks.find(function(ke){return ke.className===j.toBlock})||R.blocks[0]).signalOutputs.push(le);var Oe=k.node,ne=B._nodes[Oe];if(!ne)throw c.Logger.Error(["No node found for input node id",Oe]),new Error("Error parsing node connections");var X=jt(ne.fullOperationName);if(!X)throw c.Logger.Error(["No mapping found for input node",ne]),new Error("Error parsing node connections");var ae=(s=(a=X.inputs)===null||a===void 0?void 0:a.flows)===null||s===void 0?void 0:s[k.socket||"in"],ue=!1;if(!ae)for(var de in(i=X.inputs)===null||i===void 0?void 0:i.flows)de.startsWith("[")&&de.endsWith("]")&&(ue=!0,ae=(d=(u=X.inputs)===null||u===void 0?void 0:u.flows)===null||d===void 0?void 0:d[de]);var he=ae?ue?ae.name.replace("$1",k.socket||""):ae.name:k.socket||"in",fe=ae&&ae.toBlock&&ne.blocks.find(function(ke){return ke.className===ae.toBlock})||ne.blocks[0],ge=fe.signalInputs.find(function(ke){return ke.name===he});ge||(ge=B._createNewSocketConnection(he),fe.signalInputs.push(ge)),ge.connectedPointIds.push(le.uniqueId),le.connectedPointIds.push(ge.uniqueId)},B=this,P=0,re=L;P<re.length;P++)S(re[P]);for(var U=E.values||{},W=Object.keys(U),F=function(oe){var k=U[oe],j=(m=(h=O.flowGraphMapping.inputs)===null||h===void 0?void 0:h.values)===null||m===void 0?void 0:m[oe],xe=!1;if(!j)for(var le in(_=O.flowGraphMapping.inputs)===null||_===void 0?void 0:_.values)le.startsWith("[")&&le.endsWith("]")&&(xe=!0,j=(l=(y=O.flowGraphMapping.inputs)===null||y===void 0?void 0:y.values)===null||l===void 0?void 0:l[le]);var Oe=j?xe?j.name.replace("$1",oe):j.name:oe,ne=K._createNewSocketConnection(Oe);if((j&&j.toBlock&&R.blocks.find(function(at){return at.className===j.toBlock})||R.blocks[0]).dataInputs.push(ne),k.value!==void 0){var X=K._parseVariable(k,j&&j.dataTransformer);e._connectionValues[ne.uniqueId]=X}else{if(k.node===void 0)throw c.Logger.Error(["Invalid value for value connection",k]),new Error("Error parsing node connections");var ae=k.node,ue=k.socket||"value",de=K._nodes[ae];if(!de)throw c.Logger.Error(["No node found for output socket reference",k]),new Error("Error parsing node connections");var he=jt(de.fullOperationName);if(!he)throw c.Logger.Error(["No mapping found for output socket reference",k]),new Error("Error parsing node connections");var fe=(p=(f=he.outputs)===null||f===void 0?void 0:f.values)===null||p===void 0?void 0:p[ue],ge=!1;if(!fe)for(var le in(v=he.outputs)===null||v===void 0?void 0:v.values)le.startsWith("[")&&le.endsWith("]")&&(ge=!0,fe=(b=(g=he.outputs)===null||g===void 0?void 0:g.values)===null||b===void 0?void 0:b[le]);var ke=fe?ge?fe.name.replace("$1",ue):fe==null?void 0:fe.name:ue,zr=fe&&fe.toBlock&&de.blocks.find(function(at){return at.className===fe.toBlock})||de.blocks[0],ot=zr.dataOutputs.find(function(at){return at.name===ke});ot||(ot=K._createNewSocketConnection(ke,!0),zr.dataOutputs.push(ot)),ne.connectedPointIds.push(ot.uniqueId),ot.connectedPointIds.push(ne.uniqueId)}},K=this,Y=0,ie=W;Y<ie.length;Y++)F(ie[Y]);if(O.flowGraphMapping.interBlockConnectors)for(var z=0,ee=O.flowGraphMapping.interBlockConnectors;z<ee.length;z++){var te=ee[z],se=te.input,D=te.output,J=te.isVariable;this._connectFlowGraphNodes(se,D,R.blocks[te.inputBlockIndex],R.blocks[te.outputBlockIndex],J)}if(O.flowGraphMapping.extraProcessor){var Q=(w=this._interactivityGraph.declarations)===null||w===void 0?void 0:w[E.declaration];if(!Q)throw c.Logger.Error(["No declaration found for extra processor",E]),new Error("Error parsing node connections");R.blocks=O.flowGraphMapping.extraProcessor(E,Q,O.flowGraphMapping,this,R.blocks,e,this._gltf)}}},r.prototype._createNewSocketConnection=function(e,t){return{uniqueId:(0,c.RandomGUID)(),name:e,_connectionType:t?1:0,connectedPointIds:[]}},r.prototype._connectFlowGraphNodes=function(e,t,n,o,a){var s=a?n.dataInputs:n.signalInputs,i=a?o.dataOutputs:o.signalOutputs,u=s.find(function(h){return h.name===e})||this._createNewSocketConnection(e),d=i.find(function(h){return h.name===t})||this._createNewSocketConnection(t,!0);s.find(function(h){return h.name===e})||s.push(u),i.find(function(h){return h.name===t})||i.push(d),u.connectedPointIds.push(d.uniqueId),d.connectedPointIds.push(u.uniqueId)},r.prototype.getVariableName=function(e){return"staticVariable_"+e},r.prototype.serializeToFlowGraph=function(){var e={uniqueId:(0,c.RandomGUID)(),_userVariables:{},_connectionValues:{}};this._parseNodeConnections(e);for(var t=0;t<this._staticVariables.length;t++){var n=this._staticVariables[t];e._userVariables[this.getVariableName(t)]=n}return{rightHanded:!0,allBlocks:this._nodes.reduce(function(o,a){return o.concat(a.blocks)},[]),executionContexts:[e]}},r}(),$e="KHR_interactivity",lr=function(){function r(e){this._loader=e,this.name=$e,this.enabled=this._loader.isExtensionUsed($e),this._pathConverter=(0,x.Wt)(this._loader.gltf),e._skipStartAnimationStep=!0;var t=e.babylonScene;t&&ur(t)}return r.prototype.dispose=function(){this._loader=null,delete this._pathConverter},r.prototype.onReady=function(){return(0,T.sH)(this,void 0,void 0,function(){var e,t,n,o,a,s=this;return(0,T.YH)(this,function(i){switch(i.label){case 0:return this._loader.babylonScene&&this._pathConverter?(e=this._loader.babylonScene,(t=(a=this._loader.gltf.extensions)===null||a===void 0?void 0:a.KHR_interactivity)?((n=new c.FlowGraphCoordinator({scene:e})).dispatchEventsSynchronously=!1,o=t.graphs.map(function(u){return new sr(u,s._loader.gltf,s._loader.parent.targetFps).serializeToFlowGraph()}),[4,Promise.all(o.map(function(u){return(0,T.sH)(s,void 0,void 0,function(){return(0,T.YH)(this,function(d){switch(d.label){case 0:return[4,(0,c.ParseFlowGraphAsync)(u,{coordinator:n,pathConverter:this._pathConverter})];case 1:return[2,d.sent()]}})})}))]):[2]):[2];case 1:return i.sent(),n.start(),[2]}})})},r}();function ur(r){(0,x.oR)("/extensions/KHR_interactivity/?/activeCamera/rotation",{get:function(){if(!r.activeCamera)return new c.Quaternion(NaN,NaN,NaN,NaN);var e=c.Quaternion.FromRotationMatrix(r.activeCamera.getWorldMatrix()).normalize();return r.useRightHandedSystem||(e.w*=-1,e.x*=-1),e},type:"Quaternion",getTarget:function(){return r.activeCamera}}),(0,x.oR)("/extensions/KHR_interactivity/?/activeCamera/position",{get:function(){if(!r.activeCamera)return new c.Vector3(NaN,NaN,NaN);var e=r.activeCamera.getWorldMatrix().getTranslation();return r.useRightHandedSystem||(e.x*=-1),e},type:"Vector3",getTarget:function(){return r.activeCamera}}),(0,x.oR)("/animations/{}/extensions/KHR_interactivity/isPlaying",{get:function(e){var t,n;return(n=(t=e._babylonAnimationGroup)===null||t===void 0?void 0:t.isPlaying)!==null&&n!==void 0&&n},type:"boolean",getTarget:function(e){return e._babylonAnimationGroup}}),(0,x.oR)("/animations/{}/extensions/KHR_interactivity/minTime",{get:function(e){var t,n;return((n=(t=e._babylonAnimationGroup)===null||t===void 0?void 0:t.from)!==null&&n!==void 0?n:0)/60},type:"number",getTarget:function(e){return e._babylonAnimationGroup}}),(0,x.oR)("/animations/{}/extensions/KHR_interactivity/maxTime",{get:function(e){var t,n;return((n=(t=e._babylonAnimationGroup)===null||t===void 0?void 0:t.to)!==null&&n!==void 0?n:0)/60},type:"number",getTarget:function(e){return e._babylonAnimationGroup}}),(0,x.oR)("/animations/{}/extensions/KHR_interactivity/playhead",{get:function(e){var t,n;return((n=(t=e._babylonAnimationGroup)===null||t===void 0?void 0:t.getCurrentFrame())!==null&&n!==void 0?n:0)/60},type:"number",getTarget:function(e){return e._babylonAnimationGroup}}),(0,x.oR)("/animations/{}/extensions/KHR_interactivity/virtualPlayhead",{get:function(e){var t,n;return((n=(t=e._babylonAnimationGroup)===null||t===void 0?void 0:t.getCurrentFrame())!==null&&n!==void 0?n:0)/60},type:"number",getTarget:function(e){return e._babylonAnimationGroup}})}(0,c.addToBlockFactory)($e,"FlowGraphGLTFDataProvider",function(){return(0,T.sH)(void 0,void 0,void 0,function(){return(0,T.YH)(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(N.bind(N,274))];case 1:return[2,r.sent().FlowGraphGLTFDataProvider]}})})}),G($e),H($e,!0,function(r){return new lr(r)});var Wt="KHR_node_visibility";(0,x.oR)("/nodes/{}/extensions/KHR_node_visibility/visible",{get:function(r){var e=r._babylonTransformNode;return!e||e.isVisible===void 0||e.isVisible},set:function(r,e){var t,n;(t=e._primitiveBabylonMeshes)===null||t===void 0||t.forEach(function(o){o.inheritVisibility=!0}),e._babylonTransformNode&&(e._babylonTransformNode.isVisible=r),(n=e._primitiveBabylonMeshes)===null||n===void 0||n.forEach(function(o){o.isVisible=r})},getTarget:function(r){return r._babylonTransformNode},getPropertyName:[function(){return"isVisible"}],type:"boolean"});var cr=function(){function r(e){this.name=Wt,this._loader=e,this.enabled=e.isExtensionUsed(Wt)}return r.prototype.onReady=function(){return(0,T.sH)(this,void 0,void 0,function(){var e;return(0,T.YH)(this,function(t){return(e=this._loader.gltf.nodes)===null||e===void 0||e.forEach(function(n){var o,a,s,i;(o=n._primitiveBabylonMeshes)===null||o===void 0||o.forEach(function(u){u.inheritVisibility=!0}),!((a=n.extensions)===null||a===void 0)&&a.KHR_node_visibility&&((s=n.extensions)===null||s===void 0?void 0:s.KHR_node_visibility.visible)===!1&&(n._babylonTransformNode&&(n._babylonTransformNode.isVisible=!1),(i=n._primitiveBabylonMeshes)===null||i===void 0||i.forEach(function(u){u.isVisible=!1}))}),[2]})})},r.prototype.dispose=function(){this._loader=null},r}();G(Wt),H(Wt,!0,function(r){return new cr(r)});var et="KHR_node_selectability";Je("event/onSelect",et,{blocks:["FlowGraphMeshPickEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:function(r){return["pickedMesh_"+r[0]]}}},outputs:{values:{selectedNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"},selectionPoint:{name:"pickedPoint"},selectionRayOrigin:{name:"pickOrigin"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"asset",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"pickedMesh",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor:function(r,e,t,n,o,a,s){var i,u,d,h,m,_,y=o[o.length-1];y.config=y.config||{},y.config.glTF=s;var l=(u=(i=r.configuration)===null||i===void 0?void 0:i.nodeIndex)===null||u===void 0?void 0:u.value[0];if(l===void 0||typeof l!="number")throw new Error("nodeIndex not found in configuration");var f="pickedMesh_"+l;return o[1].config.variable=f,a._userVariables[f]={className:"Mesh",id:(h=(d=s==null?void 0:s.nodes)===null||d===void 0?void 0:d[l]._babylonTransformNode)===null||h===void 0?void 0:h.id,uniqueId:(_=(m=s==null?void 0:s.nodes)===null||m===void 0?void 0:m[l]._babylonTransformNode)===null||_===void 0?void 0:_.uniqueId},o}}),(0,x.oR)("/nodes/{}/extensions/KHR_node_selectability/selectable",{get:function(r){var e=r._babylonTransformNode;return!e||e.isPickable===void 0||e.isPickable},set:function(r,e){var t;(t=e._primitiveBabylonMeshes)===null||t===void 0||t.forEach(function(n){n.isPickable=r})},getTarget:function(r){return r._babylonTransformNode},getPropertyName:[function(){return"isPickable"}],type:"boolean"});var fr=function(){function r(e){this.name=et,this._loader=e,this.enabled=e.isExtensionUsed(et)}return r.prototype.onReady=function(){return(0,T.sH)(this,void 0,void 0,function(){var e;return(0,T.YH)(this,function(t){return(e=this._loader.gltf.nodes)===null||e===void 0||e.forEach(function(n){var o,a,s;!((o=n.extensions)===null||o===void 0)&&o.KHR_node_selectability&&((a=n.extensions)===null||a===void 0?void 0:a.KHR_node_selectability.selectable)===!1&&((s=n._babylonTransformNode)===null||s===void 0||s.getChildMeshes().forEach(function(i){i.isPickable=!1}))}),[2]})})},r.prototype.dispose=function(){this._loader=null},r}();G(et),H(et,!0,function(r){return new fr(r)});var je="KHR_node_hoverability",Ur="targetMeshPointerOver_";Je("event/onHoverIn",je,{blocks:["FlowGraphPointerOverEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:function(r){return[Ur+r[0]]}}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshUnderPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor:function(r,e,t,n,o,a,s){var i,u,d,h,m,_,y=o[o.length-1];y.config=y.config||{},y.config.glTF=s;var l=(u=(i=r.configuration)===null||i===void 0?void 0:i.nodeIndex)===null||u===void 0?void 0:u.value[0];if(l===void 0||typeof l!="number")throw new Error("nodeIndex not found in configuration");var f=Ur+l;return o[1].config.variable=f,a._userVariables[f]={className:"Mesh",id:(h=(d=s==null?void 0:s.nodes)===null||d===void 0?void 0:d[l]._babylonTransformNode)===null||h===void 0?void 0:h.id,uniqueId:(_=(m=s==null?void 0:s.nodes)===null||m===void 0?void 0:m[l]._babylonTransformNode)===null||_===void 0?void 0:_.uniqueId},o}});var Kr="targetMeshPointerOut_";Je("event/onHoverOut",je,{blocks:["FlowGraphPointerOutEventBlock","FlowGraphGetVariableBlock","FlowGraphIndexOfBlock","KHR_interactivity/FlowGraphGLTFDataProvider"],configuration:{stopPropagation:{name:"stopPropagation"},nodeIndex:{name:"variable",toBlock:"FlowGraphGetVariableBlock",dataTransformer:function(r){return[Kr+r[0]]}}},outputs:{values:{hoverNodeIndex:{name:"index",toBlock:"FlowGraphIndexOfBlock"},controllerIndex:{name:"pointerId"}},flows:{out:{name:"done"}}},interBlockConnectors:[{input:"targetMesh",output:"value",inputBlockIndex:0,outputBlockIndex:1,isVariable:!0},{input:"array",output:"nodes",inputBlockIndex:2,outputBlockIndex:3,isVariable:!0},{input:"object",output:"meshOutOfPointer",inputBlockIndex:2,outputBlockIndex:0,isVariable:!0}],extraProcessor:function(r,e,t,n,o,a,s){var i,u,d,h,m,_,y=o[o.length-1];y.config=y.config||{},y.config.glTF=s;var l=(u=(i=r.configuration)===null||i===void 0?void 0:i.nodeIndex)===null||u===void 0?void 0:u.value[0];if(l===void 0||typeof l!="number")throw new Error("nodeIndex not found in configuration");var f=Kr+l;return o[1].config.variable=f,a._userVariables[f]={className:"Mesh",id:(h=(d=s==null?void 0:s.nodes)===null||d===void 0?void 0:d[l]._babylonTransformNode)===null||h===void 0?void 0:h.id,uniqueId:(_=(m=s==null?void 0:s.nodes)===null||m===void 0?void 0:m[l]._babylonTransformNode)===null||_===void 0?void 0:_.uniqueId},o}}),(0,x.oR)("/nodes/{}/extensions/KHR_node_hoverability/hoverable",{get:function(r){var e=r._babylonTransformNode;return!e||e.pointerOverDisableMeshTesting===void 0||e.pointerOverDisableMeshTesting},set:function(r,e){var t;(t=e._primitiveBabylonMeshes)===null||t===void 0||t.forEach(function(n){n.pointerOverDisableMeshTesting=!r})},getTarget:function(r){return r._babylonTransformNode},getPropertyName:[function(){return"pointerOverDisableMeshTesting"}],type:"boolean"});var dr=function(){function r(e){this.name=je,this._loader=e,this.enabled=e.isExtensionUsed(je)}return r.prototype.onReady=function(){return(0,T.sH)(this,void 0,void 0,function(){var e;return(0,T.YH)(this,function(t){return(e=this._loader.gltf.nodes)===null||e===void 0||e.forEach(function(n){var o,a,s;!((o=n.extensions)===null||o===void 0)&&o.KHR_node_hoverability&&((a=n.extensions)===null||a===void 0?void 0:a.KHR_node_hoverability.hoverable)===!1&&((s=n._babylonTransformNode)===null||s===void 0||s.getChildMeshes().forEach(function(i){i.pointerOverDisableMeshTesting=!0}))}),[2]})})},r.prototype.dispose=function(){this._loader=null},r}();G(je),H(je,!0,function(r){return new dr(r)});var hr="ExtrasAsMetadata",pr=function(){function r(e){this.name=hr,this.enabled=!0,this._loader=e}return r.prototype._assignExtras=function(e,t){if(t.extras&&Object.keys(t.extras).length>0){var n=e.metadata=e.metadata||{};(n.gltf=n.gltf||{}).extras=t.extras}},r.prototype.dispose=function(){this._loader=null},r.prototype.loadNodeAsync=function(e,t,n){var o=this;return this._loader.loadNodeAsync(e,t,function(a){o._assignExtras(a,t),n(a)})},r.prototype.loadCameraAsync=function(e,t,n){var o=this;return this._loader.loadCameraAsync(e,t,function(a){o._assignExtras(a,t),n(a)})},r.prototype.createMaterial=function(e,t,n){var o=this._loader.createMaterial(e,t,n);return this._assignExtras(o,t),o},r}();G(hr),H(hr,!1,function(r){return new pr(r)});var jr=N(274),tt=function(){function r(){this.materials=[]}return r.prototype.parseMTL=function(e,t,n,o){if(!(t instanceof ArrayBuffer)){for(var a,s=t.split(`
`),i=/\s+/,u=null,d=0;d<s.length;d++){var h=s[d].trim();if(h.length!==0&&h.charAt(0)!=="#"){var m=h.indexOf(" "),_=m>=0?h.substring(0,m):h;_=_.toLowerCase();var y=m>=0?h.substring(m+1).trim():"";if(_==="newmtl")u&&this.materials.push(u),e._blockEntityCollection=!!o,(u=new c.StandardMaterial(y,e))._parentContainer=o,e._blockEntityCollection=!1;else if(_==="kd"&&u)a=y.split(i,3).map(parseFloat),u.diffuseColor=c.Color3.FromArray(a);else if(_==="ka"&&u)a=y.split(i,3).map(parseFloat),u.ambientColor=c.Color3.FromArray(a);else if(_==="ks"&&u)a=y.split(i,3).map(parseFloat),u.specularColor=c.Color3.FromArray(a);else if(_==="ke"&&u)a=y.split(i,3).map(parseFloat),u.emissiveColor=c.Color3.FromArray(a);else if(_==="ns"&&u)u.specularPower=parseFloat(y);else if(_==="d"&&u)u.alpha=parseFloat(y);else if(_==="map_ka"&&u)u.ambientTexture=r._GetTexture(n,y,e);else if(_==="map_kd"&&u)u.diffuseTexture=r._GetTexture(n,y,e);else if(_==="map_ks"&&u)u.specularTexture=r._GetTexture(n,y,e);else if(_!=="map_ns")if(_==="map_bump"&&u){var l=y.split(i),f=l.indexOf("-bm"),p=null;f>=0&&(p=l[f+1],l.splice(f,2)),u.bumpTexture=r._GetTexture(n,l.join(" "),e),u.bumpTexture&&p!==null&&(u.bumpTexture.level=parseFloat(p))}else _==="map_d"&&u&&(u.opacityTexture=r._GetTexture(n,y,e))}}u&&this.materials.push(u)}},r._GetTexture=function(e,t,n){if(!t)return null;var o=e;if(e==="file:"){var a=t.lastIndexOf("\\");a===-1&&(a=t.lastIndexOf("/")),o+=a>-1?t.substring(a+1):t}else o+=t;return new c.Texture(o,n,!1,r.INVERT_TEXTURE_Y)},r.INVERT_TEXTURE_Y=!0,r}(),mr=function(){function r(e,t,n){this._positions=[],this._normals=[],this._uvs=[],this._colors=[],this._extColors=[],this._meshesFromObj=[],this._indicesForBabylon=[],this._wrappedPositionForBabylon=[],this._wrappedUvsForBabylon=[],this._wrappedColorsForBabylon=[],this._wrappedNormalsForBabylon=[],this._tuplePosNorm=[],this._curPositionInIndices=0,this._hasMeshes=!1,this._unwrappedPositionsForBabylon=[],this._unwrappedColorsForBabylon=[],this._unwrappedNormalsForBabylon=[],this._unwrappedUVForBabylon=[],this._triangles=[],this._materialNameFromObj="",this._objMeshName="",this._increment=1,this._isFirstMaterial=!0,this._grayColor=new c.Color4(.5,.5,.5,1),this._hasLineData=!1,this._materialToUse=e,this._babylonMeshesArray=t,this._loadingOptions=n}return r.prototype._isInArray=function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[]});var n=e[t[0]].normals.indexOf(t[1]);return n===-1?-1:e[t[0]].idx[n]},r.prototype._isInArrayUV=function(e,t){e[t[0]]||(e[t[0]]={normals:[],idx:[],uv:[]});var n=e[t[0]].normals.indexOf(t[1]);return n!=1&&t[2]===e[t[0]].uv[n]?e[t[0]].idx[n]:-1},r.prototype._setData=function(e,t,n,o,a,s,i){var u;(u=this._loadingOptions.optimizeWithUV?this._isInArrayUV(this._tuplePosNorm,[e,n,t]):this._isInArray(this._tuplePosNorm,[e,n]))===-1?(this._indicesForBabylon.push(this._wrappedPositionForBabylon.length),this._wrappedPositionForBabylon.push(o),a=a??new c.Vector2(0,0),this._wrappedUvsForBabylon.push(a),this._wrappedNormalsForBabylon.push(s),i!==void 0&&this._wrappedColorsForBabylon.push(i),this._tuplePosNorm[e].normals.push(n),this._tuplePosNorm[e].idx.push(this._curPositionInIndices++),this._loadingOptions.optimizeWithUV&&this._tuplePosNorm[e].uv.push(t)):this._indicesForBabylon.push(u)},r.prototype._unwrapData=function(){try{for(var e=0;e<this._wrappedPositionForBabylon.length;e++)this._unwrappedPositionsForBabylon.push(this._wrappedPositionForBabylon[e].x*this._handednessSign,this._wrappedPositionForBabylon[e].y,this._wrappedPositionForBabylon[e].z),this._unwrappedNormalsForBabylon.push(this._wrappedNormalsForBabylon[e].x*this._handednessSign,this._wrappedNormalsForBabylon[e].y,this._wrappedNormalsForBabylon[e].z),this._unwrappedUVForBabylon.push(this._wrappedUvsForBabylon[e].x,this._wrappedUvsForBabylon[e].y),this._loadingOptions.importVertexColors&&this._unwrappedColorsForBabylon.push(this._wrappedColorsForBabylon[e].r,this._wrappedColorsForBabylon[e].g,this._wrappedColorsForBabylon[e].b,this._wrappedColorsForBabylon[e].a);this._wrappedPositionForBabylon.length=0,this._wrappedNormalsForBabylon.length=0,this._wrappedUvsForBabylon.length=0,this._wrappedColorsForBabylon.length=0,this._tuplePosNorm.length=0,this._curPositionInIndices=0}catch{throw new Error("Unable to unwrap data while parsing OBJ data.")}},r.prototype._getTriangles=function(e,t){for(var n=t;n<e.length-1;n++)this._pushTriangle(e,n)},r.prototype._getColor=function(e){var t;return this._loadingOptions.importVertexColors?(t=this._extColors[e])!==null&&t!==void 0?t:this._colors[e]:void 0},r.prototype._setDataForCurrentFaceWithPattern1=function(e,t){this._getTriangles(e,t);for(var n=0;n<this._triangles.length;n++){var o=parseInt(this._triangles[n])-1;this._setData(o,0,0,this._positions[o],c.Vector2.Zero(),c.Vector3.Up(),this._getColor(o))}this._triangles.length=0},r.prototype._setDataForCurrentFaceWithPattern2=function(e,t){var n;this._getTriangles(e,t);for(var o=0;o<this._triangles.length;o++){var a=this._triangles[o].split("/"),s=parseInt(a[0])-1,i=parseInt(a[1])-1;this._setData(s,i,0,this._positions[s],(n=this._uvs[i])!==null&&n!==void 0?n:c.Vector2.Zero(),c.Vector3.Up(),this._getColor(s))}this._triangles.length=0},r.prototype._setDataForCurrentFaceWithPattern3=function(e,t){var n,o;this._getTriangles(e,t);for(var a=0;a<this._triangles.length;a++){var s=this._triangles[a].split("/"),i=parseInt(s[0])-1,u=parseInt(s[1])-1,d=parseInt(s[2])-1;this._setData(i,u,d,this._positions[i],(n=this._uvs[u])!==null&&n!==void 0?n:c.Vector2.Zero(),(o=this._normals[d])!==null&&o!==void 0?o:c.Vector3.Up())}this._triangles.length=0},r.prototype._setDataForCurrentFaceWithPattern4=function(e,t){this._getTriangles(e,t);for(var n=0;n<this._triangles.length;n++){var o=this._triangles[n].split("//"),a=parseInt(o[0])-1,s=parseInt(o[1])-1;this._setData(a,1,s,this._positions[a],c.Vector2.Zero(),this._normals[s],this._getColor(a))}this._triangles.length=0},r.prototype._setDataForCurrentFaceWithPattern5=function(e,t){this._getTriangles(e,t);for(var n=0;n<this._triangles.length;n++){var o=this._triangles[n].split("/"),a=this._positions.length+parseInt(o[0]),s=this._uvs.length+parseInt(o[1]),i=this._normals.length+parseInt(o[2]);this._setData(a,s,i,this._positions[a],this._uvs[s],this._normals[i],this._getColor(a))}this._triangles.length=0},r.prototype._addPreviousObjMesh=function(){this._meshesFromObj.length>0&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._unwrapData(),this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._handledMesh.indices=this._indicesForBabylon.slice(),this._handledMesh.positions=this._unwrappedPositionsForBabylon.slice(),this._handledMesh.normals=this._unwrappedNormalsForBabylon.slice(),this._handledMesh.uvs=this._unwrappedUVForBabylon.slice(),this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon.slice()),this._indicesForBabylon.length=0,this._unwrappedPositionsForBabylon.length=0,this._unwrappedColorsForBabylon.length=0,this._unwrappedNormalsForBabylon.length=0,this._unwrappedUVForBabylon.length=0,this._hasLineData=!1)},r.prototype._optimizeNormals=function(e){var t=e.getVerticesData(c.VertexBuffer.PositionKind),n=e.getVerticesData(c.VertexBuffer.NormalKind),o={};if(t&&n){for(var a=0;a<t.length/3;a++)(u=o[i=t[3*a+0]+"_"+t[3*a+1]+"_"+t[3*a+2]])||(u=[],o[i]=u),u.push(a);var s=new c.Vector3;for(var i in o){var u;if(!((u=o[i]).length<2)){var d=u[0];for(a=1;a<u.length;++a){var h=u[a];n[3*d+0]+=n[3*h+0],n[3*d+1]+=n[3*h+1],n[3*d+2]+=n[3*h+2]}for(s.copyFromFloats(n[3*d+0],n[3*d+1],n[3*d+2]),s.normalize(),a=0;a<u.length;++a)n[3*(h=u[a])+0]=s.x,n[3*h+1]=s.y,n[3*h+2]=s.z}}e.setVerticesData(c.VertexBuffer.NormalKind,n)}},r._IsLineElement=function(e){return e.startsWith("l")},r._IsObjectElement=function(e){return e.startsWith("o")},r._IsGroupElement=function(e){return e.startsWith("g")},r._GetZbrushMRGB=function(e,t){if(!e.startsWith("mrgb"))return null;if(e=e.replace("mrgb","").trim(),t)return[];var n=e.match(/[a-z0-9]/g);if(!n||n.length%8!=0)return[];for(var o=[],a=0;a<n.length/8;a++){var s=n[8*a+2]+n[8*a+3],i=n[8*a+4]+n[8*a+5],u=n[8*a+6]+n[8*a+7];o.push(new c.Color4(parseInt(s,16)/255,parseInt(i,16)/255,parseInt(u,16)/255,1))}return o},r.prototype.parse=function(e,t,n,o,a){var s,i,u=this;t=(t=t.replace(/#MRGB/g,"mrgb")).replace(/#.*$/gm,"").trim(),this._loadingOptions.useLegacyBehavior?(this._pushTriangle=function(k,j){return u._triangles.push(k[0],k[j],k[j+1])},this._handednessSign=1):n.useRightHandedSystem?(this._pushTriangle=function(k,j){return u._triangles.push(k[0],k[j+1],k[j])},this._handednessSign=1):(this._pushTriangle=function(k,j){return u._triangles.push(k[0],k[j],k[j+1])},this._handednessSign=-1);var d=t.split(`
`),h=[],m=[];h.push(m);for(var _=0;_<d.length;_++)if((p=d[_].trim().replace(/\s\s/g," ")).length!==0&&p.charAt(0)!=="#")if((r._IsGroupElement(p)||r._IsObjectElement(p))&&(m=[],h.push(m)),r._IsLineElement(p))for(var y=p.split(" "),l=1;l<y.length-1;l++)m.push("l ".concat(y[l]," ").concat(y[l+1]));else m.push(p);var f=h.flat();for(_=0;_<f.length;_++){var p,v=void 0;if((p=f[_].trim().replace(/\s\s/g," ")).length!==0&&p.charAt(0)!=="#")if(r.VertexPattern.test(p)){if(v=p.match(/[^ ]+/g),this._positions.push(new c.Vector3(parseFloat(v[1]),parseFloat(v[2]),parseFloat(v[3]))),this._loadingOptions.importVertexColors)if(v.length>=7){var g=parseFloat(v[4]),b=parseFloat(v[5]),w=parseFloat(v[6]);this._colors.push(new c.Color4(g>1?g/255:g,b>1?b/255:b,w>1?w/255:w,v.length===7||v[7]===void 0?1:parseFloat(v[7])))}else this._colors.push(this._grayColor)}else if((v=r.NormalPattern.exec(p))!==null)this._normals.push(new c.Vector3(parseFloat(v[1]),parseFloat(v[2]),parseFloat(v[3])));else if((v=r.UVPattern.exec(p))!==null)this._uvs.push(new c.Vector2(parseFloat(v[1])*this._loadingOptions.UVScaling.x,parseFloat(v[2])*this._loadingOptions.UVScaling.y));else if((v=r.FacePattern3.exec(p))!==null)this._setDataForCurrentFaceWithPattern3(v[1].trim().split(" "),1);else if((v=r.FacePattern4.exec(p))!==null)this._setDataForCurrentFaceWithPattern4(v[1].trim().split(" "),1);else if((v=r.FacePattern5.exec(p))!==null)this._setDataForCurrentFaceWithPattern5(v[1].trim().split(" "),1);else if((v=r.FacePattern2.exec(p))!==null)this._setDataForCurrentFaceWithPattern2(v[1].trim().split(" "),1);else if((v=r.FacePattern1.exec(p))!==null)this._setDataForCurrentFaceWithPattern1(v[1].trim().split(" "),1);else if((v=r.LinePattern1.exec(p))!==null)this._setDataForCurrentFaceWithPattern1(v[1].trim().split(" "),0),this._hasLineData=!0;else if((v=r.LinePattern2.exec(p))!==null)this._setDataForCurrentFaceWithPattern2(v[1].trim().split(" "),0),this._hasLineData=!0;else if(v=r._GetZbrushMRGB(p,!this._loadingOptions.importVertexColors))for(var A=0,E=v;A<E.length;A++){var R=E[A];this._extColors.push(R)}else if((v=r.LinePattern3.exec(p))!==null)this._setDataForCurrentFaceWithPattern3(v[1].trim().split(" "),0),this._hasLineData=!0;else if(r.GroupDescriptor.test(p)||r.ObjectDescriptor.test(p)){var O={name:p.substring(2).trim(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:r.ObjectDescriptor.test(p)};this._addPreviousObjMesh(),this._meshesFromObj.push(O),this._hasMeshes=!0,this._isFirstMaterial=!0,this._increment=1}else r.UseMtlDescriptor.test(p)?(this._materialNameFromObj=p.substring(7).trim(),this._isFirstMaterial&&this._hasMeshes||(this._addPreviousObjMesh(),O={name:(this._objMeshName||"mesh")+"_mm"+this._increment.toString(),indices:null,positions:null,normals:null,uvs:null,colors:null,materialName:this._materialNameFromObj,isObject:!1},this._increment++,this._meshesFromObj.push(O),this._hasMeshes=!0),this._hasMeshes&&this._isFirstMaterial&&(this._meshesFromObj[this._meshesFromObj.length-1].materialName=this._materialNameFromObj,this._isFirstMaterial=!1)):r.MtlLibGroupDescriptor.test(p)?a(p.substring(7).trim()):r.SmoothDescriptor.test(p)||c.Logger.Log("Unhandled expression at line : "+p)}if(this._hasMeshes&&(this._handledMesh=this._meshesFromObj[this._meshesFromObj.length-1],this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData(),this._handledMesh.indices=this._indicesForBabylon,this._handledMesh.positions=this._unwrappedPositionsForBabylon,this._handledMesh.normals=this._unwrappedNormalsForBabylon,this._handledMesh.uvs=this._unwrappedUVForBabylon,this._handledMesh.hasLines=this._hasLineData,this._loadingOptions.importVertexColors&&(this._handledMesh.colors=this._unwrappedColorsForBabylon)),!this._hasMeshes){var I=null;if(this._indicesForBabylon.length)this._loadingOptions.useLegacyBehavior&&this._indicesForBabylon.reverse(),this._unwrapData();else{for(var L=0,S=this._positions;L<S.length;L++){var B=S[L];this._unwrappedPositionsForBabylon.push(B.x,B.y,B.z)}if(this._normals.length)for(var P=0,re=this._normals;P<re.length;P++){var U=re[P];this._unwrappedNormalsForBabylon.push(U.x,U.y,U.z)}if(this._uvs.length)for(var W=0,F=this._uvs;W<F.length;W++){var K=F[W];this._unwrappedUVForBabylon.push(K.x,K.y)}if(this._extColors.length)for(var Y=0,ie=this._extColors;Y<ie.length;Y++){var z=ie[Y];this._unwrappedColorsForBabylon.push(z.r,z.g,z.b,z.a)}else if(this._colors.length)for(var ee=0,te=this._colors;ee<te.length;ee++)z=te[ee],this._unwrappedColorsForBabylon.push(z.r,z.g,z.b,z.a);this._materialNameFromObj||((I=new c.StandardMaterial(c.Geometry.RandomId(),n)).pointsCloud=!0,this._materialNameFromObj=I.name,this._normals.length||(I.disableLighting=!0,I.emissiveColor=c.Color3.White()))}this._meshesFromObj.push({name:c.Geometry.RandomId(),indices:this._indicesForBabylon,positions:this._unwrappedPositionsForBabylon,colors:this._unwrappedColorsForBabylon,normals:this._unwrappedNormalsForBabylon,uvs:this._unwrappedUVForBabylon,materialName:this._materialNameFromObj,directMaterial:I,isObject:!0,hasLines:this._hasLineData})}for(var se=0;se<this._meshesFromObj.length;se++){if(e&&this._meshesFromObj[se].name){if(e instanceof Array){if(e.indexOf(this._meshesFromObj[se].name)===-1)continue}else if(this._meshesFromObj[se].name!==e)continue}this._handledMesh=this._meshesFromObj[se],n._blockEntityCollection=!!o;var D=new c.Mesh(this._meshesFromObj[se].name,n);if(D._parentContainer=o,n._blockEntityCollection=!1,this._handledMesh._babylonMesh=D,!this._handledMesh.isObject){for(var J=se-1;J>=0;--J)if(this._meshesFromObj[J].isObject&&this._meshesFromObj[J]._babylonMesh){D.parent=this._meshesFromObj[J]._babylonMesh;break}}if(this._materialToUse.push(this._meshesFromObj[se].materialName),this._handledMesh.hasLines&&((s=D._internalMetadata)!==null&&s!==void 0||(D._internalMetadata={}),D._internalMetadata._isLine=!0),((i=this._handledMesh.positions)===null||i===void 0?void 0:i.length)!==0){var Q=new c.VertexData;if(Q.uvs=this._handledMesh.uvs,Q.indices=this._handledMesh.indices,Q.positions=this._handledMesh.positions,this._loadingOptions.computeNormals){var oe=new Array;c.VertexData.ComputeNormals(this._handledMesh.positions,this._handledMesh.indices,oe),Q.normals=oe}else Q.normals=this._handledMesh.normals;this._loadingOptions.importVertexColors&&(Q.colors=this._handledMesh.colors),Q.applyToMesh(D),this._loadingOptions.invertY&&(D.scaling.y*=-1),this._loadingOptions.optimizeNormals&&this._optimizeNormals(D),this._babylonMeshesArray.push(D),this._handledMesh.directMaterial&&(D.material=this._handledMesh.directMaterial)}else this._babylonMeshesArray.push(D)}},r.ObjectDescriptor=/^o/,r.GroupDescriptor=/^g/,r.MtlLibGroupDescriptor=/^mtllib /,r.UseMtlDescriptor=/^usemtl /,r.SmoothDescriptor=/^s /,r.VertexPattern=/^v(\s+[\d|.|+|\-|e|E]+){3,7}/,r.NormalPattern=/^vn(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,r.UVPattern=/^vt(\s+[\d|.|+|\-|e|E]+)( +[\d|.|+|\-|e|E]+)/,r.FacePattern1=/^f\s+(([\d]{1,}[\s]?){3,})+/,r.FacePattern2=/^f\s+((([\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,r.FacePattern3=/^f\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){3,})+)/,r.FacePattern4=/^f\s+((([\d]{1,}\/\/[\d]{1,}[\s]?){3,})+)/,r.FacePattern5=/^f\s+(((-[\d]{1,}\/-[\d]{1,}\/-[\d]{1,}[\s]?){3,})+)/,r.LinePattern1=/^l\s+(([\d]{1,}[\s]?){2,})+/,r.LinePattern2=/^l\s+((([\d]{1,}\/[\d]{1,}[\s]?){2,})+)/,r.LinePattern3=/^l\s+((([\d]{1,}\/[\d]{1,}\/[\d]{1,}[\s]?){2,})+)/,r}(),_r=function(){function r(e){this.name="obj",this.extensions=".obj",this._assetContainer=null,this._loadingOptions=(0,T.Cl)((0,T.Cl)({},r._DefaultLoadingOptions),e??{})}return Object.defineProperty(r,"INVERT_TEXTURE_Y",{get:function(){return tt.INVERT_TEXTURE_Y},set:function(e){tt.INVERT_TEXTURE_Y=e},enumerable:!1,configurable:!0}),Object.defineProperty(r,"_DefaultLoadingOptions",{get:function(){return{computeNormals:r.COMPUTE_NORMALS,optimizeNormals:r.OPTIMIZE_NORMALS,importVertexColors:r.IMPORT_VERTEX_COLORS,invertY:r.INVERT_Y,invertTextureY:r.INVERT_TEXTURE_Y,UVScaling:r.UV_SCALING,materialLoadingFailsSilently:r.MATERIAL_LOADING_FAILS_SILENTLY,optimizeWithUV:r.OPTIMIZE_WITH_UV,skipMaterials:r.SKIP_MATERIALS,useLegacyBehavior:r.USE_LEGACY_BEHAVIOR}},enumerable:!1,configurable:!0}),r.prototype._loadMTL=function(e,t,n,o){var a=t+e;c.Tools.LoadFile(a,n,void 0,void 0,!1,function(s,i){o(a,i)})},r.prototype.createPlugin=function(e){return new r(e.obj)},r.prototype.canDirectLoad=function(){return!1},r.prototype.importMeshAsync=function(e,t,n,o){return this._parseSolidAsync(e,t,n,o).then(function(a){return{meshes:a,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}})},r.prototype.loadAsync=function(e,t,n){return this.importMeshAsync(null,e,t,n).then(function(){})},r.prototype.loadAssetContainerAsync=function(e,t,n){var o=this,a=new c.AssetContainer(e);return this._assetContainer=a,this.importMeshAsync(null,e,t,n).then(function(s){return s.meshes.forEach(function(i){return a.meshes.push(i)}),s.meshes.forEach(function(i){var u=i.material;u&&a.materials.indexOf(u)==-1&&(a.materials.push(u),u.getActiveTextures().forEach(function(d){a.textures.indexOf(d)==-1&&a.textures.push(d)}))}),o._assetContainer=null,a}).catch(function(s){throw o._assetContainer=null,s})},r.prototype._parseSolidAsync=function(e,t,n,o){var a=this,s="",i=new tt,u=[],d=[];n=n.replace(/#.*$/gm,"").trim(),new mr(u,d,this._loadingOptions).parse(e,n,t,this._assetContainer,function(m){s=m});var h=[];return s===""||this._loadingOptions.skipMaterials||h.push(new Promise(function(m,_){a._loadMTL(s,o,function(y){try{i.parseMTL(t,y,o,a._assetContainer);for(var l=0;l<i.materials.length;l++){for(var f=0,p=[],v=void 0;(v=u.indexOf(i.materials[l].name,f))>-1;)p.push(v),f=v+1;if(v===-1&&p.length===0)i.materials[l].dispose();else for(var g=0;g<p.length;g++){var b=d[p[g]],w=i.materials[l];b.material=w,b.getTotalIndices()||(w.pointsCloud=!0)}}m()}catch(A){c.Tools.Warn("Error processing MTL file: '".concat(s,"'")),a._loadingOptions.materialLoadingFailsSilently?m():_(A)}},function(y,l){c.Tools.Warn("Error downloading MTL file: '".concat(s,"'")),a._loadingOptions.materialLoadingFailsSilently?m():_(l)})})),Promise.all(h).then(function(){var m=function(_){var y,l;return!!((l=(y=_._internalMetadata)===null||y===void 0?void 0:y._isLine)!==null&&l!==void 0&&l)};return d.forEach(function(_){var y,l;if(m(_)){var f=(y=_.material)!==null&&y!==void 0?y:new c.StandardMaterial(_.name+"_line",t);f.getBindedMeshes().filter(function(p){return!m(p)}).length>0&&(f=(l=f.clone(f.name+"_line"))!==null&&l!==void 0?l:f),f.wireframe=!0,_.material=f,_._internalMetadata&&(_._internalMetadata._isLine=void 0)}}),d})},r.OPTIMIZE_WITH_UV=!0,r.INVERT_Y=!1,r.IMPORT_VERTEX_COLORS=!1,r.COMPUTE_NORMALS=!1,r.OPTIMIZE_NORMALS=!1,r.UV_SCALING=new c.Vector2(1,1),r.SKIP_MATERIALS=!1,r.MATERIAL_LOADING_FAILS_SILENTLY=!0,r.USE_LEGACY_BEHAVIOR=!1,r}();(0,c.RegisterSceneLoaderPlugin)(new _r);var lo={".stl":{isBinary:!0}},vr=function(){function r(){this.solidPattern=/solid (\S*)([\S\s]*?)endsolid[ ]*(\S*)/g,this.facetsPattern=/facet([\s\S]*?)endfacet/g,this.normalPattern=/normal[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.vertexPattern=/vertex[\s]+([-+]?[0-9]+\.?[0-9]*([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+[\s]+([-+]?[0-9]*\.?[0-9]+([eE][-+]?[0-9]+)?)+/g,this.name="stl",this.extensions=lo}return r.prototype.importMesh=function(e,t,n,o,a){var s;if(typeof n!="string"){if(this._isBinary(n)){var i=new c.Mesh("stlmesh",t);return this._parseBinary(i,n),a&&a.push(i),!0}n=new TextDecoder().decode(new Uint8Array(n))}for(;s=this.solidPattern.exec(n);){var u=s[1],d=s[3];if(d&&u!=d)return c.Tools.Error("Error in STL, solid name != endsolid name"),!1;if(e&&u){if(e instanceof Array){if(!e.indexOf(u))continue}else if(u!==e)continue}u=u||"stlmesh",i=new c.Mesh(u,t),this._parseASCII(i,s[2]),a&&a.push(i)}return!0},r.prototype.load=function(e,t,n){return this.importMesh(null,e,t,n,null)},r.prototype.loadAssetContainer=function(e,t,n){var o=new c.AssetContainer(e);return e._blockEntityCollection=!0,this.importMesh(null,e,t,n,o.meshes),e._blockEntityCollection=!1,o},r.prototype._isBinary=function(e){var t=new DataView(e);if(t.byteLength<=80)return!1;if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var n=[115,111,108,105,100],o=0;o<5;o++)if(t.getUint8(o)!==n[o])return!0;return!1},r.prototype._parseBinary=function(e,t){for(var n=new DataView(t),o=n.getUint32(80,!0),a=0,s=new Float32Array(3*o*3),i=new Float32Array(3*o*3),u=new Uint32Array(3*o),d=0,h=0;h<o;h++){for(var m=84+50*h,_=n.getFloat32(m,!0),y=n.getFloat32(m+4,!0),l=n.getFloat32(m+8,!0),f=1;f<=3;f++){var p=m+12*f;s[a]=n.getFloat32(p,!0),i[a]=_,r.DO_NOT_ALTER_FILE_COORDINATES?(s[a+1]=n.getFloat32(p+4,!0),s[a+2]=n.getFloat32(p+8,!0),i[a+1]=y,i[a+2]=l):(s[a+2]=n.getFloat32(p+4,!0),s[a+1]=n.getFloat32(p+8,!0),i[a+2]=y,i[a+1]=l),a+=3}r.DO_NOT_ALTER_FILE_COORDINATES?(u[d]=d,u[d+1]=d+2,u[d+2]=d+1,d+=3):(u[d]=d++,u[d]=d++,u[d]=d++)}e.setVerticesData(c.VertexBuffer.PositionKind,s),e.setVerticesData(c.VertexBuffer.NormalKind,i),e.setIndices(u),e.computeWorldMatrix(!0)},r.prototype._parseASCII=function(e,t){for(var n,o=[],a=[],s=[],i=0;n=this.facetsPattern.exec(t);){var u=n[1],d=this.normalPattern.exec(u);if(this.normalPattern.lastIndex=0,d){for(var h=[Number(d[1]),Number(d[5]),Number(d[3])],m=void 0;m=this.vertexPattern.exec(u);)r.DO_NOT_ALTER_FILE_COORDINATES?(o.push(Number(m[1]),Number(m[3]),Number(m[5])),a.push(h[0],h[2],h[1])):(o.push(Number(m[1]),Number(m[5]),Number(m[3])),a.push(h[0],h[1],h[2]));r.DO_NOT_ALTER_FILE_COORDINATES?(s.push(i,i+2,i+1),i+=3):s.push(i++,i++,i++),this.vertexPattern.lastIndex=0}}this.facetsPattern.lastIndex=0,e.setVerticesData(c.VertexBuffer.PositionKind,o),e.setVerticesData(c.VertexBuffer.NormalKind,a),e.setIndices(s),e.computeWorldMatrix(!0)},r.DO_NOT_ALTER_FILE_COORDINATES=!1,r}();(0,c.RegisterSceneLoaderPlugin)(new vr);var Yr,Zr="splat",uo={".splat":{isBinary:!0},".ply":{isBinary:!0},".spz":{isBinary:!0}};(function(r){r[r.Splat=0]="Splat",r[r.PointCloud=1]="PointCloud",r[r.Mesh=2]="Mesh",r[r.Reject=3]="Reject"})(Yr||(Yr={}));var Wr=function(){function r(e){e===void 0&&(e=r._DefaultLoadingOptions),this.name=Zr,this._assetContainer=null,this.extensions=uo,this._loadingOptions=e}return r.prototype.createPlugin=function(e){return new r(e[Zr])},r.prototype.importMeshAsync=function(e,t,n,o,a,s){return(0,T.sH)(this,void 0,void 0,function(){return(0,T.YH)(this,function(i){switch(i.label){case 0:return[4,this._parseAsync(e,t,n,o).then(function(u){return{meshes:u,particleSystems:[],skeletons:[],animationGroups:[],transformNodes:[],geometries:[],lights:[],spriteManagers:[]}})];case 1:return[2,i.sent()]}})})},r._BuildPointCloud=function(e,t){if(!t.byteLength)return!1;var n=new Uint8Array(t),o=new Float32Array(t),a=n.length/32;return e.addPoints(a,function(s,i){var u=o[8*i+0],d=o[8*i+1],h=o[8*i+2];s.position=new c.Vector3(u,d,h);var m=n[32*i+24+0]/255,_=n[32*i+24+1]/255,y=n[32*i+24+2]/255;s.color=new c.Color4(m,_,y,1)}),!0},r._BuildMesh=function(e,t){for(var n=new c.Mesh("PLYMesh",e),o=new Uint8Array(t.data),a=new Float32Array(t.data),s=o.length/32,i=[],u=new c.VertexData,d=0;d<s;d++){var h=a[8*d+0],m=a[8*d+1],_=a[8*d+2];i.push(h,m,_)}if(t.hasVertexColors){var y=new Float32Array(4*s);for(d=0;d<s;d++){var l=o[32*d+24+0]/255,f=o[32*d+24+1]/255,p=o[32*d+24+2]/255;y[4*d+0]=l,y[4*d+1]=f,y[4*d+2]=p,y[4*d+3]=1}u.colors=y}return u.positions=i,u.indices=t.faces,u.applyToMesh(n),n},r.prototype._parseSPZAsync=function(e,t){var n=new Uint8Array(e),o=new Uint32Array(e.slice(0,12)),a=o[2],s=n[12],i=n[13],u=n[14];if(n[15]||o[0]!=1347635022||o[1]!=2)return new Promise(function(D){D({mode:3,data:d,hasVertexColors:!1})});var d=new ArrayBuffer(32*a),h=1/(1<<i),m=new Int32Array(1),_=new Uint8Array(m.buffer),y=function(D,J){return _[0]=D[J+0],_[1]=D[J+1],_[2]=D[J+2],_[3]=128&D[J+2]?255:0,m[0]*h},l=16,f=new Float32Array(d),p=new Float32Array(d),v=new Uint8ClampedArray(d),g=new Uint8ClampedArray(d),b=1,w=0;this._loadingOptions.flipY||(b=-1,w=255);for(var A=0;A<a;A++)f[8*A+0]=y(n,l+0),f[8*A+1]=b*y(n,l+3),f[8*A+2]=b*y(n,l+6),l+=9;for(A=0;A<a;A++){for(var E=0;E<3;E++){var R=(n[l+a+3*A+E]-127.5)/38.25;v[32*A+24+E]=c.Scalar.Clamp(255*(.5+.282*R),0,255)}v[32*A+24+3]=n[l+A]}for(l+=4*a,A=0;A<a;A++)p[8*A+3+0]=Math.exp(n[l+0]/16-10),p[8*A+3+1]=Math.exp(n[l+1]/16-10),p[8*A+3+2]=Math.exp(n[l+2]/16-10),l+=3;for(A=0;A<a;A++){var O=n[l+0],I=n[l+1]*b+w,L=n[l+2]*b+w,S=O/127.5-1,B=I/127.5-1,P=L/127.5-1;g[32*A+28+1]=O,g[32*A+28+2]=I,g[32*A+28+3]=L;var re=1-(S*S+B*B+P*P);g[32*A+28+0]=127.5+127.5*Math.sqrt(re<0?0:re),l+=3}if(s){for(var U=3*((s+1)*(s+1)-1),W=Math.ceil(U/16),F=l,K=[],Y=t.getEngine().getCaps().maxTextureSize,ie=Math.ceil(a/Y),z=0;z<W;z++){var ee=new Uint8Array(ie*Y*4*4);K.push(ee)}for(A=0;A<a;A++)for(var te=0;te<U;te++){var se=n[F++];z=Math.floor(te/16),K[z][te%16+16*A]=se}return new Promise(function(D){D({mode:0,data:d,hasVertexColors:!1,sh:K,trainedWithAntialiasing:!!u})})}return new Promise(function(D){D({mode:0,data:d,hasVertexColors:!1,trainedWithAntialiasing:!!u})})},r.prototype._parseAsync=function(e,t,n,o){var a=this,s=[],i=new ReadableStream({start:function(h){h.enqueue(new Uint8Array(n)),h.close()}}),u=new DecompressionStream("gzip"),d=i.pipeThrough(u);return new Promise(function(h){new Response(d).arrayBuffer().then(function(m){a._parseSPZAsync(m,t).then(function(_){t._blockEntityCollection=!!a._assetContainer;var y=new c.GaussianSplattingMesh("GaussianSplatting",null,t,a._loadingOptions.keepInRam);if(_.trainedWithAntialiasing){var l=y.material;l.kernelSize=.1,l.compensation=!0}y._parentContainer=a._assetContainer,s.push(y),y.updateData(_.data,_.sh),t._blockEntityCollection=!1,h(s)})}).catch(function(){r._ConvertPLYToSplat(n).then(function(m){return(0,T.sH)(a,void 0,void 0,function(){var _,y;return(0,T.YH)(this,function(l){switch(l.label){case 0:switch(t._blockEntityCollection=!!this._assetContainer,m.mode){case 0:return[3,1];case 1:return[3,2];case 2:return[3,6]}return[3,7];case 1:return(_=new c.GaussianSplattingMesh("GaussianSplatting",null,t,this._loadingOptions.keepInRam))._parentContainer=this._assetContainer,s.push(_),_.updateData(m.data,m.sh),!m.compressed&&m.rawSplat||_.viewDirectionFactor.set(-1,-1,1),[3,8];case 2:return y=new c.PointsCloudSystem("PointCloud",1,t),r._BuildPointCloud(y,m.data)?[4,y.buildMeshAsync().then(function(f){s.push(f)})]:[3,4];case 3:return l.sent(),[3,5];case 4:y.dispose(),l.label=5;case 5:return[3,8];case 6:if(!m.faces)throw new Error("PLY mesh doesn't contain face informations.");return s.push(r._BuildMesh(t,m)),[3,8];case 7:throw new Error("Unsupported Splat mode");case 8:return t._blockEntityCollection=!1,h(s),[2]}})})})})})},r.prototype.loadAssetContainerAsync=function(e,t,n){var o=this,a=new c.AssetContainer(e);return this._assetContainer=a,this.importMeshAsync(null,e,t,n).then(function(s){for(var i=0,u=s.meshes;i<u.length;i++){var d=u[i];a.meshes.push(d)}return o._assetContainer=null,a}).catch(function(s){throw o._assetContainer=null,s})},r.prototype.loadAsync=function(e,t,n){return this.importMeshAsync(null,e,t,n).then(function(){})},r._ConvertPLYToSplat=function(e){var t=this,n=new Uint8Array(e),o=new TextDecoder().decode(n.slice(0,10240)),a=o.indexOf(`end_header
`);if(a<0||!o)return new Promise(function(L){L({mode:0,data:e,rawSplat:!0})});var s=parseInt(/element vertex (\d+)\n/.exec(o)[1]),i=/element face (\d+)\n/.exec(o),u=0;i&&(u=parseInt(i[1]));var d=/element chunk (\d+)\n/.exec(o),h=0;d&&(h=parseInt(d[1]));var m,_=0,y=0,l={double:8,int:4,uint:4,float:4,short:2,ushort:2,uchar:1,list:0};(function(L){L[L.Vertex=0]="Vertex",L[L.Chunk=1]="Chunk",L[L.SH=2]="SH"})(m||(m={}));for(var f=1,p=[],v=[],g=0,b=o.slice(0,a).split(`
`);g<b.length;g++){var w=b[g];if(w.startsWith("property ")){var A=w.split(" "),E=A[1],R=A[2];f==1?(v.push({name:R,type:E,offset:y}),y+=l[E]):f==0?(p.push({name:R,type:E,offset:_}),_+=l[E]):f==2&&p.push({name:R,type:E,offset:_}),l[E]||c.Logger.Warn("Unsupported property type: ".concat(E,"."))}else w.startsWith("element ")&&((E=w.split(" ")[1])=="chunk"?f=1:E=="vertex"?f=0:E=="sh"&&(f=2))}var O=_,I=y;return c.GaussianSplattingMesh.ConvertPLYWithSHToSplatAsync(e).then(function(L){return(0,T.sH)(t,void 0,void 0,function(){var S,B,P,re,U,W,F,K,Y,ie,z,ee,te,se,D;return(0,T.YH)(this,function(J){switch(J.label){case 0:if(S=new DataView(e,a+11),B=I*h+O*s,P=[],u){for(re=0;re<u;re++)if((U=S.getUint8(B))==3){for(B+=1,W=0;W<U;W++)F=S.getUint32(B+4*(2-W),!0),P.push(F);B+=12}}return h?[4,new Promise(function(Q){Q({mode:0,data:L.buffer,sh:L.sh,faces:P,hasVertexColors:!1,compressed:!0,rawSplat:!1})})]:[3,2];case 1:case 3:return[2,J.sent()];case 2:for(K=0,Y=0,ie=["x","y","z","scale_0","scale_1","scale_2","opacity","rot_0","rot_1","rot_2","rot_3"],z=["red","green","blue","f_dc_0","f_dc_1","f_dc_2"],ee=0;ee<p.length;ee++)te=p[ee],ie.includes(te.name)&&K++,z.includes(te.name)&&Y++;return se=K==ie.length&&Y==3,D=u?2:se?0:1,[4,new Promise(function(Q){Q({mode:D,data:L.buffer,sh:L.sh,faces:P,hasVertexColors:!!Y,compressed:!1,rawSplat:!1})})]}})})})},r._DefaultLoadingOptions={keepInRam:!1,flipY:!1},r}();(0,c.RegisterSceneLoaderPlugin)(new Wr);var nt=N.g!==void 0?N.g:typeof window<"u"?window:void 0;if(nt!==void 0){for(var rt in nt.BABYLON=nt.BABYLON||{},st)nt.BABYLON[rt]=st[rt];for(var rt in it)nt.BABYLON[rt]=it[rt]}var Ye=N.g!==void 0?N.g:typeof window<"u"?window:void 0;if(Ye!==void 0)for(var qr in Ye.BABYLON=Ye.BABYLON||{},Ye.BABYLON.GLTF1=Ye.BABYLON.GLTF1||{},qe)Ye.BABYLON.GLTF1[qr]=qe[qr];var qt=N.g!==void 0?N.g:typeof window<"u"?window:void 0;if(qt!==void 0){qt.BABYLON=qt.BABYLON||{};var Ne=qt.BABYLON;Ne.GLTF2=Ne.GLTF2||{},Ne.GLTF2.Loader=Ne.GLTF2.Loader||{},Ne.GLTF2.Loader.Extensions=Ne.GLTF2.Loader.Extensions||{};var yr=[];for(var Ee in lt)Ne.GLTF2.Loader.Extensions[Ee]=lt[Ee],yr.push(Ee);for(var Ee in Qt)Ne.GLTF2.Loader[Ee]=Qt[Ee],yr.push(Ee);for(var Ee in ze)yr.indexOf(Ee)>-1||(Ne.GLTF2[Ee]=ze[Ee])}var gr=N.g!==void 0?N.g:typeof window<"u"?window:void 0;if(gr!==void 0)for(var br in ut)gr.BABYLON[br]||(gr.BABYLON[br]=ut[br]);var Tr=N.g!==void 0?N.g:typeof window<"u"?window:void 0;if(Tr!==void 0)for(var xr in ct)Tr.BABYLON[xr]||(Tr.BABYLON[xr]=ct[xr]);const co=Jt;return wr.default})())}(zt)),zt.exports}var Jr=_o();const vo=ho(Jr),go=po({__proto__:null,default:vo},[Jr]);export{go as b};
